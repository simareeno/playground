(function(){define(["packages/jquery","packages/event-bus"],function(t,e){var r,n,i,a,s,o,u,c,f,l,m,h,d,p,v,_,b,T;return d=function(e){var r,n,i,a,s,o,u;return i=document.createElement("div"),u=i.style,s=["o","ms","moz","webkit"],o=[e],n=function(t){return t.charAt(0).toUpperCase()+t.substr(1)},r=n(e),t.each(s,function(t,e){return o.push(e+r,n(e)+r)}),a=null,t.each(o,function(t,e){if(e in u)return a=e,!1}),a},i=function(e){return t('<span class="bTimer__eItemWrap"><span class="bTimer__eItem">'+e+"</span></span>")},f=function(t){return null==t&&(t=0),("00"+t).slice(-2)},m=function(t,e){var r,n;if(t%=100,t>=5&&t<=20)return e[2];switch(n=t+"",r=+n.charAt(n.length-1)){case 1:return e[0];case 2:case 3:case 4:return e[1]}return e[2]},l=function(t){var e,r;if("number"==typeof t||/^\d+$/.test(t))return+t;if(e=t.match(/^(\d+(?:\.\d+)?)\s+(\w+)$/),!e)throw new Error("Unknown duration format: "+t);switch(r=parseFloat(e[1]),e[2]){case"day":case"days":return 24*r*60*60*1e3;case"hour":case"hours":return 60*r*60*1e3;case"minute":case"minutes":return 60*r*1e3;case"second":case"seconds":return 1e3*r;default:throw new Error("Unknown token type: "+e[2])}},a=function(e,r,a){var s,o,u;return null==a&&(a=[]),e=t(e),s=e.find(".bTimer__eGroup"),o=[],u=a.slice(0),r.length=u.length,s.length?(u.reverse(),s=t.makeArray(s),r=t.makeArray(r),s.reverse(),r.reverse(),t.each(s,function(e,i){var a,s;return a=t(".bTimer__eItemWrap",i),s=f(r[e]),t.each(a,function(e,r){var i;if(n(r),i=s.charAt(e)||"0",t(".bTimer__eItem",r).text()!==i)return o.push([r,i])}),t(".bTimer__eLabel",i).text(m(parseInt(s,10),h[u[e]]))})):t.each(r,function(r,n){var a;return a=t('<span class="bTimer__eGroup"></span>'),a.append(i(n.charAt(0)),i(n.charAt(1))),a.append('<span class="bTimer__eLabel">'+m(parseInt(n,10),h[u[r]])+"</span>"),e.append(a)}),o},n=function(e){var r;if(e=t(e),r=e.data("flip-timer"))return r.cur.remove(),r.flipCur.remove(),r.flipNext.remove(),r.next.removeClass("bTimer__eItem_mAnim").css(T,"").css({clip:""}),e.data("flip-timer",null)},s=function(e,r){var i,a,s,o,c,f;return n(e),e=t(e),f=e.find(".bTimer__eItem").addClass("bTimer__eItem_mAnim"),u?(o=f[0].offsetHeight,s=Math.round(o/2),c=f.clone().text(r),i=f.clone().addClass("bTimer__eItem_mFlip"),a=c.clone().addClass("bTimer__eItem_mFlip"),f[0].style.clip=a[0].style.clip="rect("+s+"px, auto, auto, auto)",c[0].style.clip=i[0].style.clip="rect(auto, auto, "+s+"px, auto)",a.css(T,"rotateX(180deg)"),f.before(c,i,a),e.data("flip-timer",{cur:f,next:c,flipCur:i,flipNext:a}),function(){return i.css(T,"rotateX(-179.99deg)"),a.css(T,"rotateX(0deg)")}):void f.text(r)},o=function(t){var e,r,n,i;return e=Math.floor(t/v),r=Math.floor((t-=e*v)/_),n=Math.floor((t-=r*_)/b),i=Math.floor(t-=n*b),[f(e),f(r),f(n),f(i)]},p=function(e,r){var n,i;if(r=Math.max(r,0),i=a(e,o(r),this.order),n=t.map(i,function(t){return s(t[0],t[1])}),n.length)return setTimeout(function(){var t,e;for(t=void 0,e=[];n.length;)t=n.shift(),e.push(t&&t());return e},50)},T=d("transform"),u=d("perspective"),r=null,b=60,_=60*b,v=24*_,c="documentMode"in document,h={days:["день","дня","дней"],hours:["час","часа","часов"],minutes:["минута","минуты","минут"],seconds:["секунда","секунды","секунд"]},{init:function(e){return this.container=t(e),this.order=[],this.counterName=this.container.data("counter-name"),this.initTimer()},turnOn:function(){return e.on("@counter-timer","init",this.onInit,this),this.container.on("start.timer",function(t){return function(){return t.initTimer()}}(this))},turnOff:function(){return e.off("@counter-timer","init",this.onInit,this),this.container.off(".timer")},onInit:function(t){if(t.name===this.counterName)return this.container.data("time-left",t.timeLeft),this.initTimer()},initTimer:function(){var t,e,r,n,i,a;return this.stop(this.container),a=0,n=null,this.container.data("time-left")?a=+this.container.data("time-left"):this.container.data("start")&&this.container.data("interval")?(i=Date.parse(this.container.data("start")),e=l(this.container.data("interval")),t=l(this.container.data("duration")||this.container.data("interval")),i=+new Date(i+Math.floor((Date.now()-i)/e)*e),r=Date.now(),i+t<r?a=0:(a=(i+t-r)/1e3,n=function(t){return function(){return t.initTimer()}}(this))):this.container.data("end")&&(a=(Date.parse(this.container.data("end"))-Date.now())/1e3),this.start(this.container,a,n)},start:function(e,r,n){var i,a;return e=t(e),"string"==typeof r&&(r=+r),this.order=[],this.order.push("days","hours","minutes"),e.data("no-seconds")||this.order.push("seconds"),i=function(r){return function(){var i;if(r.stop(e),n&&n(e),i=e.data("flip-callback"))return t.isArray(i)||(i=[i]),t.each(i,function(e,r){var n;if(n=t(r.selector),r.modifier&&n.addClass(r.modifier),r["modifier-remove"])return n.removeClass(r["modifier-remove"])})}}(this),r<=0?i():(c&&e.find(".bTimer__eItemWrap").css("perspective","none"),p.call(this,e,r),a=setInterval(function(t){return function(){return r<=0?i():(r--,p.call(t,e,r))}}(this),1e3),e.data("flip-timer",a),a)},stop:function(e){var r;if(e=t(e),r=e.data("flip-timer"))return clearInterval(r),e.data("flip-timer",null)},fill:function(t,e){return a(t,o(e||0),this.order)}}})}).call(this);
//# sourceMappingURL=bTimer.js.map
