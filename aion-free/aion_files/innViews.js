(function(){define("bGamePanel__base__view",["global/utils/gamepanel","bGamePanel__statusProgress__view"],function(e,t){return{createViewFor:function(i){return Inn.View.extend(e.extendInnViewProto(t.prototype,{_checkTemplates:e.noop(),initialize:function(){return this.on("ready",function(e){return function(){return e._initElements()}}(this)),Inn.View.prototype.initialize.call(this,this.options),this.serviceId=this.model.get("Game/current.serviceId"),this.model.set("serviceId",this.serviceId),this.initBindings()},options:Object.assign({id:"bGamePanel__status",i18nRequire:["i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__defaultState"},i)}))}}})}).call(this),function(){define("bGamePanel__betaTestRequesting__view",["packages/event-bus"],function(e){return Inn.View.extend({events:{"submit .bGamePanel__eRequestBlock":"sendBetaTestRequest"},initialize:function(e){return Inn.View.prototype.initialize.call(this,this.options),this.options.l4g=e.l4g,this.serviceId=this.options.model.get("Game/current.serviceId")},sendBetaTestRequest:function(t){return t.preventDefault(),e.trigger("@game-purchase","purchase",this.serviceId)},options:{id:"bGamePanel__status",i18nRequire:["i18n!Interface","i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__betaTestRequesting"}})})}.call(this),function(){define("bGamePanel__components__view",["global/utils/gamepanel","bGamePanel__statusProgress__view"],function(e,t){return Inn.View.extend(e.extendInnViewProto(t.prototype,{events:e.extendInnViewProto(t.prototype.events,{"click .jsGamePanel__ErrorBlockComponents__eInstallComponent":"_installComponent"}),_checkTemplates:e.noop(),initialize:function(e){return this.on("ready",function(e){return function(){return e._initElements()}}(this)),Inn.View.prototype.initialize.call(this,this.options),this.serviceId=this.options.model.get("Game/current.serviceId")},_installComponent:function(e){var t;return t={componentId:$(e.currentTarget).data("component-id"),serviceId:this.serviceId},this.options.l4g.send("installComponent",t),!1},options:{id:"bGamePanel__status",i18nRequire:["i18n!Interface","i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__components"}}))})}.call(this),function(){define("bGamePanel__error703__view",function(){return Inn.View.extend({events:{"click #jsGamePanel__ErrorBlock__eButton_ProgressResumeYes":"_resumeProgress","click #jsGamePanel__ErrorBlock__eButton_ProgressResumeNo":"_stopProgress"},initialize:function(e){return Inn.View.prototype.initialize.call(this,this.options),this.serviceId=this.options.model.get("Game/current.serviceId")},_resumeProgress:function(){return this.options.l4g.send("update",{serviceId:this.serviceId}),this._cleanError()},_stopProgress:function(){return this.options.l4g.send("getStatus",{serviceId:[this.serviceId]}),this._cleanError()},_cleanError:function(){return this.model.unset("L4G.Application/in-error.code")},initBindings:function(){var e,t,i,n;e=this,t=this.eventRoutes;for(i in t)n=t[i],this.model.on(_.template(i)(e),_.bind(this._useWhenUnlocked,this,this[n]));return!0},_useWhenUnlocked:function(e){var t,i,n;return n=this,t=Array.prototype.slice.call(arguments,1),i=function(){return e.apply(n,t)},this._locked?this._eventQueue.push(i):i()},options:{id:"bGamePanel__status",i18nRequire:["i18n!Interface","i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__error703"}})})}.call(this),function(){define("bGamePanel__error725__view",["packages/backbone","packages/tailbone","jade_templates"],function(e){return Inn.View.extend({events:{"click #jsGamePanel-btnFixGame":"_startRepair","click #jsGamePanel-btnRefresh":"_refreshState"},_startRepair:function(){return this.options.model.clearErrors(),this.options.l4g.send("repair",{serviceId:this.serviceId,isFullUpdate:!0})},_refreshState:function(){return location.reload()},initialize:function(e){return Inn.View.prototype.initialize.call(this,this.options),this.serviceId=this.options.model.get("Game/current.serviceId")},options:{id:"bGamePanel__status",i18nRequire:["i18n!Interface","i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__error725"}})})}.call(this),function(){define("bGamePanel__justInstalled__view",function(){return Inn.View.extend({events:{"click #jsBtnJustInstalled":"_goToPlayPageLocaly"},initialize:function(e){return Inn.View.prototype.initialize.call(this,this.options),this.serviceId=this.options.model.get("Game/current.serviceId")},_goToPlayPageLocaly:function(){return this.model.unset("Layout/finished."+this.serviceId),this.model.set("Layout/needRender",!0),this.render(!1,!0)},options:{id:"bGamePanel__status",i18nRequire:["i18n!Interface","i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__justInstalled"}})})}.call(this),function(){var e={}.hasOwnProperty;define("bGamePanel__layout__view",["module","packages/l4gApp","l4g/assets/app-interface","packages/backbone","packages/che","block!singleplayer/purchase/conditions","packages/event-bus","packages/4game-api-client","packages/jquery","streams/events","global/utils","global/utils/gamepanel","i18n!Interface","i18n!Game-Panel"],function(t,i,n,s,a,r,o,l,c,u,d,h){var m,p,g,f,v,P,G,I,b,w,S,E;return I=a.events,E=d.toTimestamp,g={INSUFFICIENT_DISKSPACE:703,UPDATE_ERROR:704,HOST_CANT_CONNECT_TO_SERVICE:713,AUTOUPDATE_FAILED:714,EXTENSION_CANT_CONNECT_TO_HOST:715,COMPONENT_REQUIRED:724,COMPONENT_INSTALL_ERROR:725},f={"enable-multifactor":FOURGE.LAUNCHER_ERROR_CODE.UBERSECURITY_TURNED_OFF,"change-country":FOURGE.LAUNCHER_ERROR_CODE.COUNTRY_BLOCKED},P={UNAVAILABLE:"unavailable",PENDING:"pending",FAILURE:"failure",REQUESTED:"requested",REQUESTING:"requesting",NOT_REQUESTED:"not_requested",CLOSED:"closed"},v={COMMON:1,UNITY:2},S={status:{idle:"idle",progress:"progress",success:"success",error:"error"},templates:{progress:"bGamePanel__pluginUpdateProgress",success:"bGamePanel__pluginUpdateSuccess",reload:"bGamePanel__pluginUpdateReload",error:"bGamePanel__pluginUpdateError"},waitTimeout:18e4,timer:null,prevStatus:null},w=!1,b=!1,G={templates:{npapi:"bGamePanel__depricationNotifierNPAPI"}},p="4g-game-versions",m=Inn.View.extend({SERVICE_ERROR_CODE:g,events:{"click #jsGamePanel-btnToCommon":"_flipToFace","click #jsGamePanel-btnToSettings":"_flipToBack","click #bPremiumActions__eAutoImprovement":"_toggleAutoImprovement","click .jsUIIcons__eIcon":"_toggleHint","close .jsUIIcons__eIcon":"_closeHintByTrigger","click .jsGamePanel__eDefaultState__Refresh":"_reloadPage","click .jsGamePanel__eErrorState__InstallPlugin":"_downloadApp"},eventRoutes:{"change:L4G.Application/working-mode":"_checkingStateDebounce","change:L4G.Application/setVersions.need_update":"_checkingStateDebounce","change:L4G.Application/in-status.services.<%= serviceId %>.status":"_checkingStateDebounce","change:L4G.Application/in-status.services.<%= serviceId %>.readyStage":"_checkingStateDebounce","change:L4G.Application/in-status.services.<%= serviceId %>.environment":"_environmentChanged","change:L4G.Application/in-status.services.<%= serviceId %>.info.size":"_checkingStateDebounce","change:L4G.Application/in-status.services.<%= serviceId %>.info.stageSizes":"_checkingStateDebounce","change:L4G.Application/in-status.services.<%= serviceId %>.info.dependencies":"_checkingStateDebounce","change:L4G.Application/in-availableServices.services":"_checkingStateDebounce","change:L4G.Application/in-availableServices.environment":"_environmentChanged","change:L4G.Maintenance/maintenance.services.<%= serviceId %>":"_checkingStateDebounce","change:Layout/services.<%= serviceId %>.cancelState":"_checkingStateDebounce","change:Game/current.account":"_checkingStateDebounce","change:Game/current.account.service_account_id":"_checkUserHasAccount","change:Game/current.account.custom_password":"_renderSettingsPanel","change:Game/current.currentVersion":"_renderSettingsPanel","change:Layout/needRender":"_needRender","change:L4G.Application/in-notification.code":"_checkNotification","change:L4G.Application/message.name":"_checkAppMessage","change:Game/current.betaTestRequestStatus":"_checkingStateDebounce","change:GameData/services.<%= serviceId %>":"checkingGameData"},stateRoutes:{NEED_UPDATE:{view:"bGamePanel__workingModeNeedUpdate__view"},FAULT:{auth:{view:"bGamePanel__workingModeFault__view"},guest:{view:"bGamePanel__workingModeFault__view"}},NORMAL:{not_installed:{auth:{view:"bGamePanel__statusNotInstalled__view"},guest:{view:"bGamePanel__statusNotInstalled__view"}},update_required:{auth:{view:"bGamePanel__statusUpdateRequired__view"},guest:{view:"bGamePanel__statusUpdateRequired__view"}},full_update_required:{auth:{view:"bGamePanel__statusUpdateRequired__view"},guest:{view:"bGamePanel__statusUpdateRequired__view"}},progress:{auth:{view:"bGamePanel__statusProgress__view"},guest:{view:"bGamePanel__statusProgress__view"}},pausing:{auth:{view:"bGamePanel__statusProgress__view"},guest:{view:"bGamePanel__statusProgress__view"}},paused:{auth:{view:"bGamePanel__statusProgress__view"},guest:{view:"bGamePanel__statusProgress__view"}},resuming:{auth:{view:"bGamePanel__statusProgress__view"},guest:{view:"bGamePanel__statusProgress__view"}},canceled:{auth:{view:"bGamePanel__statusProgress__view"},guest:{view:"bGamePanel__statusProgress__view"}},cancelling:{auth:{view:"bGamePanel__statusProgress__view"},guest:{view:"bGamePanel__statusProgress__view"}},installed:{auth:{view:"bGamePanel__statusInstalled__view",blocked:{view:"bGamePanel__statusInstalledButBlocked__view"},ban:{view:"bGamePanel__statusInstalledButBan__view"},maintenance:{view:"bGamePanel__statusInstalledButMaintenance__view"},justFinished:{view:"bGamePanel__justInstalled__view"}},guest:{view:"bGamePanel__statusInstalledButGuest__view",maintenance:{view:"bGamePanel__statusInstalledButMaintenance__view"},justFinished:{view:"bGamePanel__justInstalled__view"}}}},blocked:{blocked:{view:"bGamePanel__statusInstalledButBlocked__view"}},blockedCountry:{blockedCountry:{view:"bGamePanel__statusInstalledButBlockedCountry__view"}},betaTesting:{betaTesting:{view:"bGamePanel__statusInstalledButBlocked__view"},betaTestRequesting:{view:"bGamePanel__betaTestRequesting__view"}},restricted:{not_installed:{gameIsClosing:{template:"bGamePanel__statusNotInstalledButClosed"}},installed:{gameIsClosing:{template:"bGamePanel__statusInstalledButClosed"}}},environment:{notAvailable:{template:"bGamePanel__unavailable"}}},errorHandlers:[{code:g.COMPONENT_INSTALL_ERROR,handler:function(e){return this.model.setError(e),this._show725Error()}},{code:g.COMPONENT_REQUIRED,handler:function(e){return this.model.setError(e),this._show724Error()}},{code:g.INSUFFICIENT_DISKSPACE,handler:function(e){var t,i;if(t=e.code,i=e.extra,this.model.update("L4G.Application","in-error",{data:i,code:t}),e.serviceId===this.serviceId)return this.replacePartial("bGamePanel__status","bGamePanel__error703__view")}},{code:g.UPDATE_ERROR,handler:function(e){var t,i;if(t=e.code,i=e.extra,this.model.update("L4G.Application","in-error",{data:i,code:t}),e.serviceId===this.serviceId)return this.model.setErrorFor(this.serviceId,e),this.options.l4g.send("getStatus",{services:[this.serviceId]})}},{code:g.AUTOUPDATE_FAILED,handler:function(e){var t,i;return t=e.code,i=e.extra,this.model.update("L4G.Application","in-error",{data:i,code:t}),this.model.set("L4G.Application/pluginAutoupdate","error")}},{code:"!",handler:function(e){var t,i;if(this.model.update("L4G.Application","in-error",{data:e.extra,code:e.code}),this.model.setError(e),this._showError(),t=function(i,n){var s,a,r;if(a="","object"==typeof n){a+=">> ";for(s in e)r=e[s],a+=t(s,r)+" | "}else a+=i+":"+n+" | ";return a},i=t("errorObject",e),[g.HOST_CANT_CONNECT_TO_SERVICE,g.EXTENSION_CANT_CONNECT_TO_HOST].indexOf(e.code)<0)return I.trigger("unhandledL4GError",{serviceId:parseInt(this.serviceId,10),code:e.code.toString(),message:i})}}],initialize:function(e,i){var n;return _.extend(this.options,{l4g:e.l4g,model:this.createModelInstance(i),moduleNotify:e.moduleNotify}),this._locked=!1,this._eventQueue=[],this.renderReady=!1,this.settingsPanelIsRendered=!1,this.currentEnvironment="",this.serviceType=1,this.systemWithoutPlugin=!1,this.lastWorkingMode="",this.$window=c(window),this.$document=c(document),this.moduleConfig=t.config(),this.appsRequirements=l.apps.get(),this.isLiteClientReady=!1,["gamesSupportUrls","componentSupportLinks","gamePanelEnvironments","gamePanelErrorSupportLinks"].forEach(function(e){return function(t){if("string"==typeof e.moduleConfig[t])return e.moduleConfig[t]=JSON.parse(e.moduleConfig[t])}}(this)),this.debounceValue=null,this.debounceTimer,this.dependenciesStatuses=new(s.Model.extend({defaults:{lastErroneousComponentId:!1},update:function(e){var t,i,n,s;i=!1;for(n in e)t=e[n],"failed"===t.status&&this.set("lastErroneousComponentId",t.componentId,{silent:!0}),this.set(t.componentId,t.status,{silent:!0}),i=i||"installing"===t.status;return s=this.get("lastErroneousComponentId"),this.set("hasInstallingComponent",i),s&&this.get(s)&&"installed"===this.get(s)&&this.set("lastErroneousComponentId",!1,{silent:!0}),this.change()}})),Inn.View.prototype.initialize.call(this,this.options,[]),this.model=this.options.model,this.urlChecker=function(){var e;return e=c("<a>"),{set:function(t){return e.attr("href","./"!==t?t:window.location.href),this},get:function(t){return e[0][t]}}}(),this.urlChecker.set(location.href),this.pageUrl=this.urlChecker.get("pathname"),this.setupAutoupdateState(),(null!=(n=this.$el)?n.length:void 0)||this.setElement(c("#"+this.options.id)),this.isExternalProcessing=this.$el.data("external-processing"),this.setCurrentGameData(this.serviceId=this.$el.data("service-id")).then(function(e){return function(){return e.getServiceData(e.isExternalProcessing)}}(this)).then(function(e){return function(){return e.initBindings(),e.restoreGameVersion(),e.l4gAppReady(function(){return e.options.l4g.send("getFeature")}),e.checkingGameData()}}(this)).then(function(e){return function(){var t;return e.setupSpecificEnvironmentIfExist(),e.model.get("L4G.Application/started")?e._renderStarted():(t=function(){return e.model.off("change:L4G.Application/started",t),e._renderStarted()},e.model.on("change:L4G.Application/started",t))}}(this)),o.on("@gamepanel","setEnvironments",function(e){return function(t){return e.setAvailableEnvironments(t),e._renderSettingsPanel(),e._flipToBack()}}(this))},createModelInstance:function(e){var t,i;return i=e.clone(),t=function(e){return e.split(":")[1]},e.on("all",function(e){return function(n,s,a,r){var o,l;return"change"===n?(e.prepareData(),void i.change()):(o=t(n))?(e.model.get("Game/current.lightClientOnlyForNewcomers")&&(l="L4G.Application/in-status.services",o===l+"."+e.serviceId+".readyStage"&&(a=void 0),o===l+"."+e.serviceId&&(a.readyStage=void 0),o===l+"."+e.serviceId+".info.stageSizes"&&(a=void 0),o===l+"."+e.serviceId+".info"&&(a.stageSizes=void 0)),i.set(o,a,{silent:!0})):void 0}}(this)),i},setCurrentGameData:function(e){return h.getKeyFromModel(this.model,"GameData/services."+e).then(function(t){return function(i){var n,s;return n=((null!=i?i.accounts:void 0)||[])[0],s={data:i,account:n,title:i.name,serviceId:e,selectedServiceAccountId:"0"},t.model.update("Game","current",s)}}(this))},checkBlockedPlugin:function(e){return this._checkBlockedPlugin(e,!0)},l4gConnected:function(e){return this._checkBlockedPlugin(e,!1)},_checkBlockedPlugin:function(e,t){var i;if(i=b,b=t,i!==b)return this._checkingStateDebounce()},restoreGameVersion:function(){var e,t,i;return t=JSON.parse(localStorage.getItem(p)||"{}"),e=this.model.get("Game/current.serviceId"),i=t[e]||{},this.model.set("Game/current.currentVersion",i.currentVersion),this.model.set("Game/current.newVersion",i.newVersion),this.model.set("L4G.Application/in-status.services."+e+".currentVersion",i.currentVersion),this.model.set("L4G.Application/in-status.services."+e+".newVersion",i.newVersion)},saveGameVersions:function(){var e,t,i,n,s,a;e=JSON.parse(localStorage.getItem(p)||"{}"),n=this.model.get("GameData/services");for(s in n)t=n[s],a=this.model.get("L4G.Application/in-status.services."+s+".currentVersion"),i=this.model.get("L4G.Application/in-status.services."+s+".newVersion"),e[s]=e[s]||{},a&&(e[s].currentVersion=a),i&&(e[s].newVersion=i);return localStorage.setItem(p,JSON.stringify(e)),this.restoreGameVersion()},getServiceData:function(e){var t;return e?c.ajax("/launcher/gamepanelData/?serviceId="+this.serviceId).then(function(e){return function(t){var i,n,s,a;return a=window.location.pathname.replace(/^\/|\/$/g,"").split("/"),s=+t.serviceId,i=a[1]||"install",n="/"+e.model.get("GameData/services."+s+".key")+"/"+("play"===i?"install":"play")+"/",e.processServiceData({serviceId:s,isPromoPrice:t.isPromoPrice,game:t.game,"4gameApp":t["4gameApp"],action:{action:i,oppositeUrl:n},selectedServiceAccountId:t.lastUsedAccount,features:t.features,premium:t.premium||!1,premiumMinPrice:t.premiumMinPrice,disableStatus:t.disableStatus,flags:t.flags})}}(this)):(t=c.Deferred().resolve(),t.then(function(e){return function(){return e.processServiceData(e.$el.data())}}(this)))},processServiceData:function(e){var t,i,n,s,a,r,d,h,m,p,_,g;this.flags=e.flags||{},this.gameData=e.game,this.pageData=e.action,this.appData=e["4gameApp"],this.premiumData=e.premium,this.isPromoPrice=e.isPromoPrice,this.disableStatus=e.disableStatus,this.premiumMinPrice=e.premiumMinPrice,this.selectedServiceAccountId=e.selectedServiceAccountId,this.premiumData&&(this.premiumData.isPromoPrice=this.isPromoPrice,this.premiumData.premiumMinPrice=this.premiumMinPrice),p=this.appData;for(d in p)g=p[d],this.model.set("4game/app."+d,g);this.model.set("4game/app.size",window.FOURGE.utils.toLocaleFormat(this.appData.size)),this.model.set("Game/current.serviceId",parseInt(this.serviceId,10)),this.model.set("Game/current.statusPrefix","L4G.Application/in-status.services."+this.serviceId),this.model.set("Game/current.selectedServiceAccountId",this.selectedServiceAccountId),this.model.set("Game/current.actionPage",this.pageData.action),this.model.set("Game/current.oppositeUrl",this.pageData.oppositeUrl),this.model.set("Game/current.premium",this.premiumData),this.model.set("Game/current.disableStatus",this.disableStatus),this.model.set("Game/current.flags",this.flags),this.model.set("Game/current.betaTestRequestStatus",P.UNAVAILABLE);for(d in this.gameData)this.gameData.hasOwnProperty(d)&&this.model.set("Game/current."+d,this.gameData[d]);return this.model.set("Game/current.downloadSize",window.FOURGE.utils.toLocaleFormat(this.gameData.downloadSize)),this.model._flatten(this.moduleConfig.gamePanelErrorSupportLinks,"GamePanel/supportLinks"),this.model._flatten(this.moduleConfig.gamesSupportUrls,"GamePanel/gamesSupportUrls"),this.model._flatten(this.moduleConfig.componentSupportLinks,"GamePanel/componentSupportLinks"),this.model._flatten(this.moduleConfig.wikiBaseUrl,"GamePanel/wikiBaseUrl"),this.setAvailableEnvironments(),this._checkBetaTestRequestStatus(),m=c.Deferred(),this.flags.lightClientOnlyForNewcomers?l.get("profiles/#{userId}").then(function(e){return function(t){var i,n;if(n=t.apps,i=null!=n?n[e.serviceId]:void 0)return e.model.set("Game/current.lightClientOnlyForNewcomers",i.lastActivity)}}(this)).then(m.resolve,m.resolve):m.resolve(),this.flags.needApplyForBetaTest?(r=c.Deferred(),_=c.Deferred(),h=l.get("users/#{userId}/apps/"+this.serviceId+"/products"),n=P.PENDING,a=P.REQUESTING,s=P.REQUESTED,i=P.NOT_REQUESTED,t=P.FAILURE,this.model.set("Game/current.betaTestRequestStatus",a),require(["block!singleplayer/purchase"],function(e){return function(n){var l,d,m,p;return p=e.serviceId.toString(),e.gameBetaTestApplyWidget=c.extend({},n,{init:function(){return this.restrictWithServiceId=p,n.init.apply(this,arguments)},getCheckConditionsParams:function(){return{checkEmail:!0}}}),o.on("@game-purchase","orderUpdated",l=function(n){var r;if(n.serviceId===p){if("idle"===n.state)return r="success"===n.status?s:"failure"===n.status?t:i,e.model.set("Game/current.betaTestRequestStatus",r),_.resolve(r);if("progress"===n.state)return e.model.set("Game/current.betaTestRequestStatus",a)}}),e.gameBetaTestApplyWidget.init(),e.gameBetaTestApplyWidget.turnOn(),m=e.gameBetaTestApplyWidget._config.products[e.serviceId],d=m.map(function(e){var t;return t=e.productId}),h.then(function(t){var i,n,s,r;return n=t.products,i=n.filter(function(e){var t;if(t=e.referencePrices[0])return~d.indexOf(t.extra.billingProductId)}),r=u.stream.filter(u.filter.envelope("user","interaction")).map(".payload").filter(function(t){var i,n,s;return n=t[0],s=t[1],i=s.appId,"purchase-succeeded"===n&&~[""+e.serviceId,"4game"].indexOf(""+i)}).onValue(function(){return r(),e.gameBetaTestApplyWidget.turnOff(),o.off("@game-purchase","orderUpdated",l),e.model.set("Game/current.betaTestRequestStatus",a),e.updateUserRolesAndRender()}),s=i.filter(function(e){var t;return t=e.offer.prices,!t.length}).map(function(e){var t;return t=e.productId}),P[s.length?"REQUESTED":"NOT_REQUESTED"]}).then(r.resolve,function(){return r.resolve(t)})}}(this)),c.when(r,_,m).then(function(e,n){var a;return a=[e,n],~a.indexOf(t)?t:~a.indexOf(s)?s:i}).then(function(e){return function(t){return e.model.set("Game/current.betaTestRequestStatus",t),e.model}}(this))):m.then(function(e){return function(){return e.model}}(this))},updateUserRolesAndRender:function(){var e;return e=!0,this.getServiceData(this.isExternalProcessing).then(function(t){return function(){return c.when(FOURGE.GameData.requestData(e),FOURGE.UserData.requestData(e))}}(this)).then(function(e){return function(){return e.checkingGameData()}}(this)).then(function(e){return function(){return e._checkingStateDebounce()}}(this))},setAvailableEnvironments:function(e){var t;return t=c.extend({},this.moduleConfig.gamePanelEnvironments.all||{},this.moduleConfig.gamePanelEnvironments[this.serviceId]||{},e||{}),_.isEmpty(t)&&(t=null),this.model._flatten(t,"GamePanel/availableEnvironments")},setupSpecificEnvironmentIfExist:function(){var e,t;if(e=this.userGameData.gameGuid)return t=function(t){return function(){return n.get().send("setEnvironment",{name:e,serviceId:t.serviceId})}}(this),this.l4gAppReady(t)},l4gAppReady:function(e){var t,i;return i=n.get(),i.connected()?e():(t=function(){return e(),i.off("connect",t)},i.on("connect",t))},setupAutoupdateState:function(){var e,t;return e=S.status.idle,this.model.on("change:L4G.Application/pluginAutoupdate",function(e){return function(t,i){return e.handleAutoupdateStatusChange(i)}}(this)),t=JSON.parse(localStorage.getItem("l4gAutoUpdate")||"{}"),t.date&&t.date+S.waitTimeout>Date.now()?e=t.status:localStorage.removeItem("l4gAutoUpdate"),this.on("ready",function(t){return function(){return t.model.set("L4G.Application/pluginAutoupdate",e)}}(this))},handleAutoupdateStatusChange:function(e){var t;if(e!==S.status.idle)switch(S.timer&&clearTimeout(S.timer),t=function(){return localStorage.removeItem("l4gAutoUpdate")},e){case S.status.progress:switch(localStorage.setItem("l4gAutoUpdate",JSON.stringify({status:e,date:Date.now()})),this._replaceTemplate("bGamePanel__status",S.templates.progress),S.timer=setTimeout(t,S.waitTimeout),i.version){case 2:case 3:return I.trigger("autoUpdate:started")}break;case S.status.success:switch(t(),i.version){case 1:return navigator.plugins.refresh(!1),this.model.set("L4G.Application/pluginAutoupdate",S.status.idle),this._checkingStateDebounce();case 2:case 3:return this.model.set("L4G.Application/pluginAutoupdate",S.status.idle),I.trigger("browserPlugins:refresh"),this._checkingStateDebounce()}break;case S.status.error:return this._replaceTemplate("bGamePanel__status",S.templates.error),t()}},lock:function(){return this._locked=!0},unlock:function(){var e,t;if(this._locked=!1,this._eventQueue.length){for(e=this._eventQueue.length,t=[];e>0;)this._eventQueue.shift()(),t.push(e--);return t}},prepareData:function(){var e,t,i,n,s,a,r,o,l,c;return a=this.model.get("L4G.Application/in-status.services."+this.serviceId)||{info:{}},n=a.last_ec,r=a.info,e=r.checking,s=r.progress,l=this.model.get("L4G.Application/in-status.services."+this.serviceId+".status"),c=["resuming","pausing","cancelling","canceled"],o="not_installed",t="true"===e,i="progress"===l&&t&&!Math.floor(parseFloat(s)),i||~c.indexOf(l)?o="prepare":"progress"===l?o="progress":"paused"===l&&(o="pause"),this.model.set("GamePanel/state",o),this.model.set("GamePanel/supportLink",this.getSupportLinks(this.model.getCurrentErrorCode()||n))},replacePartial:function(e,t){var i;return!!(i=this.children.get(e))&&(require([t],function(t){return function(i){var n;return n=new i({model:t.options.model,l4g:t.options.l4g,moduleNotify:t.options.moduleNotify}),n.on("ready",function(){return t.replacePartialFinishStep(e,n)}),n.$el.attr("id",n.options.id).attr("data-view-template",n.options.templateName).data("view-template",n.options.templateName).addClass("bPartial"),n.render()}}(this)),this)},replacePartialFinishStep:function(e,t){var i;return!!(i=this.children.get(e))&&(t.$el.replaceAll(i.$el),this.children.remove(i),null==t._parent&&(t._parent=this),this.children.add(t),i.destroy(),i=null,t.off("ready"),"bGamePanel__settings"!==t.id&&(this.$document.trigger("game-panel-rendered",t.$el),I.trigger("game-panel-rendered",t.$el)),this)},_replaceTemplate:function(e,t){var i,n;return!!(n=this.children.get(e))&&(i=new Inn.View(_.extend({},n.options,{templateName:t})),i.on("ready",function(t){return function(){return t.replacePartialFinishStep(e,i)}}(this)),i.$el.attr("data-view-template",i.options.templateName).data("view-template",i.options.templateName).addClass("bPartial"),i.render(),this)},_renderStarted:function(e,t,i){var n;return n=this,!!this.$el.length&&(this.lock(),this.on("ready",function(){return this.off("ready"),n._checkingStateDebounce(),this.unlock(),this._checkBrowserSize(),"function"==typeof e&&(t=t||n,e.call(t))}).render(i))},_toggleHint:function(e){var t,i;return i=c(e.currentTarget),t=i.closest(".bHelp"),t.hasClass("bUIHint__mState_Open")?this._closeHint(t):this._showHint(t,i)},_closeHint:function(e,t,i){return t=t||e.data("$hintPopup"),i=i||e.data("$hintCloseIcon"),i.off("click.AutoProlongationHint"),this.$document.off("l4g-panel-became-compact.AutoProlongationHint l4g-panel-became-expand.AutoProlongationHint"),e.removeClass("bUIHint__mState_Open").removeData("$hintPopup").removeData("$hintCloseIcon"),t.removeClass("bUIHint__ePopup__mDisplay_Block").removeData("$helpBlock").appendTo(e)},_closeHintByTrigger:function(e){var t;if(t=c(e.currentTarget).closest(".bHelp"),t.hasClass("bUIHint__mState_Open"))return this._closeHint(t)},_showHint:function(e,t){var i,n,s,a,r;return this.$el.find(".jsUIIcons__eIcon").trigger("close"),a=e.find(".jsUIHint__ePopup"),s=a.find(".jsUIHint__eClose"),i=c("#GamePanel"),n=c(".jsGamePanel"),r={top:t.offset().top-n.offset().top,left:t.offset().left-n.offset().left},e.addClass("bUIHint__mState_Open"),e.data("$hintPopup",a),e.data("$hintCloseIcon",s),a.appendTo(i).css({left:Math.round(r.left)-a.outerWidth()-13+"px",top:Math.round(r.top)-15+"px"}).addClass("bUIHint__ePopup__mDisplay_Block").data("$helpBlock",e),s.one("click.AutoProlongationHint",function(t){return function(){return t._closeHint(e,a,s)}}(this)),this.$document.on("l4g-panel-became-compact.AutoProlongationHint l4g-panel-became-expand.AutoProlongationHint",function(t){return function(){return t._closeHint(e)}}(this))},_toggleAutoImprovement:function(e){var t,i;return t=c(e.currentTarget),i=t.data("improvement-state")?0:1,c.getJSON(t.data("improvement-url"),{enabled:i},function(e){return function(i){if(i.result)return t.data("improvement-state",!t.data("improvement-state")),t.data("improvement-state")?t.text(window.Inn.i18n.__t__("Game-Panel","AutoImprovementOn")):t.text(window.Inn.i18n.__t__("Game-Panel","AutoImprovementOff")),e.options.l4g.forceUpdateUserData();throw Error("GamePanel: AutoImprovement ajax request return fail")}}(this)),e.preventDefault()},_refreshStateOnPremiumBought:function(e,t){return this.model.set("Layout/premiumJustBought."+this.serviceId,!0),this.model.set("Layout/premiumIsRenewal."+this.serviceId,!!t),this.model.set("Layout/premiumRenewalDays."+this.serviceId,e||0),this._checkingStateDebounce()},_eventRouteExecuteList:{},initBindings:function(){var e,t,n,s,a,r,o,l;s=this,i.backend.on("unsupported",this.checkBlockedPlugin,this),i.backend.on("connect",this.l4gConnected,this),a=this.errorHandlers;for(n in a)e=a[n],this.model.attachErrorListener(e.code,e.handler,!1,this);r=this.eventRoutes;for(o in r)l=r[o],t=_.template(o)(s),this.model.on(t,this._eventRouteExecuteList[t+"."+this.cid]=_.bind(this._useWhenUnlocked,this,this[l]));return I.bind("pageTransition:success",this.checkIfDestroyNeeded,this,{isSync:!0}),I.bind("premium-just-bought",this._refreshStateOnPremiumBought,this),I.bind("browserPlugins:refresh_fail",this._refreshStateOnPluginsRefreshFail,this),I.bind("country-blocked",this._handleCountryBlocked,this),I.bind("ubersecurity-turned-off",this._handleUbersecurityTurnedOff,this),this.$window.on("resize.GamePanelLayout_"+this.serviceId,_.throttle(_.bind(this._checkBrowserSize,this),300)),!0},_handleCountryBlocked:function(){return this._addFourgeError(FOURGE.LAUNCHER_ERROR_CODE.COUNTRY_BLOCKED),this._showBlockedcountryView()},_handleUbersecurityTurnedOff:function(){return this._addFourgeError(FOURGE.LAUNCHER_ERROR_CODE.UBERSECURITY_TURNED_OFF),this._showBlockedView()},_refreshStateOnPluginsRefreshFail:function(){return w=!0,this._checkingStateDebounce()},_checkBrowserSize:function(){return this.$el.toggleClass("bGamePanelWrap__mBrowserHeight_Small",c("body").height()<700)},_showBlockedView:function(){return this.replacePartial("bGamePanel__status",this.stateRoutes.blocked.blocked.view)},_showBlockedcountryView:function(){return this.replacePartial("bGamePanel__status",this.stateRoutes.blockedCountry.blockedCountry.view)},_showInstallExtension:function(){return this._addFourgeError(FOURGE.LAUNCHER_ERROR_CODE.EXTENSION_NOT_INSTALLED),this._showBlockedView()},_show724Error:function(){var e,t;if(t=this.model.get("L4G.Application/in-status.services."+this.serviceId+".status"),e=this.model.get("L4G.Application/in-status.services."+this.serviceId+".info.dependencies"),"installed"===t)return this.hasNotInstalledComponents(e)?(this._renderComponentDependencies(e),!0):(this._cleanErrorsByCode(724),this._checkingState(),!0)},_show725Error:function(){var e,t,i,n,s;return t=this.model.get("L4G.Application/in-status.services."+this.serviceId+".info.dependencies"),s=this.model.get("L4G.Application/in-status.services."+this.serviceId+".last_ec"),n=this.dependenciesStatuses.get("lastErroneousComponentId"),i=this._appFeatureIsSupported("dependencyCheck"),e=function(e){return function(){return e.options.l4g.send("getStatus",{services:[e.serviceId]})}}(this),i&&(e=function(e){return function(){return e.options.l4g.send("dependencyCheck",{serviceId:0|e.serviceId})}}(this)),setTimeout(e,1e4),this.model.set("Game/current.dependencies",t),this.model.set("Game/current.dependencies.error",!(!n&&!s)),this.model.set("Game/current.dependencies.last_ec",s),this.model.set("Game/current.dependencies.dependencyCheckable",i),this.model.set("Game/current.dependencies.lastErroneousComponentId",n),this.replacePartial("bGamePanel__status","bGamePanel__error725__view"),!0},_showError:function(){var e,t;if(e=this.model.getCurrentErrorCode(),!(e&&(t=this["_show"+e+"Error"],t&&"function"==typeof t&&t.call(this))))return this._replaceTemplate("bGamePanel__status","bGamePanel__unhandledError")},_appFeatureIsSupported:function(e){var t;return t=this.model.get("L4G.Application/in-setFeature.features")||[],_.indexOf(t,e)>=0},_cleanErrorsByCode:function(e){var t,i,n,s,a;if(t=this.model.getCurrentErrorCode(),i=parseInt(t,10),"number"==typeof e&&e===i)return this._cleanErrors();if(!_.isArray(e))return!1;for(s=0,a=e.length;s<a;s++)if(n=e[s],n===i)return this._cleanErrors()},_cleanErrors:function(){return this.model.clearErrors(),!0},_useWhenUnlocked:function(e){
var t,i,n;return n=this,t=Array.prototype.slice.call(arguments,1),i=function(){return e.apply(n,t)},this._locked?this._eventQueue.push(i):i()},removeBindings:function(){var e,t,n,s,a,r,o,l,c;s=this,i.backend.off("unsupported",this.checkBlockedPlugin,this),i.backend.off("connect",this.l4gConnected,this),I.unbind("pageTransition:success",this.checkIfDestroyNeeded,this),a=this.eventRoutes;for(l in a)c=a[l],t=_.template(l)(s),this.model.off(t,this._eventRouteExecuteList[t+"."+this.cid]),delete this._eventRouteExecuteList[t+"."+this.cid];I.unbind("premium-just-bought",this._refreshStateOnPremiumBought,this),I.unbind("country-blocked",this._handleCountryBlocked),I.unbind("ubersecurity-turned-off",this._handleUbersecurityTurnedOff,this),this.$document.off(".GamePanelLayout_"+this.serviceId),this.$window.off(".GamePanelLayout_"+this.serviceId),r=this.errorHandlers,o=[];for(n in r)e=r[n],o.push(this.model.detachErrorListener(e.code,e.handler,this));return o},destroy:function(){var e;return null!=(e=this.gameBetaTestApplyWidget)&&e.turnOff(),this.removeBindings(),this.off("ready"),Inn.View.prototype.destroy.call(this)},checkIfDestroyNeeded:function(e){var t,i,n;if(n=c("#"+(null!=(i=this.options)?i.id:void 0)),null!=e&&this.urlChecker.set(e.transition.state.url),this.pageUrl!==(t=this.urlChecker.get("pathname"))&&(this.pageUrl=t,this.model.unset("Layout/premiumJustBought."+this.serviceId)),"function"==typeof this.destroy&&(!n.length||n.length&&n[0]!==(this.el[0]||this.el)))return this.destroy(),!0},options:_.extend({id:"GamePanel",templateFolder:"bGamePanel/",templateName:"bGamePanel__layout",classFace:"bGamePanelWrap__mShow_Face",classFaceFull:"bGamePanelWrap__mShow_FaceFull",classBack:"bGamePanelWrap__mShow_Back",classBackFull:"bGamePanelWrap__mShow_BackFull"},Inn.View.prototype.options),_needRender:function(){return!!this.model.get("Layout/needRender")&&(this._checkingStateDebounce(),this.model.unset("Layout/needRender"))},_environmentChanged:function(e,t,i){return this._checkingEnvironment(e,t,i),this._renderSettingsPanel()},_checkingEnvironment:function(e,t,i){var n;return this.currentEnvironment=this.model.get("L4G.Application/in-availableServices.environment"),this.currentEnvironment&&"live"!==this.currentEnvironment?(this.model.set("Game/current.environment",this.currentEnvironment.toUpperCase()),n=this.model.get("Game/current.title")+"&nbsp;["+this.currentEnvironment.toUpperCase()+"]"):(this.model.unset("Game/current.environment"),n=this.model.get("Game/current.title")),this.$el.find(".jsServiceTitle").html(n),!0},_checkingAvailable:function(){var e,t,i,n;if(n=this.model.get("L4G.Application/in-availableServices.services"),null==n)return!0;for(t=0,i=n.length;t<i;t++)if(e=n[t],e===this.serviceId)return!0;return!1},_showStatusMessage:function(e,t){var i;return i=c(".bGamePanelFlipper"),i.triggerHandler("clear.bInfoMessage"),i.triggerHandler("show.bInfoMessage",[e,t])},_setPromoGame:function(){var e,t,i,n,s;if(this.userGameData.promo_games.length){for(i=[],n=this.userGameData.promo_games,e=0,t=n.length;e<t;e++)s=n[e],s===this.serviceId||this.model.get("L4G.Maintenance/maintenance.services."+s)||i.push(s);this.userGameData.promo_game=i.map(function(e){return function(t){return e.model.get("GameData/services."+t)}}(this)).filter(Boolean)}return this},_checkNotification:function(e,t,i){switch(t=parseInt(t,10)){case 801:return this.model.set("L4G.Application/pluginAutoupdate",S.status.progress);case 802:return this._cleanErrorsByCode([710,711,713,714]),this.model.set("Layout/needRender",!0),this.model.get("L4G.Application/pluginAutoupdate")===S.status.progress&&this.model.set("L4G.Application/pluginAutoupdate",S.status.success),this._checkingStateDebounce()}},_checkAppMessage:function(e,t){if("reloadPlugin"===t)return this.model.set("L4G.Application/pluginAutoupdate",S.status.success)},_canPlay:function(){return!(null!=this.flags&&(!this.flags.playGame||E(this.flags.playGame)>Date.now()))},_canInstall:function(){return!(null!=this.flags&&(!this.flags.installGame||E(this.flags.installGame)>Date.now()))},_checkingStateDebounce:function(){return null==this.debounceValue&&(null!=this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(function(e){return function(){return e._checkingState.apply(e,e.debounceValue),e.debounceValue=null}}(this),300)),this.debounceValue=Array.prototype.slice.call(arguments,0)},_checkingState:function(){var e,t,i,n,s,a,r,o,l,c,d,h,m,p,_,g;if(this.model.getCurrentErrorCode())return this._showError(),!1;if(i=this.model.get("L4G.Application/pluginAutoupdate"),i!==S.status.idle)return this.handleAutoupdateStatusChange(i);if(o=this.model.get("L4G.User/UserData.user").isAuthed()?"auth":"guest",e=this.model.get("L4G.Application/working-mode"),e!==this.lastWorkingMode&&(this.lastWorkingMode=e,this.settingsPanelIsRendered=!1),("function"==typeof window.getUnsupportedBrowserError?window.getUnsupportedBrowserError():void 0)&&(this.systemWithoutPlugin=!0),w)return this._replaceTemplate("bGamePanel__status",S.templates.reload),this;if(this.checkingCountryBlock())return this._showBlockedcountryView(),this;if(!this._checkingAvailable())return this._checkingEnvironment(),this._checkBtnSettingShow(),this.settingsPanelIsRendered||this._renderSettingsPanel(),this._replaceTemplate("bGamePanel__status",this.stateRoutes.environment.notAvailable.template),this;if(this.model.get("Game/current.betaTestRequestStatus")!==P.UNAVAILABLE)return this.replacePartial("bGamePanel__status",this.stateRoutes.betaTesting.betaTestRequesting.view),this;if(this.checkingBetaTesting(this.userGameData))return this._showBlockedView(),this;if(s=this._canPlay(),n=this._canInstall(),h=this.model.get("L4G.Application/in-status.services."+this.serviceId)||{info:{}},t=h.action,c=h.last_ec,d=h.readyStage,m=h.info,l=m.dependencies,r=this.model.get("L4G.Application/in-status.services."+this.serviceId+".status"),this.saveGameVersions(),!n&&this.flags.playGameOnlyWithServiceAccount||!s&&this.flags.playGameOnlyWithServiceAccount)return g=this.stateRoutes.restricted[r]||this.stateRoutes.restricted.installed,this._replaceTemplate("bGamePanel__status",g.gameIsClosing.template),this;switch(e){case"NEED_UPDATE":null!=this.stateRoutes.NEED_UPDATE.view&&(null!=this.stateRoutes.NEED_UPDATE.view?this.replacePartial("bGamePanel__status",this.stateRoutes.NEED_UPDATE.view):this._replaceTemplate("bGamePanel__status",this.stateRoutes.NEED_UPDATE.template));break;case"NORMAL":case"FAKE":case"SAFE":if(a=this.model.get("Game/current.account"),!r)return!1;d>0&&~["progress","paused"].indexOf(r)&&(r="installed",this.isLiteClientReady||(this.isLiteClientReady=!0,u.log("@gamepanel","interaction","lite-client-ready",{serviceId:this.serviceId}))),"finished"===r?this.model.set("Layout/finished."+this.serviceId,t):"installed"!==r||"install"!==this.model.get("Layout/finished."+this.serviceId)&&"play"===this.model.get("Game/current.actionPage")?"installed"===r&&this.model.get("L4G.Maintenance/maintenance.services."+this.serviceId)?(this._setPromoGame(),this.replacePartial("bGamePanel__status",this.stateRoutes.NORMAL[r][o].maintenance.view)):"installed"===r&&null!=a&&(a.havingBan||a.havingBlockedErrors)?a.havingBan?this.replacePartial("bGamePanel__status",this.stateRoutes.NORMAL[r][o].ban.view):a.havingBlockedErrors&&this.replacePartial("bGamePanel__status",this.stateRoutes.NORMAL[r][o].blocked.view):"installed"===r&&null!=a&&a.needSubscription&&3===a.status?this.replacePartial("bGamePanel__status",this.stateRoutes.NORMAL[r][o].blocked.view):"installed"!==r||null==a||s?"installed"===r&&this.checkingUbersecurity()?this._showBlockedView():"installed"===r&&this.hasNotInstalledComponents(l)&&725===c?this._show725Error():"auth"===o&&"installed"===r&&this.hasNotInstalledComponents(l)?this._renderComponentDependencies(l):null!=(null!=(p=this.stateRoutes.NORMAL[r])?p[o]:void 0)&&(null!=this.stateRoutes.NORMAL[r][o].view?this.replacePartial("bGamePanel__status",this.stateRoutes.NORMAL[r][o].view):this._replaceTemplate("bGamePanel__status",this.stateRoutes.NORMAL[r][o].template)):this.replacePartial("bGamePanel__status",this.stateRoutes.NORMAL[r][o].blocked.view):this.replacePartial("bGamePanel__status",this.stateRoutes.NORMAL[r][o].justFinished.view),this.settingsPanelIsRendered||this._renderSettingsPanel();break;case"FAULT":if(b)return this._showInstallExtension(),this;this.serviceType===v.UNITY&&this.systemWithoutPlugin?(r="installed",a=this.model.get("Game/current.account"),this.model.get("L4G.Maintenance/maintenance.services."+this.serviceId)?(this._setPromoGame(),this.replacePartial("bGamePanel__status",this.stateRoutes.NORMAL[r][o].maintenance.view)):null!=a&&(a.havingBan||a.havingBlockedErrors)?a.havingBan?this.replacePartial("bGamePanel__status",this.stateRoutes.NORMAL[r][o].ban.view):a.havingBlockedErrors&&this.replacePartial("bGamePanel__status",this.stateRoutes.NORMAL[r][o].blocked.view):null!=(null!=(_=this.stateRoutes.NORMAL[r])?_[o]:void 0)&&(null!=this.stateRoutes.NORMAL[r][o].view?this.replacePartial("bGamePanel__status",this.stateRoutes.NORMAL[r][o].view):this._replaceTemplate("bGamePanel__status",this.stateRoutes.NORMAL[r][o].template))):(this.settingsPanelIsRendered||this._renderSettingsPanel(),null!=this.stateRoutes.FAULT[o]&&(null!=this.stateRoutes.FAULT[o].view?this.replacePartial("bGamePanel__status",this.stateRoutes.FAULT[o].view):this._replaceTemplate("bGamePanel__status",this.stateRoutes.FAULT[o].template)));break;default:this._replaceTemplate("bGamePanel__status",this.stateRoutes.FAULT[o].template)}return this._checkBtnSettingShow(),this},_checkUserHasAccount:function(e,t){return t>0&&this.$document.trigger("user-has-service-account",{serviceId:e.get("Game/current.serviceId"),serviceAccount:t}),this._renderSettingsPanel()},_renderSettingsPanel:function(){return this.replacePartial("bGamePanel__settings","bGamePanel__settings__view"),this.settingsPanelIsRendered=!0},_renderComponentDependencies:function(e){var t,i,n;return i=this.dependenciesStatuses.get("lastErroneousComponentId"),t=this.dependenciesStatuses.get("hasInstallingComponent"),n=this.model.get("L4G.Application/in-status.services."+this.serviceId+".last_ec"),this.model.set("Game/current.dependencies",e),this.model.set("Game/current.dependencies.error",!(!i&&n!==g.COMPONENT_INSTALL_ERROR)),this.model.set("Game/current.dependencies.last_ec",n),this.model.set("Game/current.dependencies.lastErroneousComponentId",i),this.model.set("Game/current.dependencies.hasInstallingComponent",!!t),this.replacePartial("bGamePanel__status","bGamePanel__components__view")},getSupportLinks:function(e){var t;return t=this.model.get("GamePanel/supportLinks."+this.serviceId+"."+e),t||(t=this.model.get("GamePanel/supportLinks."+e)),t},_checkBtnSettingShow:function(){return"FAULT"===this.model.get("L4G.Application/working-mode")||"NEED_UPDATE"===this.model.get("L4G.Application/working-mode")?this.$el.find("#jsGamePanel-btnToSettings").removeClass("bGamePanel__eSwitchBtnEdge__mVisible_true"):"progress"===this.model.get("L4G.Application/in-status.services."+this.serviceId+".status")&&"install"===this.model.get("L4G.Application/in-status.services."+this.serviceId+".action")?this.$el.find("#jsGamePanel-btnToSettings").removeClass("bGamePanel__eSwitchBtnEdge__mVisible_true"):this.$el.find("#jsGamePanel-btnToSettings").addClass("bGamePanel__eSwitchBtnEdge__mVisible_true")},_getAppRequirements:function(){return this.appsRequirements.then(l.helpers.filterByAppId(this.serviceId)).then(function(e){return(null!=e?e._links:void 0)||{}},function(e){return c.Deferred().resolve({__errorStatus:e.status})})},checkingGameData:function(){return this.userGameData=this.model.get("GameData/services."+this.serviceId),c.when(this._getAppRequirements(),FOURGE.UserData.requestData()).then(function(t){return function(i,n){var s,a,r,o,l,c,d,h,m;for(c in i)e.call(i,c)&&f[c]&&t._addFourgeError(f[c]);return i.__errorStatus&&t.flags.playGameOnlyWithServiceAccount||i["play-another-game"]?(t.flags.playGame=!1,t.flags.installGame=!1):t.flags.playGameOnlyWithServiceAccount&&(t.flags.playGame=!0,t.flags.installGame=!0),!!t.userGameData&&(!t.checkingCountryBlock()&&(null!=t.userGameData.type&&(t.serviceType=t.userGameData.type),"undefined"!=typeof t.userGameData.accounts&&(r=t.userGameData.accounts[0],(null!=(h=r.subscription)?h.endtime_unix_ms:void 0)&&(r.subscription.finishTime=t.calcTimeDifference(+new Date,null!=(m=r.subscription)?m.endtime_unix_ms:void 0)),o=Object.keys(FOURGE.LAUNCHER_ERROR_CODE).reduce(function(e,t){return e[FOURGE.LAUNCHER_ERROR_CODE[t]]=t,e},{}),l=[FOURGE.LAUNCHER_ERROR_CODE.MOBILE_REQUIRED,FOURGE.LAUNCHER_ERROR_CODE.EMAIL_IS_NOT_CONFIRMED,FOURGE.LAUNCHER_ERROR_CODE.COUNTRY_MUST_BE_SELECTED,FOURGE.LAUNCHER_ERROR_CODE.BETA_TESTER_ROLE_REQUIRED,FOURGE.LAUNCHER_ERROR_CODE.SERVICE_ACCOUNT_BLOCKED],s=Object.keys(o).filter(function(e){if(r.hasError(e)||n.hasError(e)||t.userGameData.hasError(e))return~l.indexOf(+e)&&(r.havingBlockedErrors=!0),!0}).map(function(e){return o[e]}),a=!(!t.flags.betaTest||E(t.flags.betaTest)<Date.now()),d=t.flags.needSubscription&&r&&3===r.status,r.needSubscription=d,r.cbtTime=a,d&&!a&&s.push("SUBSCRIPTION_NEEDED"),u.log("@gamepanel","ui-errors",{appId:t.serviceId,errors:s}),r.hasError(FOURGE.LAUNCHER_ERROR_CODE.SERVICE_ACCOUNT_BANNED)&&(r.havingBan=!0,r.errors[FOURGE.LAUNCHER_ERROR_CODE.SERVICE_ACCOUNT_BANNED].extra.finishTime=t.calcTimeDifference(+new Date,r.errors[FOURGE.LAUNCHER_ERROR_CODE.SERVICE_ACCOUNT_BANNED].extra.until_unix_ms)),2===r.status&&r.subscription.has_active?r.isPremium=!0:r.isPremium=!1,t.model.update("Game","current.account",r),t.model.update("Game","current.data",t.userGameData))))}}(this))},_addFourgeError:function(e){return this.userGameData.errors=this.userGameData.errors||{},this.userGameData.errors[e]=!0},checkingCountryBlock:function(){return this.userGameData.hasError(FOURGE.LAUNCHER_ERROR_CODE.COUNTRY_BLOCKED)},checkingUbersecurity:function(){return this.userGameData.hasError(FOURGE.LAUNCHER_ERROR_CODE.UBERSECURITY_TURNED_OFF)},checkingBetaTesting:function(e){return"installed"===this.model.get("L4G.Application/in-status.services."+this.serviceId+".status")&&e.hasError(FOURGE.LAUNCHER_ERROR_CODE.BETA_TESTER_ROLE_REQUIRED)},_checkBetaTestRequestStatus:function(){if(this.flags.betaTestRequestClosed&&this.model.set("Game/current.betaTestRequestStatus",P.CLOSED),this.flags.betaTestRequestConsidering)return this.model.set("Game/current.betaTestRequestStatus",P.REQUESTED)},hasNotInstalledComponents:function(e){return this.dependenciesStatuses.update(e),!!_(e).filter(function(e){if("installed"!==e.status)return!0}).length},getTwoDigitValue:function(e){return("0"+e).slice(-2)},calcTimeDifference:function(e,t){var i,n,s,a,r,o,l;return i=(t-e)/1e3,a=new Date(t),r=this.getTwoDigitValue(a.getDate()),o=this.getTwoDigitValue(a.getMonth()+1),l={},2533707504e5===t?{type:"debt"}:i<86400?(n=this.getTwoDigitValue(a.getHours()),s=this.getTwoDigitValue(a.getMinutes()),{type:"oneDay",timeLeft:n+":"+s,date:r+"."+o+"."+a.getFullYear()}):i<259200?{type:"threeDays",daysLeft:Math.round(i/86400),date:r+"."+o+"."+a.getFullYear()}:i<31536e4?{type:"manyDays",daysLeft:Math.round(i/86400),date:r+"."+o+"."+a.getFullYear()}:{type:"lifeTime",daysLeft:Math.round(i/86400),date:r+"."+o+"."+a.getFullYear()}},_flipToBack:function(){var e;return e=this.$el,e.removeClass(this.options.classFace).addClass(this.options.classBack),I.trigger("game-panel-flip"),setTimeout(function(t){return function(){return e.removeClass(t.options.classFaceFull).addClass(t.options.classBackFull)}}(this),300),c(".jsUIIcons__eIcon").trigger("close")},_flipToFace:function(){var e;return e=this.$el,e.removeClass(this.options.classBack).addClass(this.options.classFace),I.trigger("game-panel-flip"),setTimeout(function(t){return function(){return e.removeClass(t.options.classBackFull).addClass(t.options.classFaceFull)}}(this),300)},_reloadPage:function(){return window.location.reload(),!1},_downloadApp:function(e){var t;return e.preventDefault(),null!=(t=window.A4G)&&"function"==typeof t.download&&t.download({serviceId:0}),!1}})})}.call(this),function(){define("bGamePanel__settings__view",function(){return Inn.View.extend({events:{"click #jsGamePanel-btnChangeDefaultPath":"_changeDefaultPath","click #jsGamePanel-btnConfigure":"_configureService","click #jsGamePanel-btnFixGame":"_startRepair","change .bGamePanelSettings__eEnvironmentSelector__eServerList__eItem":"_setupEnvironment"},eventRoutes:{"change:L4G.Application/in-setDefaultInstallDir":"_openBrowseDialog","change:L4G.Application/in-setInstallDir.path":"_finishChangeDefaultPath"},initialize:function(e){return Inn.View.prototype.initialize.call(this,this.options),this.serviceId=this.options.model.get("Game/current.serviceId"),1===this.model.get("Layout/superSecurity.is_just_enabled")&&setTimeout(function(e){return function(){return e.model.unset("Layout/superSecurity.is_just_enabled",{silent:!0})}}(this),500),this.initBindings()},_openBrowseDialog:function(){var e;return!!this.model.get("Layout/waiting."+this.serviceId+".changeDefaultPath")&&(!!this.model.get("L4G.Application/in-setDefaultInstallDir")&&(this.serviceId===this.model.get("L4G.Application/in-setDefaultInstallDir").serviceId&&(e={path:this.model.get("L4G.Application/in-setDefaultInstallDir").path,caption:FOURGE.utils.striptags(this.model.get("Game/current.title"))},this.options.l4g.send("browseDir",e))))},_changeDefaultPath:function(){return this.options.moduleNotify("start-intercept-install-dir"),this.model.clearKeys("L4G.Application/in-setDefaultInstallDir"),this.model.set("Layout/waiting."+this.serviceId+".changeDefaultPath",!0),this.options.l4g.send("getDefaultInstallDir",{serviceId:this.options.model.get("Game/current.serviceId")})},_finishChangeDefaultPath:function(){var e;return e={serviceId:this.serviceId,value:this.model.get("L4G.Application/in-setInstallDir").path.replace(/\\/g,"/")},this.options.l4g.send("changeDefaultInstallDir",e),this.model.get("Layout/waiting."+this.serviceId+".changeDefaultPath")&&this._startRepair(),this.model.unset("Layout/waiting."+this.serviceId+".changeDefaultPath"),this.model.unset("L4G.Application/in-setInstallDir.path",{silent:!0}),this.options.moduleNotify("finish-intercept-install-dir")},_configureService:function(){return this.options.l4g.send("configure",{serviceId:this.serviceId})},_startRepair:function(){return this.options.model.clearErrors(),this.options.l4g.send("repair",{serviceId:this.serviceId,isFullUpdate:!0}),this.timeoutFlipBack=setTimeout(this._backToFace,1e3)},_setupEnvironment:function(e){return this.options.l4g.send("setEnvironment",{name:e.target.value,serviceId:this.serviceId})},_backToFace:function(){return $("#jsGamePanel-btnToCommon").click()},initBindings:function(){var e,t,i,n;e=this,t=this.eventRoutes;for(i in t)n=t[i],this.model.on(_.template(i)(e),this[n],this);return!0},removeBindings:function(){var e,t,i,n,s;e=this,t=this.eventRoutes,i=[];for(n in t)s=t[n],i.push(this.model.off(_.template(n)(e),this[s],this));return i},destroy:function(){return this.removeBindings(),clearTimeout(this.timeoutFlipBack),Inn.View.prototype.destroy.call(this)},options:{id:"bGamePanel__settings",i18nRequire:["i18n!Interface","i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__settings"}})})}.call(this),function(){define("bGamePanel__statusInstalledButBan__view",["bGamePanel__base__view"],function(e){var t;return(t=e.createViewFor)({templateName:"bGamePanel__statusInstalledButBan"})})}.call(this),function(){define("bGamePanel__statusInstalledButBlockedCountry__view",["bGamePanel__base__view"],function(e){var t;return(t=e.createViewFor)({templateName:"bGamePanel__statusInstalledButBlockedCountry"})})}.call(this),function(){define("bGamePanel__statusInstalledButBlocked__view",["global/config","global/yandex-metrika","global/utils/gamepanel","bGamePanel__statusProgress__view"],function(e,t,i,n){return Inn.View.extend(i.extendInnViewProto(n.prototype,{events:i.extendInnViewProto(n.prototype.events,{"click #go-install-extension":"_installExtension"}),_checkTemplates:i.noop(),initialize:function(e){return this.on("ready",function(e){return function(){return e._initElements()}}(this)),Inn.View.prototype.initialize.call(this,this.options),this.serviceId=this.options.model.get("Game/current.serviceId"),this.options.l4g=e.l4g},_installExtension:function(){var t,i;return("undefined"!=typeof chrome&&null!==chrome&&null!=(t=chrome.webstore)?t.install:void 0)?"undefined"!=typeof chrome&&null!==chrome&&null!=(i=chrome.webstore)&&i.install(e.chromeWebstoreItem,function(){return window.location.reload()}):window.open(e.chromeWebstoreItem),!1},options:{id:"bGamePanel__status",i18nRequire:["i18n!Interface","i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__statusInstalledButBlocked"}}))})}.call(this),function(){define("bGamePanel__statusInstalledButGuest__view",["bGamePanel__base__view"],function(e){var t;return(t=e.createViewFor)({templateName:"bGamePanel__statusInstalledButGuest"})})}.call(this),function(){define("bGamePanel__statusInstalledButMaintenance__view",["bGamePanel__base__view"],function(e){var t;return(t=e.createViewFor)({templateName:"bGamePanel__statusInstalledButMaintenance"})})}.call(this),function(){define("bGamePanel__statusInstalled__view",["module","packages/underscore","packages/che","l4g/assets/ofcAuth","l4g/assets/ofcPlay","packages/4game-api-client","packages/l4gApp","global/utils","global/utils/gamepanel","streams/events","global/yandex-metrika","bGamePanel__statusProgress__view"],function(e,t,i,n,s,a,r,o,l,c,u,d){var h,m,p;return m=o.getDeviceInfo,h=i.events,p=!1,a=a.use("v2"),Inn.View.extend(l.extendInnViewProto(d.prototype,{events:l.extendInnViewProto(d.prototype.events,{"submit #startPlayForm":"_tryToStartGame","click #jsBtnPlay":"_trackPlayBtnClick"}),eventRoutes:l.extendInnViewProto(d.prototype.eventRoutes,{"change:Layout/current.showPlayed":"_showHidePlayed"}),_checkTemplates:l.noop(),initialize:function(e){if(this.on("ready",function(e){return function(){return e._initElements()}}(this)),Inn.View.prototype.initialize.call(this,this.options),this.serviceId=+this.options.model.get("Game/current.serviceId"),this.serviceAccountId=+this.model.get("Game/current.account.service_account_id"),this.model.set("serviceId",this.serviceId),this.initBindings(),this.initCheListeners(),this.model.get("Layout/current.showPlayed"))return this.model.unset("Layout/current.showPlayed")},updateState:function(e){if(e.type===a.user.identityTypes.DEVICE&&e.action===a.user.actions.ADD&&p)return p=!1,this._prepareToGetServiceLoginData()},initCheListeners:function(){return h.bind("start-current-game",this._tryToStartGame,this),h.bind("set-contacts:complete",this.updateState,this)},removeCheListeners:function(){return h.unbind("start-current-game",this._tryToStartGame,this),h.unbind("set-contacts:complete",this.updateState,this)},_tryToStartGame:function(e){return null!=e&&e.preventDefault(),this.model.set("Layout/current.showPlayed",!0),null==this.model.get("GameData/services."+this.serviceId+".errors.8")||this.model.get("Layout/service."+this.serviceId+".licenceAccepted")?this._prepareToGetServiceLoginData():void this._playViaLicenceAccept()},_showHidePlayed:function(){return this.model.get("Layout/current.showPlayed")?this.$el.find(".bGamePanel__ePlayBlock .bUIButton__eFrame").addClass("bUIButton__mState_Loading").attr("disabled","disabled"):this.$el.find(".bGamePanel__ePlayBlock .bUIButton__eFrame").removeClass("bUIButton__mState_Loading").removeAttr("disabled")},_getLicenceType:function(){return this.model.get("GameData/services."+this.serviceId+".errors.8.extra.licenceCode")},_playViaLicenceAccept:function(){var e;return e=this._getLicenceType(),this.model.set("Layout/services."+this.serviceId+".waitingForLicenceAccept",!0),window.A4G?(window.Inn.bind("licence-accepted-"+this.serviceId,document.documentElement,t.bind(this._onLicenceAcceptViaInn,this)),window.Inn.bind("a4g-frame-closed",document.documentElement,t.bind(this._onLicenceReject,this)),window.A4G.licenceBeforePlay({serviceId:this.serviceId,licenceType:e})):($(document).on("licence-accept.licenceBeforePlay",t.bind(this._onLicenceAccept,this)),FOURGE.utils.callPopup("LicenceWidget","&serviceId="+this.serviceId+"&licenceType"+e))},_onLicenceAcceptViaInn:function(){return this._onLicenceAccept(!0,{serviceId:this.serviceId,licenceType:this.model.get("GameData/services."+this.serviceId+".errors.8.extra.licenceCode")})},_onLicenceAccept:function(e,i){var n;return parseInt(i.serviceId,10)===this.serviceId&&(!!this.model.get("Layout/services."+this.serviceId+".waitingForLicenceAccept")&&(this.model.unset("Layout/service."+this.serviceId+".waitingForLicenceAccept"),this.model.set("Layout/service."+this.serviceId+".licenceAccepted",!0),window.A4G?(window.Inn.unbind("licence-accepted-"+this.serviceId,document.documentElement),window.Inn.unbind("a4g-frame-closed",document.documentElement)):$(document).off("licence-accept.licenceBeforePlay"),n=FOURGE.ServiceLicences.accept(i.serviceId,i.licenceType),n.done(t.bind(this._onServerLicenceAccept,this)),n.done(function(){return c.log("@license","accepted",{serviceId:i.serviceId,licenceType:i.licenceType})})))},_onLicenceReject:function(){return window.Inn.unbind("licence-accepted-"+this.serviceId,document.documentElement),window.Inn.unbind("a4g-frame-closed",document.documentElement),this.model.unset("Layout/current.showPlayed")},_onServerLicenceAccept:function(){return this.serviceAccountId?this._startGameFirstStep():(this.model.on("change:Game/current.account.service_account_id",this._startGameFirstStep,this),this.options.l4g.forceUpdateGameData())},_startGameFirstStep:function(){var e;return e=this.serviceAccountId||this.model.get("GameData/services."+this.serviceId+".accounts.0.service_account_id"),e<1?(this.model.unset("Layout/current.showPlayed"),!1):(this.model.off("change:Game/current.account.service_account_id",this._startGameFirstStep,this),this._prepareToGetServiceLoginData())},_cleanAfterGameStart:function(){var t,i;if(this.model.set("Layout/current.showPlayed",!0),setTimeout(function(e){return function(){return e.model.unset("Layout/current.showPlayed")}}(this),3e4),t=e.config(),null!=(null!=(i=t.playMetrics)?i[this.serviceId]:void 0))return u.reachGoalIfMatchUrl(t.playMetrics[this.serviceId])},_trackPlayBtnClick:function(){return c.log("@user","interaction","play-button-pressed",{serviceId:this.serviceId})},_prepareToGetServiceLoginData:function(){var e,t,i;return t=this.model.get("L4G.Application/in-status.services."+this.serviceId+".environment"),i=this.model.get("L4G.Application/in-status.services."+this.serviceId+".status"),e=this.model.get("L4G.Application/in-status.services."+this.serviceId+".readyStage"),m().then(function(n){return function(s){return a.apps.getSignInCode(n.serviceId,s.hwId,s.appId).then(function(s){return s.isEncrypted?r.backend.send("playEncrypted",{serviceId:n.serviceId,accountId:+s.accountId,login:s.serviceLogin,payloadEncrypted:s.code,serviceEnvironment:t,status:i,readyStage:e}):r.backend.send("play",{serviceId:n.serviceId,accountId:+s.accountId,login:s.serviceLogin,password:s.code,serviceEnvironment:t,status:i,readyStage:e}),n._cleanAfterGameStart()},function(e){var t,i;switch(e.status){case 403:if(t=null!=e&&null!=(i=e.responseJSON)?i._links:void 0){if(t["accept-agreements"])return n._playViaLicenceAccept();if(t["add-device"])return p=!0,n._addDevice();if(t["add-tel"])return n.options.l4g.forceUpdateGameData();if(t["change-country"])return h.trigger("country-blocked");if(t["enable-multifactor"])return h.trigger("ubersecurity-turned-off")}}})}}(this))},_addDevice:function(){return h.trigger("pageTransition:init",["?popupWidget=AppBindWidget",'AppBindWidget: {"target":"#OverlayContent","ns":"popup"}',"GET",{}])},_showAppBindPopup:function(){var e,t;return e=this.model.get("L4G.Application/in-appIdentity"),t=$("#AppBindForm"),t.find("#AppBindHwId").val(e.hwId),t.find("#AppBindAppId").val(e.appId),t.find("#AppBindPublicKey").val(e.publicKey),t.find("#AppBindSubmit").click()},_eventRouteExecuteList:{},initBindings:function(){var e,i,n,s,a;i=this,n=this.eventRoutes;for(s in n)a=n[s],e=t.template(s)(i),this.model.on(e,this._eventRouteExecuteList[e+"."+this.cid]=t.bind(this._useWhenUnlocked,this,this[a]));return!0},_useWhenUnlocked:function(e){var t,i,n;return n=this,t=Array.prototype.slice.call(arguments,1),i=function(){return e.apply(n,t)},this._locked?this._eventQueue.push(i):i()},removeBindings:function(){var e,i,n,s,a,r;i=this,this.removeCheListeners(),n=this.eventRoutes,s=[];for(a in n)r=n[a],e=t.template(a)(i),this.model.off(e,this._eventRouteExecuteList[e+"."+this.cid]),s.push(delete this._eventRouteExecuteList[e+"."+this.cid]);return s},destroy:function(){return this.removeBindings(),this.off("ready"),Inn.View.prototype.destroy.call(this)},options:{id:"bGamePanel__status",i18nRequire:["i18n!Interface","i18n!Game-Panel","i18n!inn/auth"],templateFolder:"bGamePanel/",templateName:"bGamePanel__statusInstalled"}}))})}.call(this),function(){define("bGamePanel__statusNotInstalled__view",["module","global/yandex-metrika","streams/events","packages/che"],function(e,t,i,n){return Inn.View.extend({events:{"click .jsBtnInstallService":"_downloadGame"},initialize:function(e){return Inn.View.prototype.initialize.call(this,this.options),this.options.l4g=e.l4g},_downloadGame:function(){var s,a,r,o,l;return l=this.options.model.get("Game/current.serviceId"),a=this.options.model.get("Game/current"),s=e.config(),this.options.l4g.send("getDefaultInstallDir",{serviceId:l}),null!=(null!=(o=s.installMetrics)?o[l]:void 0)&&t.reachGoalIfMatchUrl(s.installMetrics[l]),i.log("@user","interaction","install-game-clicked",a),r=function(){return n.events.unbind("gameInstall:started",r),i.log("@license","accepted",{serviceId:l,data:a.data,licenceType:2})},n.events.bind("gameInstall:started",r),!1},options:{id:"bGamePanel__status",i18nRequire:["i18n!Interface","i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__statusNotInstalled"}})})}.call(this),function(){define("bGamePanel__statusProgress__view",["global/utils/gamepanel"],function(e){var t,i;return i=e.getSizeBinaryLocalized,t=Inn.View.extend({events:{"click #jsGamePanel__ProgressBlock__eButton_Pause":"_handlerPause","click #jsGamePanel__ProgressBlock__eButton_Resume":"_handlerResume","click #jsGamePanel__ProgressBlock__eButton_Cancel":"_showCancelTemplate","click #jsGamePanel__ProgressBlock__eButton_ProgressStopYes":"_handlerCancel","click #jsGamePanel__ProgressBlock__eButton_ProgressStopNo":"_showProgressTemplate"},eventRoutes:{"change:L4G.Application/in-status.services.<%= serviceId %>.info":"_setProgressStatus"},usingTemplate:"",initialize:function(e){return this.serviceId=this.model.get("Game/current.serviceId"),this.on("all",this.handleViewEvents,this),this._setActiveTemplate(this._chooseTemplate()),Inn.View.prototype.initialize.call(this,this.options),this.readyToUpdate=!1,this.initBindings(),this.model.set("serviceId",this.serviceId)},_chooseTemplate:function(){var e,t,i;if(this.model.get("Layout/services."+this.serviceId+".cancelState"))return this.options.templateCancel;switch(e=this.model.get("L4G.Application/in-status.services."+this.serviceId+".status")){case"resuming":case"pausing":case"cancelling":case"canceled":return this.options.templatePrepare;case"paused":return this.options.templatePaused;case"progress":return i=this.model.get("L4G.Application/in-status.services."+this.serviceId+".info.checking"),t=Math.floor(parseFloat(this.model.get("L4G.Application/in-status.services."+this.serviceId+".info.progress"))),t?this.options.templateProgress:this.options.templatePrepare;default:return this.options.templateProgress}},handleViewEvents:function(e){if("ready"===e)return this._initElements()},_initElements:function(){return this.progressNodes={barTrack:this.$el.find(".bUIProgressBar__eTrack"),barStatus:this.$el.find(".bUIProgressBar__eStatus"),
barComplete:this.$el.find(".bUIProgressBar__eComplete"),statusContainer:this.$el.find(".bGamePanelProgress__eStatus"),statusDownloaded:this.$el.find("#jsGamePanel__ProgressBlock__Downloaded"),statusDownloadSize:this.$el.find("#jsGamePanel__ProgressBlock__DownloadSize"),statusDownloadSpeed:this.$el.find("#jsGamePanel__ProgressBlock__DownloadSpeed"),statusDownloadProgress:this.$el.find("#jsGamePanel__ProgressBlock__DownloadedProgress")},this.isUnpacking=!1,this.readyToUpdate=!0,this._setProgressStatus()},_setProgressState:function(){return this.render()},_setActiveTemplate:function(e){return this.$el.data("view-template",this.usingTemplate=this.options.templateName=e)},_checkTemplates:function(){var e;if(e=this._chooseTemplate(),e!==this.usingTemplate)return this._setActiveTemplate(e),this.render()},_setProgressStatus:function(){var e,t,n,s,a,r;if(this.readyToUpdate)return this._checkTemplates(),t=this.model.get(this.model.get("Game/current.statusPrefix")).info,s=Math.floor(parseFloat(t.progress)),n=100-s,this.progressNodes.barStatus.html(s+"&thinsp;%"),this.progressNodes.barTrack.css("left",-n+"%"),this.progressNodes.barComplete.css("left",n+"%"),e=i(t.downloaded),a=i(t.size),e!==a?(this.isUnpacking&&(this.progressNodes.statusContainer.removeClass("bGamePanelProgress__eStatus__mType_Unpacking"),this.isUnpacking=!1),r=i(1024*t.speed),this.progressNodes.statusDownloaded.text(e),this.progressNodes.statusDownloadSize.text(a),this.progressNodes.statusDownloadSpeed.text(r+window.Inn.i18n.__t__("Interface","PerSecond")),this.progressNodes.statusDownloadProgress.text(s)):this.isUnpacking?void 0:(this.progressNodes.statusContainer.addClass("bGamePanelProgress__eStatus__mType_Unpacking"),this.isUnpacking=!0)},_handlerPause:function(e){return this.options.l4g.send("pause",{serviceId:this.serviceId}),e.preventDefault(),!1},_handlerResume:function(e){return this.options.l4g.send("resume",{serviceId:this.serviceId}),this.render(),e.preventDefault(),!1},_handlerCancel:function(e){return this.model.unset("Layout/services."+this.serviceId+".cancelState"),this.options.l4g.send("cancel",{serviceId:this.serviceId}),e.preventDefault(),!1},_showCancelTemplate:function(e){return this.model.set("Layout/services."+this.serviceId+".cancelState",!0),e.preventDefault(),!1},_showProgressTemplate:function(e){return this.model.unset("Layout/services."+this.serviceId+".cancelState"),e.preventDefault(),!1},_getBytesWithName:function(e){var t,i;for(t=1;e.num>1024;)e.num/=1024,t++,i=e.names?" "+e.names[t]:"";return e.bit?Math.round(100*e.num)/100*8:Math.round(100*e.num)/100+i},initBindings:function(){var e,t,i,n;e=this,t=this.eventRoutes;for(i in t)n=t[i],this.model.on(_.template(i)(e),this[n],this);return!0},removeBindings:function(){var e,t,i,n,s;e=this,t=this.eventRoutes,i=[];for(n in t)s=t[n],i.push(this.model.off(_.template(n)(e),this[s],this));return i},destroy:function(){return this.removeBindings(),this.off("all",this.handleViewEvents,this),Inn.View.prototype.destroy.call(this)},options:{id:"bGamePanel__status",i18nRequire:["i18n!Interface","i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__statusProgress",templateProgress:"bGamePanel__statusProgress",templateCancel:"bGamePanel__statusProgressCancel",templatePaused:"bGamePanel__statusPaused",templatePrepare:"bGamePanel__statusProgressPrepare"}})})}.call(this),function(){define("bGamePanel__statusUpdateRequired__view",function(){var e;return e=Inn.View.extend({events:{"click #bGamePanel__eBtnUpdateService_jsId":"_updateGame"},initialize:function(e){return this.serviceId=this.model.get("Game/current.serviceId"),Inn.View.prototype.initialize.call(this,this.options)},_updateGame:function(e){var t;return t="full_update_required"===this.options.model.get("L4G.Application/in-status.services."+this.serviceId+".status"),this.options.l4g.send("update",{serviceId:this.serviceId,extendedStatus:"full",isFullUpdate:t}),e.preventDefault(),!1},options:{id:"bGamePanel__status",i18nRequire:["i18n!Interface","i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__statusUpdateRequired"}})})}.call(this),function(){define("bGamePanel__workingModeFault__view",["module","global/yandex-metrika","streams/events","packages/che"],function(e,t,i,n){return Inn.View.extend({events:{"click .jsBtnServiceNoPlugin":"_downloadApp"},initialize:function(e){return Inn.View.prototype.initialize.call(this,this.options)},_downloadApp:function(s){var a,r,o,l,c;return!window.A4G||(c=this.options.model.get("Game/current.serviceId"),r=this.options.model.get("Game/current"),a=e.config(),window.A4G.download({serviceId:c}),null!=(null!=(l=a.installMetrics)?l[c]:void 0)&&t.reachGoalIfMatchUrl(a.installMetrics[c]),i.log("@user","interaction","download-branded-installer-clicked",r),o=function(){return n.events.unbind("gameDownload:started",o),i.log("@license","accepted",{serviceId:c,data:r.data,licenceType:2})},n.events.bind("gameDownload:started",o),s.preventDefault(),!1)},options:{id:"bGamePanel__status",i18nRequire:["i18n!Interface","i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__workingModeFault"}})})}.call(this),function(){define("bGamePanel__workingModeNeedUpdate__view",function(){var e;return e=Inn.View.extend({events:{"submit #jsGamePanelDownloadApp":"_downloadApp"},initialize:function(e){return Inn.View.prototype.initialize.call(this,this.options)},_downloadApp:function(e){return!window.A4G||(window.A4G.download({serviceId:0}),e.preventDefault(),!1)},initBindings:function(){},options:{id:"bGamePanel__status",i18nRequire:["i18n!Interface","i18n!Game-Panel"],templateFolder:"bGamePanel/",templateName:"bGamePanel__workingModeNeedUpdate"}})})}.call(this),function(){define("bGamesPromoList__layout__view",["packages/backbone","packages/che","global/utils/gamepanel","i18n_t","i18n!Interface","i18n!Game-Panel"],function(e,t,i,n){var s;return s=e.View.extend({eventRoutes:{"change:L4G.Application/in-status.services.<%= serviceId %>":"_checkingState","change:L4G.Application/working-mode":"_checkingState"},initialize:function(e){return _.extend(this.options,{model:e.adapter,l4g:e.l4g,moduleNotify:e.moduleNotify}),this._progressListeners={},this._locked=!1,this.serviceId=this.options.serviceId,this._eventQueue=[],this.DOM={},this.renderReady=!1,this.model=this.options.model,this.template=e.template,this.progressBarTemplate=jade.templates.bUIProgressBar_mixin,this.isUnpacking=!1,this.isFirstRenderTrying=!0,this.tryToStartRender()},tryToStartRender:function(){return this.model.get("L4G.Application/started")&&this.model.get("MyGames/gameData")?(this._renderStarted(),this.model.off("change:L4G.Application/started",this.tryToStartRender,this),this.model.off("change:MyGames/gameData",this.tryToStartRender,this)):this.isFirstRenderTrying?(this.model.on("change:L4G.Application/started",this.tryToStartRender,this),this.model.on("change:MyGames/gameData",this.tryToStartRender,this),this.isFirstRenderTrying=!1):void 0},lock:function(){return this._locked=!0},unlock:function(){var e,t;if(this._locked=!1,this._eventQueue.length){for(e=this._eventQueue.length,t=[];e>0;)this._eventQueue.shift()(),t.push(e--);return t}},_renderStarted:function(e,t){var i;return i=this,!!this.$el.length&&(this.lock(),this.render(),setTimeout(function(e){return function(){return e.unlock(),e.cacheDOMElements(),e.initBindings(),e._checkingState()}}(this),0))},cacheDOMElements:function(){return this.DOM.Status=this.$el.find(".bGamesPromoListItemProgress__eStatus"),this.DOM.StatusText=this.DOM.Status.find(".bGamesPromoListItemProgress__eStatusText"),this.DOM.ProgressBarContainer=this.$el.find(".bGamesPromoListItemProgress__eProgressBar"),this.DOM.Track=this.$el.find(".bGamesPromoListItemProgress__eTrack"),this.DOM.TrackStatus=this.$el.find(".bGamesPromoListItemProgress__eTrackStatus"),this.DOM.TrackStatusDownloaded=this.DOM.TrackStatus.find(".bGamesPromoListItemProgress__eTrackStatusDownloaded"),this.DOM.TrackStatusSize=this.DOM.TrackStatus.find(".bGamesPromoListItemProgress__eTrackStatusSize"),this.DOM.TrackStatusSpeed=this.DOM.TrackStatus.find(".bGamesPromoListItemProgress__eTrackStatusSpeed")},_eventRouteExecuteList:{},initBindings:function(){var e,i,n,s,a;i=this,this.eventRoutes[""],n=this.eventRoutes;for(s in n)a=n[s],e=_.template(s)(i),this.model.on(e,this._eventRouteExecuteList[e+"."+this.cid]=_.bind(this._useWhenUnlocked,this,this[a]));return t.events.bind("pageTransition:success",this.checkIfDestroyNeeded,this),this.model.attachErrorListener("*",this._setErrorState),!0},_useWhenUnlocked:function(e){var t,i,n;return n=this,t=Array.prototype.slice.call(arguments,1),i=function(){return e.apply(n,t)},this._locked?this._eventQueue.push(i):i()},removeBindings:function(){var e,i,n,s,a,r;i=this,t.events.unbind("pageTransition:success",this.checkIfDestroyNeeded,this),n=this.eventRoutes,s=[];for(a in n)r=n[a],e=_.template(a)(i),this.model.off(e,this._eventRouteExecuteList[e+"."+this.cid]),s.push(delete this._eventRouteExecuteList[e+"."+this.cid]);return s},destroy:function(){return this.removeBindings(),this.off("ready")},checkIfDestroyNeeded:function(e){var t,i;if(i=$("#"+(null!=(t=this.options)?t.id:void 0)),"function"==typeof this.destroy&&(!i.length||i.length&&i[0]!==(this.el[0]||this.el)))return this.destroy(),!0},options:{},_needRender:function(){return this.render()},_checkingState:function(){var e,t,i,n,s,a,r;if(n=this.model.get("L4G.Application/in-status.services."+this.serviceId)||{info:{}},r=n.status,e=n.action,i=n.readyStage,s=n.info,t=s.progress,a=s.stageSizes,"install"===e||"progress"===r)return"paused"===r?this._setPause():t<1||"resuming"===r||"pausing"===r||"cancelling"===r||"cancelled"===r?this._setPrepare():this._setProgress()},_setPrepare:function(){return this._DOMStatusDropStates(),this.DOM.StatusText.html(n("Game-Panel","PreparingToInstall")+"..."),this._updateProgressBar("prepare"),this._DOMTrackStatusHide(),this._DOMTrackShow()},_setPause:function(){var e,t;return t=this.model.get("L4G.Application/in-status.services."+this.serviceId),e=Math.floor(t.info.progress),this._DOMStatusDropStates(),this.DOM.StatusText.html(n("Game-Panel","Installing")+" ("+n("Game-Panel","OnPause")+"): "+e+"%").addClass("bGamesPromoListItemProgress__eStatus__mState_pause"),this._updateProgressBar("pause"),this._DOMTrackStatusShow(),this._drawProgress(),this.DOM.TrackStatusSpeed.addClass("bGamesPromoListItemProgress__eTrackStatusSpeed__mState_hidden"),this._DOMTrackShow()},_setErrorState:function(){return this.DOM.StatusText.html(""),this._DOMStatusDropStates().addClass("bGamesPromoListItemProgress__eStatus__mState_error"),this._DOMTrackHide()},_setProgress:function(){var e,t,i,s;switch(t="",s=this.model.get("L4G.Application/in-status.services."+this.serviceId),i=this._drawProgress(),s.status){case"progress":e=n("Game-Panel","Installing");break;case"update":e=n("Game-Panel","Updating")}switch(s.action){case"install":e=n("Game-Panel","Installing");break;case"update":e=n("Game-Panel","Updating");break;case"repair":e=n("Game-Panel","Repairing");break;case"delete":e=n("Game-Panel","Deleting")}switch(s.status){case"progress":t=e+": "+i+"&thinsp;%";break;case"pausing":case"resuming":case"cancelling":t=n("Game-Panel","Preparing")+"...";break;case"paused":t=e+": "+i+"&thinsp;% ("+n("Game-Panel","Pause").toLowerCase()+")"}return this._DOMStatusDropStates(),this.DOM.StatusText.html(t),this._DOMTrackStatusShow(),this._DOMTrackShow()},_drawProgress:function(){var e,t,s,a,r,o;return t=this.model.get("L4G.Application/in-status.services."+this.serviceId),s=t.info,r=s.size,a=s.progress,this._updateProgressBar(),this.DOM.TrackStatusSpeed.removeClass("bGamesPromoListItemProgress__eTrackStatusSpeed__mState_hidden"),s.downloaded===r?this.isUnpacking||(this.DOM.TrackStatus.addClass("bGamesPromoListItemProgress__eTrackStatus__mType_Unpacking"),this.isUnpacking=!0):(this.isUnpacking&&(this.DOM.TrackStatus.removeClass("bGamesPromoListItemProgress__eTrackStatus__mType_Unpacking"),this.isUnpacking=!1),e=i.getSizeBinaryLocalized(s.downloaded),r=i.getSizeBinaryLocalized(r),o=i.getSizeBinaryLocalized(1024*s.speed),this.DOM.TrackStatusDownloaded.text(e),this.DOM.TrackStatusSize.text(r),this.DOM.TrackStatusSpeed.text(", "+o+n("Interface","PerSecond"))),Math.floor(a)},_updateProgressBar:function(e){var t,n,s,a,r,o,l,c,u;return t=this.model.get("L4G.Application/in-status.services."+this.serviceId),s=t.info,l=s.size,a=s.progress,o=t.readyStage,n=o>-1,u=n&&s.stageSizes||[],c=u[0],r=u.map(i.prepareStageSizes(l)),this._renderProgressBar({size:"small",state:e,hideHelp:!0,progress:a,stageSize:c,stages:r})},_renderProgressBar:function(e){return null==e&&(e={}),this.DOM.ProgressBarContainer.html(this.progressBarTemplate({data:e,utils:i,t:n}))},_DOMStatusDropStates:function(){return this.DOM.Status.removeClass("bGamesPromoListItemProgress__eStatus__mState_pause bGamesPromoListItemProgress__eStatus__mState_error")},_DOMTrackHide:function(){return this.DOM.Track.addClass("bGamesPromoListItemProgress__eTrackStatus__mState_hidden")},_DOMTrackShow:function(){return this.DOM.Track.removeClass("bGamesPromoListItemProgress__eTrackStatus__mState_hidden")},_DOMTrackStatusHide:function(){return this.DOM.TrackStatus.addClass("bGamesPromoListItemProgress__eTrackStatus__mState_hidden")},_DOMTrackStatusShow:function(){return this.DOM.TrackStatus.removeClass("bGamesPromoListItemProgress__eTrackStatus__mState_hidden")},render:function(){return this.$el.html(this.template({serviceId:this.serviceId,model:this.model.toJSON(),utils:i,t:n})),this}})})}.call(this);
//# sourceMappingURL=innViews.js.map
