define(["exports","packages/bacon","streams/events"],function(exports,t,e){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){var n=Array.isArray(e)?e:[e],r=f(t,n);return new j(r)}function i(){var t=arguments.length<=0||void 0===arguments[0]?document.body:arguments[0],e=arguments.length<=1||void 0===arguments[1]?"click":arguments[1];return a(t,e).filter(o).map(c).map(l).lockOrder()}function o(t){var e=t.container,n=t.event,r=n.type,a=A+"-"+r,i=d(a,e,n),o=i&&i.getAttribute(a);return Boolean(o)}function u(t){var e=t.trackingEventId;return Boolean(e)}function c(t){var e=t.container,n=t.event,r=t.payload,a=n.type,i=A+"-"+a,o=d(i,e,n),u=o&&o.getAttribute(i);return t.payload=r||{},t.payload.trackingEventId=u,t}function l(t){var e=t.container,n=t.event,r=t.payload,a=void 0===r?{}:r,i=n.type,o=A+"-"+i,u=s(o,n,e)||{};return t.payload=a||{},t.payload.extra=Object.assign({},a.extra,u),t}function f(t,e){var n=[],r=new b["default"].fromBinder(function(r){return e.forEach(function(e){var a=function(e){r(new b["default"].Next({container:t,event:e,payload:{trackingEventId:null,extra:{}}}))};t.addEventListener(e,a),n.push(a)}),function(){e.forEach(function(e,r){t.removeEventListener(e,n[r])})}});return r}function s(t,e,n){var r=(e.type,d(t,n,e)),a=t.replace("data-","");return r&&v(r.dataset,a)}function v(t,e){var n=Object.keys(t),r={},a=e.replace(/-(.{1})/g,function(t){return t.toUpperCase()}).replace(/-/g,"");for(var i in n){var o=n[i];if(new RegExp("^"+a+".+").test(o)){var u=o.replace(a,"").replace(/(.{1})/,function(t){return t.toLowerCase()});r[u]=t[o]}}return r}function d(t,e,n){var r=n.target;return p(r,h(t),e)}function p(t,e,n){for(;y(t);){if(e(t))return t;if(t==n)return null;t=t.parentNode}return null}function h(t){return function(e){return e.hasAttribute(t)}}function y(t){return t instanceof Element}function k(t){return function(){return Boolean(t)}}Object.defineProperty(exports,"__esModule",{value:!0});var m=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();exports.trackDOMBase=a,exports.trackDOM=i,exports.isTargetTrackableByEventType=o,exports.addDataAttrEventIdByEventType=c,exports.addDataAttrExtraByEventType=l,exports.createBStreamFromEvents=f,exports.closestOrSelf=p,exports.byAttr=h,exports.isElement=y;var b=n(t),g=n(e),E="stream",w="wrapped",O="isLocked",A="data-tracking",B=function(){function t(e){r(this,t),this[E]=Object.create(e)}return m(t,[{key:"filter",value:function(t){var e=this[E];return this[E]=e.flatMap(function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return b["default"].fromCallback(function(e){var r=t.apply(null,n),a=b["default"].constant.apply(b["default"],n);r&&r.then?r.then(function(t){a.filter(k(t)).onValue(e)}):a.filter(k(r)).onValue(e)})}),this}}]),t}(),x=function(){function t(e){r(this,t),this[E]=Object.create(e)}return m(t,[{key:"map",value:function(t){var e=this[E];return this[E]=e.flatMap(function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return b["default"].fromCallback(function(e){var r=t.apply(null,n);r&&r.then?r.then(function(t){return e(t)}):e(r)})}),this}}]),t}(),j=function(){function t(e){r(this,t),this[E]=Object.create(e),this[w]=new B(e),this[O]=!1}return m(t,[{key:"filter",value:function(t){var e=this[w],n=this[E],r=this[O];if(e instanceof B)this[w]=e.filter(t);else{if(!(e instanceof x)||r)throw new Error("Could not call `filter` after `map`");this[w]=new B(n)}return this[E]=this[w][E],this}},{key:"map",value:function(t){var e=this[w],n=this[E];if(e instanceof x)this[w]=e.map(t);else{if(!(e instanceof B))throw new Error("Could not call `map` after `onValue`");this[w]=new x(n).map(t)}return this[E]=this[w][E],this}},{key:"lockOrder",value:function(){return this[O]=!0,this}},{key:"onValue",value:function(t){this[E].onValue(function(e){u(e.payload)||console.error("Payload is not valid :: ",e,e.payload),t(e.payload)})}},{key:"end",value:function(){this.onValue(function(t){var e=t.trackingEventId,n=t.extra;g["default"].track(e,n)})}}]),t}()});
//# sourceMappingURL=tracking.js.map
