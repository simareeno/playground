define(["exports","block!purchase/tools","block!purchase/flow-client","block!purchase/purchase-agent","block!purchase/widgets/PurchaseButton","block!purchase/widgets/AuthPopup","block!purchase/widgets/PaymentPopup"],function(exports,t,e,r,o,u,n){"use strict";function s(){var r=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],o={productDescriptors:[]},s=r.appId,p=r.eventBus,a=r.loadStrategy,i=(new e.FlowClient({appId:s,eventBus:p,container:document,loadStrategy:a||"ONE_REQUEST",getProductDescriptors:function(){return o.productDescriptors}}),r.widgets||{}),d=document.querySelectorAll("[data-purchase-agent]");t.each(d,function(t){var e=c(s,p,t,{customWidgets:i}),r=e.descriptor;o.productDescriptors.push(r)}),r.skipAuthPopup||new u.AuthPopup,r.skipPaymentPopup||new n.PaymentPopup;var g=new t.EventBus(document);return g.emit(e.EVENTS.PRODUCTS_INFO_REQUESTED),{appId:s,eventBus:p,bindAgent:function(r,u){var n=c(s,p,r,t.assign({customWidgets:i},u));return o.productDescriptors.push(n.descriptor),g.emit(e.EVENTS.PRODUCTS_INFO_REQUESTED),n}}}function c(e,r,o){var u=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],n={agent:null,descriptor:{}},s=u.customWidgets,c=void 0===s?{}:s,a=u.promoId||o.getAttribute("data-promo-id"),i=u.productId||o.getAttribute("data-product-id"),d=u.widgetType||o.getAttribute("data-purchase-agent"),g=u.voucherIds||(o.getAttribute("data-voucher-ids")||"").split(","),l=c[d]||p[d];if(!l)throw new Error("Constructor not found",o,d);return o._agent=n.agent=new l(t.assign({},u,{appId:e,eventBus:r,container:o})),i&&t.assign(n.descriptor,{promoId:a,productId:i,voucherIds:g.filter(Boolean)}),n}Object.defineProperty(exports,"__esModule",{value:!0}),exports.PurchaseSolution=s,exports.initAgent=c;var p={PurchaseButton:o.PurchaseButton}});
//# sourceMappingURL=index.js.map
