!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define(["module","packages/jquery"],e);else{var t,n;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n=t.track4game,t.track4game=e({config:function(){return n}},$)}}(function(e){var t=function(e,t){return function(n){return t[e.indexOf(n)]}}(["module","packages/jquery"],arguments),t=function n(e,r,o){function i(a,s){if(!r[a]){if(!e[a]){var c="function"==typeof t&&t;if(!s&&c)return c(a,!0);if(u)return u(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[a]={exports:{}};e[a][0].call(f.exports,function(t){var n=e[a][1][t];return i(n?n:t)},f,f.exports,n,e,r,o)}return r[a].exports}for(var u="function"==typeof t&&t,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(e,t,n){"use strict";function r(){}function o(){return new TypeError("You cannot resolve a promise with itself")}function i(){return new TypeError("A promises callback cannot return that same promise.")}function u(e){try{return e.then}catch(t){return M.error=t,M}}function a(e,t,n,r){try{e.call(t,n,r)}catch(o){return o}}function s(e,t,n){(0,j.asap)(function(e){var r=!1,o=a(n,t,function(n){r||(r=!0,t!==n?f(e,n):d(e,n))},function(t){r||(r=!0,v(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,v(e,o))},e)}function c(e,t){t._state===A?d(e,t._result):t._state===E?v(e,t._result):h(t,void 0,function(t){f(e,t)},function(t){v(e,t)})}function l(e,t){if(t.constructor===e.constructor)c(e,t);else{var n=u(t);n===M?v(e,M.error):void 0===n?d(e,t):(0,w.isFunction)(n)?s(e,t,n):d(e,t)}}function f(e,t){e===t?v(e,o()):(0,w.objectOrFunction)(t)?l(e,t):d(e,t)}function p(e){e._onerror&&e._onerror(e._result),m(e)}function d(e,t){e._state===O&&(e._result=t,e._state=A,0!==e._subscribers.length&&(0,j.asap)(m,e))}function v(e,t){e._state===O&&(e._state=E,e._result=t,(0,j.asap)(p,e))}function h(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+A]=n,o[i+E]=r,0===i&&e._state&&(0,j.asap)(m,e)}function m(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r,o,i=e._result,u=0;u<t.length;u+=3)r=t[u],o=t[u+n],r?_(n,r,o,i):o(i);e._subscribers.length=0}}function y(){this.error=null}function g(e,t){try{return e(t)}catch(n){return x.error=n,x}}function _(e,t,n,r){var o,u,a,s,c=(0,w.isFunction)(n);if(c){if(o=g(n,r),o===x?(s=!0,u=o.error,o=null):a=!0,t===o)return void v(t,i())}else o=r,a=!0;t._state!==O||(c&&a?f(t,o):s?v(t,u):e===A?d(t,o):e===E&&v(t,o))}function b(e,t){try{t(function(t){f(e,t)},function(t){v(e,t)})}catch(n){v(e,n)}}Object.defineProperty(n,"__esModule",{value:!0});var w=e("./utils"),j=e("./asap"),O=void 0,A=1,E=2,M=new y,x=new y;n.noop=r,n.resolve=f,n.reject=v,n.fulfill=d,n.subscribe=h,n.publish=m,n.publishRejection=p,n.initializePromise=b,n.invokeCallback=_,n.FULFILLED=A,n.REJECTED=E,n.PENDING=O},{"./asap":2,"./utils":9}],2:[function(e,t,n){(function(t){"use strict";function r(e){d=e}function o(e){n.asap=h=e}function i(){var e=t.nextTick,n=t.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(n)&&"0"===n[1]&&"10"===n[2]&&(e=setImmediate),function(){e(l)}}function u(){return function(){p(l)}}function a(){var e=0,t=new _(l),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function s(){var e=new MessageChannel;return e.port1.onmessage=l,function(){e.port2.postMessage(0)}}function c(){return function(){setTimeout(l,1)}}function l(){for(var e=0;e<v;e+=2){var t=j[e],n=j[e+1];t(n),j[e]=void 0,j[e+1]=void 0}v=0}function f(){try{var t=e,n=t("vertx");return p=n.runOnLoop||n.runOnContext,u()}catch(r){return c()}}Object.defineProperty(n,"__esModule",{value:!0}),n.setScheduler=r,n.setAsap=o;var p,d,v=0,h=({}.toString,function(e,t){j[v]=e,j[v+1]=t,v+=2,2===v&&(d?d(l):m())});n.asap=h;var m,y="undefined"!=typeof window?window:void 0,g=y||{},_=g.MutationObserver||g.WebKitMutationObserver,b="undefined"!=typeof t&&"[object process]"==={}.toString.call(t),w="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,j=new Array(1e3);m=b?i():_?a():w?s():void 0===y&&"function"==typeof e?f():c()}).call(this,e("_process"))},{_process:10}],3:[function(e,t,n){"use strict";function r(e,t){var n=this;n._instanceConstructor=e,n.promise=new e(i.noop),n._validateInput(t)?(n._input=t,n.length=t.length,n._remaining=t.length,n._init(),0===n.length?(0,i.fulfill)(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&(0,i.fulfill)(n.promise,n._result))):(0,i.reject)(n.promise,n._validationError())}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./utils"),i=e("./-internal");r.prototype._validateInput=function(e){return(0,o.isArray)(e)},r.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},r.prototype._init=function(){this._result=new Array(this.length)},n["default"]=r,r.prototype._enumerate=function(){for(var e=this,t=e.length,n=e.promise,r=e._input,o=0;n._state===i.PENDING&&o<t;o++)e._eachEntry(r[o],o)},r.prototype._eachEntry=function(e,t){var n=this,r=n._instanceConstructor;(0,o.isMaybeThenable)(e)?e.constructor===r&&e._state!==i.PENDING?(e._onerror=null,n._settledAt(e._state,t,e._result)):n._willSettleAt(r.resolve(e),t):(n._remaining--,n._result[t]=e)},r.prototype._settledAt=function(e,t,n){var r=this,o=r.promise;o._state===i.PENDING&&(r._remaining--,e===i.REJECTED?(0,i.reject)(o,n):r._result[t]=n),0===r._remaining&&(0,i.fulfill)(o,r._result)},r.prototype._willSettleAt=function(e,t){var n=this;(0,i.subscribe)(e,void 0,function(e){n._settledAt(i.FULFILLED,t,e)},function(e){n._settledAt(i.REJECTED,t,e)})},t.exports=n["default"]},{"./-internal":1,"./utils":9}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function i(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function u(e){this._id=g++,this._state=void 0,this._result=void 0,this._subscribers=[],s.noop!==e&&((0,a.isFunction)(e)||o(),this instanceof u||i(),(0,s.initializePromise)(this,e))}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./utils"),s=e("./-internal"),c=e("./asap"),l=e("./promise/all"),f=r(l),p=e("./promise/race"),d=r(p),v=e("./promise/resolve"),h=r(v),m=e("./promise/reject"),y=r(m),g=0;n["default"]=u,u.all=f["default"],u.race=d["default"],u.resolve=h["default"],u.reject=y["default"],u._setScheduler=c.setScheduler,u._setAsap=c.setAsap,u._asap=c.asap,u.prototype={constructor:u,then:function(e,t){var n=this,r=n._state;if(r===s.FULFILLED&&!e||r===s.REJECTED&&!t)return this;var o=new this.constructor(s.noop),i=n._result;if(r){var u=arguments[r-1];(0,c.asap)(function(){(0,s.invokeCallback)(r,o,u,i)})}else(0,s.subscribe)(n,o,e,t);return o},"catch":function(e){return this.then(null,e)}},t.exports=n["default"]},{"./-internal":1,"./asap":2,"./promise/all":5,"./promise/race":6,"./promise/reject":7,"./promise/resolve":8,"./utils":9}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){return new u["default"](this,e).promise}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o;var i=e("../enumerator"),u=r(i);t.exports=n["default"]},{"../enumerator":3}],6:[function(e,t,n){"use strict";function r(e){function t(e){(0,i.resolve)(u,e)}function n(e){(0,i.reject)(u,e)}var r=this,u=new r(i.noop);if(!(0,o.isArray)(e))return(0,i.reject)(u,new TypeError("You must pass an array to race.")),u;for(var a=e.length,s=0;u._state===i.PENDING&&s<a;s++)(0,i.subscribe)(r.resolve(e[s]),void 0,t,n);return u}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r;var o=e("../utils"),i=e("../-internal");t.exports=n["default"]},{"../-internal":1,"../utils":9}],7:[function(e,t,n){"use strict";function r(e){var t=this,n=new t(o.noop);return(0,o.reject)(n,e),n}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r;var o=e("../-internal");t.exports=n["default"]},{"../-internal":1}],8:[function(e,t,n){"use strict";function r(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(o.noop);return(0,o.resolve)(n,e),n}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r;var o=e("../-internal");t.exports=n["default"]},{"../-internal":1}],9:[function(e,t,n){"use strict";function r(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}Object.defineProperty(n,"__esModule",{value:!0}),n.objectOrFunction=r,n.isFunction=o,n.isMaybeThenable=i;var u;u=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var a=u;n.isArray=a},{}],10:[function(e,t,n){"use strict";function r(){p&&l&&(p=!1,l.length?f=l.concat(f):d=-1,f.length&&o())}function o(){if(!p){var e=a(r);p=!0;for(var t=f.length;t;){for(l=f,f=[];++d<t;)l&&l[d].run();d=-1,t=f.length}l=null,p=!1,s(e)}}function i(e,t){this.fun=e,this.array=t}function u(){}var a,s,c=t.exports={};!function(){try{a=setTimeout}catch(e){a=function(){throw new Error("setTimeout is not defined")}}try{s=clearTimeout}catch(e){s=function(){throw new Error("clearTimeout is not defined")}}}();var l,f=[],p=!1,d=-1;c.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new i(e,t)),1!==f.length||p||a(o,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=u,c.addListener=u,c.once=u,c.off=u,c.removeListener=u,c.removeAllListeners=u,c.emit=u,c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],11:[function(e,t,n){"use strict";function r(e){return("00"+(e||"")).slice(-2)}function o(e){return"string"==typeof e?parseInt(e.split("-")[0],10):e}function i(e){if("string"==typeof e){var t=e.split("-");return t.shift(),t.join("-")}}function u(e){return function(t){for(var n=t.apps,r=0;r<n.length;r++){var o=n[r];if(o.appId==e)return o}}}function a(e){var t=e.getTimezoneOffset();return["+","−"][+(t>0)]+[~~(t/s),t%s].map(Math.abs).map(r).join(":")}Object.defineProperty(n,"__esModule",{value:!0}),n.getAppId=o,n.getGameName=i,n.filterByAppId=u,n.getISOTimezone=a;var s=-60},{}],12:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){e.length=0,Array.prototype.push.apply(e,t)}Object.defineProperty(n,"__esModule",{value:!0});var u=e("../lib/promise"),a=o(u),s=e("../lib/storage"),c=r(s),l=e("./helpers"),f=e("../utils"),p={};n["default"]=function(e){function t(e){return s.push(e),c.setItem(h,JSON.stringify(s)),s}function n(){var e=s.filter(function(e){return d.indexOf(e)<0});return!!e.length&&(e.length=Math.min(e.length,v.trackMaxBatchListSize||25),i(d,d.concat(e)),{list:e,flush:function(){i(s,s.filter(function(t){return e.indexOf(t)<0})),this.unlock(),c.setItem(h,JSON.stringify(s))},unlock:function(){i(d,d.filter(function(t){return e.indexOf(t)<0}))}})}function r(r,i){var s,c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],p=r||{},d=new Date,h={timestamp:d.getTime(),timezone:window.Intl&&Intl.DateTimeFormat().resolvedOptions().timeZone,timezoneOffset:(0,l.getISOTimezone)(d),referer:document.referrer},m=c.forced;if(p="string"==typeof p?(0,f.assign)(h,c,{event:r,extra:i}):(0,f.assign)(h,p),null!=p.event&&t(p),u.request&&!u.request.completed&&!m)return u.request;var y=n();return y?(s=e("post",v.url||"users/#{userId}/trackings",{trackings:y.list,requestTimestamp:Date.now()},{retryAttempts:2}).then(function(){y.flush()},function(e){return 400===e.status?y.flush():y.unlock(),e.status}),m?(s=s.then(function(){return s.completed=!0}),s.completed||(s.completed=!1)):(u.request=s,u.request.completed=!1,u.request.then(o,o)),s):a["default"].resolve()}function o(e){return new a["default"](function(t){setTimeout(function(){t(u.request.completed=!0),s.length&&(!e||e>=500)&&r()},m)})}var u,s,d,v=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],h="4g.track-"+v.uid,m=v.trackAccumulateTimeout||3e3;return p[h]?(s=p[h].queue,d=p[h].locked,u=p[h].active):p[h]={queue:s=JSON.parse(c.getItem(h)||"[]"),locked:d=[],active:u={}},s.length&&r(),r},t.exports=n["default"]},{"../lib/promise":13,"../lib/storage":15,"../utils":16,"./helpers":11}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("es6-promise/lib/es6-promise/promise"),i=r(o);n["default"]="undefined"!=typeof Promise?Promise:i["default"],t.exports=n["default"]},{"es6-promise/lib/es6-promise/promise":4}],14:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return t=t.split("/").filter(function(e){return e}).map(function(e,t,n){return t===n.length-1&&e.indexOf("?")>=0?e.split("?").map(function(e,t){return t?e:encodeURIComponent(e)}).join("?"):encodeURIComponent(e)}).join("/"),[e,t].join("/").replace(/\/\s*$/,"")}function u(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],o=r;r=f({},o),e=e.toLowerCase();var u,a=this.config,c=f({"Accept-Language":a.lang,Authorization:"Anonymous","X-Area":a.area},r.headers||{}),v=this.token,h=i(r.gateway?a.gatewayUrl:a.baseUrl,t);if(v&&(c.Authorization="bearer "+v),r.captcha&&(d[h]&&(c["Human-Validation"]="Captcha id="+r.captcha.id+",value="+r.captcha.value),delete r.captcha),r.sagaId&&(c.Saga="batch "+r.sagaId,delete r.sagaId,delete r.privilegeElevationCode),r.privilegeElevationCode&&(c["Privilege-Elevation"]="empty","empty"!==r.privilegeElevationCode&&(c["Privilege-Elevation"]="code "+r.privilegeElevationCode),delete r.privilegeElevationCode),!a)return l.warning("If you trying to make request through connector's methods then you should provide config object or use api's %s method. Example: %s","send","api.send('options tokens')"),s["default"].Deferred().reject({status:400},"error","No config were provided");r.contentType||(r.contentType="application/json"),["get","options","head"].indexOf(e)<0&&p.test(r.contentType)&&(n=JSON.stringify(n||{}));var m=f({data:n,xhrFields:{withCredentials:!0},retryAttempts:a.requestDefaultRetryAttempts||0,retryTimeout:function(){var e=1e3,t=1e4,n=2;return function(){return e=Math.min(e*n,t)}}()},r,{method:e.toUpperCase(),headers:c});return"function"==typeof a.mockResponse?(u=s["default"].Deferred(),setTimeout(function(){l.warning("Response for %s was resolved with mocked result",[m.method,h].join(" ")),u.resolve(a.mockResponse(t,m),"success",{status:200})},Math.floor(1e3*Math.random())+500)):u=s["default"].ajax(h,m).then(null,function y(e,t,n){var r=s["default"].Deferred(),o=this;if(e.status>=500&&o.retryAttempts-- >0){var i=o.retryTimeout;"function"==typeof i&&(i=i(o.retryAttempts)),setTimeout(function(){s["default"].ajax(o).then(null,y).then(r.resolve,r.reject)},i||0)}else r.reject(e,t,n);return r}),u.then(function(t,n,r){return"function"==typeof a.responsePreprocessor&&(t=a.responsePreprocessor(t)),d[h]&&(o.captcha&&delete o.captcha,delete d[h]),["options","head"].indexOf(e)>=0?s["default"].Deferred().resolve(r):t},function(e,t,n){return[412,429].indexOf(e.status)>=0&&(d[h]=!0),s["default"].Deferred().reject(e,t,n)})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("packages/jquery"),s=o(a),c=e("../utils"),l=r(c),f=l.assign,p=/^application\/([^.]+\.)?json$/i,d={};n["default"]={get:function(e,t,n,r){return u.call(r,"get",e,t,n)},post:function(e,t,n,r){return u.call(r,"post",e,t,n)},put:function(e,t,n,r){return u.call(r,"put",e,t,n)},"delete":function(e,t,n,r){return u.call(r,"delete",e,t,n)},patch:function(e,t,n,r){return u.call(r,"patch",e,t,n)},options:function(e,t,n,r){return u.call(r,"options",e,null,n)},head:function(e,t,n,r){return u.call(r,"head",e,null,n)}},t.exports=n["default"]},{"../utils":16,"packages/jquery":void 0}],15:[function(e,t,n){"use strict";function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u("setItem",t,2);var r=t[0],o=t[1],i=o+"";a[r]=i;try{window.localStorage.setItem(r,i)}catch(s){}}function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u("getItem",t,1);var r=t[0];if(null==a[r])try{a[r]=window.localStorage.getItem(r)}catch(o){}return null!=a[r]?a[r]:null}function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u("removeItem",t,1);var r=t[0];delete a[r];try{window.localStorage.removeItem(r)}catch(o){}}function u(e,t,n){if(t.length<n)throw new TypeError("Failed to execute '"+e+"' on 'Storage': "+n+" arguments required, but only "+t.length+" present.")}Object.defineProperty(n,"__esModule",{value:!0}),n.setItem=r,n.getItem=o,n.removeItem=i;var a={}},{}],16:[function(e,t,n){"use strict";function r(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function o(e,t){for(var n,o,i=r(e),u=1;u<arguments.length;u++){n=arguments[u],o=Object.keys(Object(n));for(var a=0;a<o.length;a++)try{i[o[a]]=n[o[a]]}catch(s){}}return i}function i(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return Array.prototype.slice.call(e,t)}function u(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=0;console.warn("Warning: "+e.replace(/%s/g,function(){return n[o++]}))}function a(e){if(null==e||"object"!=typeof e)return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(~[Date,RegExp,Function,String,Number,Boolean].indexOf(e.constructor))return new e.constructor(e);var t=new e.constructor;for(var n in e)t[n]="undefined"==typeof t[n]?a(e[n]):t[n];return t}Object.defineProperty(n,"__esModule",{value:!0}),n.assign=o,n.argsToArray=i,n.warning=u,n.deepCopy=a},{}],track4game:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./api/track"),u=o(i),a=e("./lib/request"),s=r(a),c=e("./utils");n["default"]=function(e){var t=void 0;"function"==typeof e&&(Array.isArray(e.deferredEvents)&&(t=e.deferredEvents.splice(0)),e=e.original),"object"!=typeof e&&(e={});var n=(0,u["default"])(function(t,n,r,o){return s[t](n,r,o,{config:(0,c.assign)({lang:"ru",area:"ru",baseUrl:"https://api2.4game.com"},e.connector)})},(0,c.assign)({uid:"standalone",url:"users/anonymous/trackings"},e));return(t||[]).forEach(function(e){return n.apply(null,e)}),n},t.exports=n["default"]},{"./api/track":12,"./lib/request":14,"./utils":16}]},{},[]);return t("track4game")(e.config())});