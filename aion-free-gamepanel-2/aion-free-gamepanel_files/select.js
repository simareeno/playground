define(["exports","packages/jquery","packages/react","i18n_t","i18n!Interface"],function(exports,e,t,s,i){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=a(e),o=a(t),r=a(s),l=(a(i),[13,27,32,33,34,35,36,38,40]);exports["default"]=o["default"].createClass({displayName:"Select",getInitialState:function(){var e=this.props.value||"";return{value:e,selection:e,title:this.props.title,items:[].concat(e?[]:{name:" ",value:""},this.props.items),ignore:null,popularTitle:this.props.popularTitle,popularItems:[].concat(this.props.popularItems),popularIgnore:null,priorityTitle:this.props.priorityTitle,priorityItems:[].concat(this.props.priorityItems),opened:!1,focused:!1,bottomIndent:!1}},getDefaultProps:function(){return{items:[],popularItems:[],priorityItems:[],tabindex:1,defaultText:"",defaultTextHidden:!1}},componentWillMount:function(){this._skipBlur=!1,this.viewPortItemsCount=0,this.searchBuffer=[],this.searchFrameTimeout,this.renderedItems,this.prevShiftCommand},componentDidMount:function(){"function"==typeof this.props.fetchData&&(this.setState({items:[{name:(0,r["default"])("Interface","Loading"),value:"",loader:!0}]}),this.props.fetchData().then(function(e){var t,s={};e.items&&(s.items=e.items),e.popularItems&&(s.popularItems=e.popularItems),e.priorityItems&&(s.priorityItems=e.priorityItems),this.props.value||(s.priorityItems&&s.priorityItems.length?t=s.priorityItems[0].value:s.popularItems&&s.popularItems.length?t=s.popularItems[0].value:s.items&&s.items.length&&(t=s.items[0].value)),t&&(s.value=s.selection=t),this.setState(s)}.bind(this)))},componentWillReceiveProps:function(e){var t={title:e.title,popularTitle:e.popularTitle,priorityTitle:e.priorityTitle};"function"!=typeof this.props.fetchData&&(t.items=[].concat(e.items),t.popularItems=[].concat(e.popularItems),t.priorityItems=[].concat(e.priorityItems)),e.value&&e.value!=this.state.value&&(t.value=e.value),this.setState(t)},componentWillUnmount:function(){this.clearSearchTimeout(),this.renderedItems=null,this.searchBuffer=null},componentDidUpdate:function(e,t){if(t.value!==this.state.value&&(0,n["default"])(this.refs.select.getDOMNode()).trigger("inputChanged"),this.state.opened){var s=(0,n["default"])(".bUISelect__eItem:first",this.refs.items.getDOMNode()),i=(0,n["default"])(this.refs.scrollArea.getDOMNode()),a=s.innerHeight(),o=i.height(),r=this.renderedItems.length*a>o;t.bottomIndent!==r&&this.setState({bottomIndent:r})}if(this.refs.selected&&this.state.opened&&(t.selection!==this.state.selection||t.opened!==this.state.opened)){var l=(0,n["default"])(this.refs.select.getDOMNode()),u=(0,n["default"])(this.refs.scrollOverlay.getDOMNode()),p=u.innerHeight(),h=l.innerHeight(),c=l.position(),m=c?c.top:0,d=i.scrollTop();i[0].contains(l[0])?"pageup"===this.prevShiftCommand?i.scrollTop(d+m):m<0&&m>-h?i.scrollTop(d+m):m<0?i.scrollTop(d+m-(o-h-p)):m>o-h-p&&i.scrollTop(d+m):i.scrollTop(0),this.prevShiftCommand=null}},render:function(){var e,t=["bUISelect"],s={id:this.props.id,tabIndex:this.props.tabindex,onFocus:this.onFocus,onBlur:this.onBlur,onClick:this.onClick,onKeyDown:this.onKeyDown,onKeyPress:this.onKeyPress},i=[],a=[],n=[],r=[];if(this.props.micro&&t.push("bUISelect__mMicro_True"),this.props.modifiers&&(t=t.concat(this.props.modifiers.split(/\s+/))),this.state.opened&&t.push("bUISelect__mEvent_openBottom"),this.state.focused&&t.push("bUISelect__mEvent_Focus"),s.className=t.join(" "),this.props.dataAttributes&&Object.keys(this.props.dataAttributes).forEach(function(e){s["data-"+e]=this.props.dataAttributes[e]}),this.props.defaultText){i.push(o["default"].createElement("option",{key:i.length,value:""},this.props.defaultText));var l=["bUISelect__eItem"];this.props.defaultTextHidden&&l.push("bUISelect__eItem__mState_hidden"),a.push(o["default"].createElement("li",{key:a.length,className:l.join(" "),onClick:this.onSelect.bind(this,""),onMouseDown:this.skipBlur,onMouseUp:this.restoreBlur},this.props.defaultText))}r.push.apply(r,this.renderGroup({title:this.state.priorityTitle,items:this.state.priorityItems},i,n)),r.push.apply(r,this.renderGroup({title:this.state.popularTitle,ignore:this.state.popularIgnore,items:this.state.popularItems},i,a)),r.push.apply(r,this.renderGroup({title:this.state.title,ignore:this.state.ignore,items:this.state.items},i,a)),this.renderedItems=r,n.length&&(e=o["default"].createElement("span",{className:"bUISelect__eUnderScrollArea"},o["default"].createElement("ul",{className:"bUISelect__eItems"},n),o["default"].createElement("span",{className:"bUISelect__eShadow"},o["default"].createElement("img",{src:"/b/bUISelect/shadow-line.png",className:"bUISelectShadow__eImage"}))));var u=["bUISelect__eItems"],p={display:"none"};this.state.bottomIndent&&(u.push("bUISelect__eItems__mPosition_Last"),delete p.display);var h=this.getValueItem(this.state.value),c=this.captionTemplate(h);return"function"==typeof this.props.captionTemplate&&(c=this.props.captionTemplate(h)),o["default"].createElement("span",s,o["default"].createElement("span",{className:"bUISelect__eCaption"},c,o["default"].createElement("span",{className:"bUISelect__eArrow"})),o["default"].createElement("select",{ref:"select",name:this.props.name,className:"bUISelect__eControl",value:this.state.value},i),o["default"].createElement("span",{className:"bUISelect__ePopup"},e,o["default"].createElement("span",{ref:"scrollArea",className:"bUISelect__eScrollArea"},o["default"].createElement("ul",{ref:"items",className:u.join(" ")},a)),o["default"].createElement("span",{ref:"scrollOverlay",className:"bUISelect__eOverflow",style:p})))},renderGroup:function(e,t,s){var i=[];if(e.items.length){var a=[];e.title&&s.push(o["default"].createElement("li",{className:"bUISelect__eItemCaption",key:s.length},e.title)),e.items.forEach(function(t,n){if(e.ignore!==t.value){a.push(o["default"].createElement("option",{value:t.value,key:n},t.name)),i.push(t);var r,l=["bUISelect__eItem"];this.state.selection===t.value&&(l.push("bUISelect__eItem__mState_Selected"),r="selected");var u=this.listItemTemplate(t);"function"==typeof this.props.listItemTemplate&&(u=this.props.listItemTemplate(t)),s.push(o["default"].createElement("li",{ref:r,className:l.join(" "),key:s.length,onClick:this.onSelect.bind(this,t.value),onMouseDown:this.skipBlur,onMouseUp:this.restoreBlur},u))}}.bind(this)),t.push(o["default"].createElement("optgroup",{label:e.title,key:t.length},a))}return i},captionTemplate:function(e){return o["default"].createElement("span",null,e.name||" ")},listItemTemplate:function(e){return o["default"].createElement("span",null,e.name)},getValueItem:function(e){var t=this.renderedItems,s={};return t&&(e?t.some(function(t){if(t.value===e)return s=t,!0}):s=t[0]||{}),s},onFocus:function(e){this.setState({focused:!0})},onBlur:function(e){this._skipBlur||this.setState({focused:!1,opened:!1,selection:this.state.value})},onClick:function(){this.state.opened?this.setState({opened:!1,selection:this.state.value}):this.setState({opened:!0})},onSelect:function(e,t){t.preventDefault(),t.stopPropagation(),this.restoreBlur(),this.setState({value:e,selection:e,opened:!1})},skipBlur:function(){this._skipBlur=!0},restoreBlur:function(){this._skipBlur=!1},onKeyPress:function(e){var t,s,i=String.fromCharCode(e.charCode),a=this.renderedItems;this.searchBuffer.push(i.toLowerCase());var n=this.searchBuffer.join("");a&&(this.clearSearchTimeout(),a.some(function(e,s){if(!e.name.toLowerCase().indexOf(n))return t=s,!0}),null!=t&&(s=a[t].value,this.state.opened?this.setState({selection:s}):this.setState({value:s,selection:s})),this.searchFrameTimeout=setTimeout(function(){this.searchBuffer.length=0}.bind(this),500))},clearSearchTimeout:function(){this.searchFrameTimeout&&clearTimeout(this.searchFrameTimeout),this.searchFrameTimeout=null},onKeyDown:function(e){var t=e.keyCode,s=e.metaKey;if(s)switch(t){case 38:t=33;break;case 40:t=34}if(!(l.indexOf(t)<0)){if(e.preventDefault(),[27].indexOf(t)>=0)return void this.setState({opened:!1,selection:this.state.value});if([13,32].indexOf(t)>=0)return void(this.state.opened?this.setState({opened:!1,value:this.state.selection}):this.setState({opened:!0}));if(!this.state.opened&&[33,34,38,40].indexOf(t)>=0)return void this.setState({opened:!0});switch(t){case 33:this.shift("pageup");break;case 34:this.shift("pagedown");break;case 35:this.shift("end");break;case 36:this.shift("begining");break;case 38:this.shift(-1);break;case 40:this.shift(1)}}},shift:function(e){var t,s,i=0,a=this.renderedItems;a?("number"==typeof e?i=e:this.prevShiftCommand=e,"begining"===e?s=0:"end"===e?s=a.length-1:("pageup"===e?i=-this.getViewPortItemsCount():"pagedown"===e&&(i=this.getViewPortItemsCount()),a.some(function(n,o){if(n.value===this.state.selection)return t=o,s=t+i,"pageup"===e?s<0&&(s=0):"pagedown"===e?s>=a.length&&(s=a.length-1):s%=a.length,!0}.bind(this)),s<0&&(s+=a.length)),this.setState({selection:a[s].value})):console.warn("There is no rendered nodes to select from")},getViewPortItemsCount:function(){if(this.viewPortItemsCount)return this.viewPortItemsCount;var e=(0,n["default"])(this.refs.selected.getDOMNode()),t=(0,n["default"])(this.refs.scrollArea.getDOMNode()),s=t.height();return this.viewPortItemsCount=Math.round(s/e.innerHeight()),this.viewPortItemsCount}})});
//# sourceMappingURL=select.js.map
