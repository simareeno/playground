define(["exports","packages/jquery","packages/bacon","packages/l4gApp","streams/events","global/launcher"],function(exports,e,n,t,r,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function u(e){h(B,_).filter(I(["pause","cancel"],"data")).onValue(function(n){var t=n.data,r=n.extra.serviceId;e(D[t],{appId:r})}),h(B,_).filter(I(["playEncrypted","play"],"data")).onValue(function(n){var t=n.data,r=n.extra,a=r.serviceId,i=r.status,u=r.readyStage;"progress"==i&&u>0?e("lite-client-game-start-requested",{appId:a,encrypted:"playEncrypted"===t}):e("game-start-requested",{appId:a,encrypted:"playEncrypted"===t})}),q["default"].gameData().then(function(e){return Object.keys(e).map(function(n){return{appId:n,key:e[n].key}})}).then(function(e){return e.filter(function(e){var n=e.key;return~window.location.pathname.indexOf("/"+n+"/")}).map(function(e){var n=e.appId;return n})[0]}).then(function(e){return o().map(function(n){var t=n.name,r=n.data;if("status"===t){var a=x(r.services,1),i=a[0],u=i.status,o=i.readyStage,d=i.serviceId,l=i.info.dependencies,p=void 0===l?[]:l,c="installed"===u||o>0&&"progress"===u;return c&&d==e&&{appId:d,dependencies:p}}}).filter(Boolean)}).then(function(n){return l(n,e)});var n=S["default"].republishAll().filter(S["default"].filter.envelope("gamepanel","ui-errors")).map(function(e){var n=x(e.payload,1),t=n[0],r=t.appId,a=t.errors,i=void 0===a?[]:a;return{appId:r,errors:i}});d(n,e);o().filter(function(e){var n=e.name;return"error"===n}).map(function(e){var n=e.data,t=n.code,r=n.desc,a=n.serviceId,i=n.extra,u=_.filter(function(e){var n=e.extra;return n}).filter(function(e){var n=e.extra.serviceId;return n===a}).pop()||{},o=u.data;return{appId:a,error:{code:t,extra:i,description:r,precondition:o}}}).onValue(function(n){e("l4g-error",n)})}function o(){return h(T,O).filter(I("message")).map(".data")}function d(e,n){var t=k(E,"errors"),r=e.filter(t.filter);r.onValue(t.update),r.onValue(function(e){var t=e.appId,r=e.errors;r.length?n("app-special-requirements-check-failed",{appId:t,requirements:r}):n("app-special-requirements-check-passed",{appId:t})})}function l(e,n){var t=k(A,"dependencies"),r=e.filter(t.filter);r.onValue(t.update),r.filter(p()).onValue(function(e){var t=e.appId,r=e.dependencies;if(r.length){var a=r.filter(s("not_installed")).map(f());n("additional-components-required",{appId:t,dependencies:a})}else n("additional-components-already-installed",{appId:t})}),r.filter(function(e){var n=e.dependencies;return n.filter(s("pending")).length}).filter(p()).onValue(function(e){var t=e.appId;n("additional-components-installation-started",{appId:t})}),r.filter(function(e){var n=e.dependencies;return n.filter(s("failed")).length}).filter(p()).onValue(function(e){var t=e.appId,r=e.dependencies,a=r.filter(s("failed")).map(f());n("additional-components-installation-failed",{appId:t,dependencies:a})}),r.filter(c()).filter(function(e){var n=e.dependencies;return!n.length}).onValue(function(e){var t=e.appId;n("additional-components-installation-finished",{appId:t})})}function p(){var e={};return function(n){return!e[n.appId]&&(e[n.appId]=n)}}function c(){var e={};return function(n){return null==e[n.appId]?e[n.appId]=!1:n}}function f(){return function(e){var n=e.componentId;return n}}function s(e){return function(n){var t=n.status;return t===e}}function v(){return h(T,O)}function g(e){return function(){return!e.apply(void 0,arguments)}}function m(e){var n=arguments.length<=1||void 0===arguments[1]?"name":arguments[1];return e=e.concat(e||[]),function(t){return!~e.indexOf(t[n])}}function I(){return g(m.apply(void 0,arguments))}function y(e){var n=arguments.length<=1||void 0===arguments[1]?100:arguments[1];return function(t){return e.push(t),e.length>=n&&e.splice(0,e.length-n),e}}function h(e){var n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return V["default"].sequentially(0,n).merge(e)}function b(){return function(e){var n=e.name,t=e.data,r=e.extra;return"message"!==n?e:{name:n,data:JSON.parse(t),extra:r}}}function k(e,n){var t={};return{filter:function(r){var a=r.appId,i=r[n]||[];return i.length>0?(t[a]=i.length+1,!0):(a in t||(t[a]=window.localStorage.getItem(e+a)||1),t[a]>0?(t[a]=0,!0):0!==t[a]&&void 0)},update:function(t){var r=t.appId,a=t[n]||[];window.localStorage.setItem(e+r,a.length)}}}Object.defineProperty(exports,"__esModule",{value:!0});var x=function(){function e(e,n){var t=[],r=!0,a=!1,i=void 0;try{for(var u,o=e[Symbol.iterator]();!(r=(u=o.next()).done)&&(t.push(u.value),!n||t.length!==n);r=!0);}catch(d){a=!0,i=d}finally{try{!r&&o["return"]&&o["return"]()}finally{if(a)throw i}}return t}return function(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();exports.trackGamepanelEvents=u,exports.getAppStream=v;var V=(i(e),i(n)),w=i(t),S=i(r),q=i(a),A="aaid",E="aaie",O=[],_=[],j=["getStatus","getFeature","getVersions","getAppIdentity","getTrackingData"],D={pause:"installation-paused-by-user",cancel:"installation-cancelled-by-user"},M=V["default"].fromEvent(w["default"].backend,"all",function(e,n,t){return{name:e,data:n,extra:t}}),T=M.filter(m(["backend-log","stat"])).map(b()),B=T.filter(I("send")).filter(m(j,"data"));B.onValue(y(_)),T.onValue(y(O))});
//# sourceMappingURL=app.js.map
