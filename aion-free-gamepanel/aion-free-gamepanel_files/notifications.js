define(["exports","module","packages/jquery","packages/bacon","packages/4game-api-client"],function(exports,t,e,n,a){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function u(){return f["default"].fromPromise(o["default"].revault.get("notifications")).flatMapLatest(function(t){return f["default"].fromArray(Object.keys(t).map(function(e){return t[e]}).map(function(t){return t.data&&t.data.timestamp?t:i["default"].extend({data:{timestamp:Date.now()}},t)}).sort(function(t,e){return t.data.timestamp-e.data.timestamp}))})}var i=r(e),f=r(n),o=r(a),l=function(t){return 60*t*1e3},s=l(1),c={},d=new f["default"].Bus,p=f["default"].interval(s).flatMapLatest(u);d.plug(p.merge(u()));var m=d.filter(function(t){var e=c[t.id];return!e||e.data.timestamp<t.data.timestamp});m.onValue(function(t){c[t.id]=t}),t.exports={stream:m,plug:function(t){return d.plug(t)},getWithType:function(t){return m.filter(function(e){return e.type===t})},getAllWithType:function(t){var e=[];return Object.keys(c).forEach(function(n){c[n].type===t&&e.push(c[n])}),f["default"].fromArray(e).merge(this.getWithType(t))},markAsRead:function(t){return o["default"].revault["delete"]("notifications/"+t).then(null,function(t){return 404===t.status?i["default"].Deferred().resolve():t}).then(function(){return delete c[t]})}}});
//# sourceMappingURL=notifications.js.map
