define(["exports","packages/jquery","packages/4game-api-client","packages/web-components","streams/notifications","streams/wallets","./abstract","./achievements/pb-missed","./achievements/pb-first-blood","./achievements/show-after-first-segment"],function(exports,e,t,n,r,o,i,a,u,l){"use strict";function c(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){return e&&e.ab&&e.ab.variant}function p(e){O["default"].getAllWithType("achievements").filter(function(t){return t.data.achievementType===e}).map(".id").assign(O["default"],"markAsRead")}function v(){var e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0],t=(0,w["default"])(document),n=(0,w["default"])(window);n.on("scroll."+N,function(){n.scrollTop()+n.height()>=t.height()&&(n.off("."+N),k["default"].achievements.markAsViewed("achievements-what-it-is").then(function(){e(),O["default"].plug(Bacon.once({id:N+"-1-true",type:"achievements",tags:[],data:{achievementType:N,timestamp:Date.now(),isUnlocked:!0,level:1}}))}))})}function m(e,t){var n=e.split(/(?:\/achievement|\/)/).filter(Boolean),r=void 0;return n.length&&(r=n.reduce(function(e,t,n,r){if(null==e)return e;if("counters"===r[n-1]){var o=void 0;return e.some(function(e){if(e.name===t)return o=e.value,!0}),o}return e[t]},t)),r}function h(e){var t=e.split(/\s+(!=|[=><]{1,2})\s+/);return{selector:t[0],sign:t[1],value:t[2]}}function b(e,t){if(null==e)return!1;var n=h(e),r=n.selector,o=n.sign,i=n.value;if(r&&o&&i){var a=m(r,t);switch(o){case"!=":return a!=i;case"=":return a==i;case">":return a>i;case"<":return a<i;case">=":return a>=i;case"<=":return a<=i;default:return!1}}else if(r)return!!m(r,t)}Object.defineProperty(exports,"__esModule",{value:!0});var g=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),y=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var l=u.get;if(void 0===l)return;return l.call(a)}var c=Object.getPrototypeOf(o);if(null===c)return;e=c,t=i,n=a,r=!0,u=c=void 0}};exports.getABGroup=d;var w=c(e),k=c(t),A=c(n),O=c(r),T=c(o),j=c(i),_=c(a),C=c(u),M=c(l),N="knowledge-is-power";(0,A["default"])({name:"achieve-knowledge",template:function(){return null}});var x=function(e){function t(e){s(this,t),y(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.componentBindings={"achieve-knowledge":"bindKnowledge","achievements-auth":"bindAuth"},this.init()}return f(t,e),g(t,[{key:"bind",value:function(e){var t=e.nodeName.toLowerCase(),n=this.componentBindings[t];n?this[n](e):"achievement"===e.getAttribute("tid")&&this.bindAchievement(e)}},{key:"getComponentStream",value:function(e){return y(Object.getPrototypeOf(t.prototype),"getComponentStream",this).call(this,e).flatMap((0,_["default"])()).flatMap((0,C["default"])(e)).flatMap((0,M["default"])(["loyal-friend","no-one-left-behind","aion-second-wind","bns-returned","l2ru-referral-invited-epic","l2ru-referral-invited-pro","l2ru-referral-invited-newbie","l2ru-referrer-epic","l2ru-referrer-pro","l2ru-referrer-newbie","l2clru-referral-epic","l2clru-referral-newbie","l2clru-referral-pro","l2clru-referrer-invited-epic","l2clru-referrer-invited-newbie","l2clru-referrer-invited-pro","l2clru-responded-newbie","pb-dracula"]))}},{key:"bindAuth",value:function(e){this._stream.getStatus().map(function(e){return 401!==e}).assign(e,"setAttribute","inactive")}},{key:"bindKnowledge",value:function(e){var t="achievements-description--details-short",n=document.querySelector(".achievements-description--details"),r=this._stream.getStatus().filter(function(e){return 401!==e}),o=this._stream.get(N).filter(function(e){return null!==e}).not().filter(Boolean);r.and(o).onValue(function(e){n.classList.remove(t),v()})}},{key:"bindAchievement",value:function(e){var t=e.nodeName.toLowerCase();this.initDataStream(e);var n=this.bindDataToModel(e,{".level":"level",".progress":"progress",".isUnlocked":"unlocked",".maxProgress":"max-progress"});n.map(".presentation").filter(Boolean).onValue(function(t){e.modelNode.batchUpdate(function(){Object.keys(t).forEach(function(n){var r=e.modelNode.get(n);r&&(r.textContent=t[n])})})}),n.map(".counters").filter(Boolean).onValue(function(t){var n=e.modelNode.get("counters");n.innerHTML="",j["default"].arrayToModel(n,t)}),n.map(".context").filter(Boolean).onValue(function(t){var n=e.modelNode.get("context");n.innerHTML="",j["default"].objectToModel(n,t)}),n.onValue(function(t){e.modelNode.batchUpdate(function(){for(var e=this.get("conditions"),n=0,r=e.children.length;n<r;n++){var o=e.children[n];if("item"===o.nodeName.toLowerCase()){var i=o.getAttribute("test"),a=o.getAttribute("select"),u=o.getAttribute("total"),l=a&&m(h(a).selector,t);t.isUnlocked||b(i,t)||a&&l==u?o.setAttribute("checked",""):o.removeAttribute("checked"),a&&o.setAttribute("value",l)}}})});var r=O["default"].getAllWithType("achievements").map(".data").filter(function(e){return e.achievementType===t}).debounce(300);r.onValue(function(n){e.modelNode.get("shining").textContent=!0,p(t)}),T["default"].getAreaCurrency().onValue(function(t){if(t){var n=t.bonusUnfreezeAmount?t.bonusUnfreezeAmount:0;e.modelNode.get("bonus-unfreeze-amount").textContent=n}})}}]),t}(j["default"]);exports["default"]=x});
//# sourceMappingURL=achievements.js.map
