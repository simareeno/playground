(function(){define(["module","packages/jquery","packages/che","i18n_t","i18n!Interface"],function(e,r,t,n){var s,o,i,a,u,p,d,c,g,h,f,w,_;return f=e.config(),h=f.browserSupportCookieName,s=r(document),w=null,_=11,g=window.navigator.userAgent.toLowerCase(),i=parseInt(window.navigator.appVersion.slice(window.navigator.appVersion.indexOf("MSIE")+4,window.navigator.appVersion.indexOf(";",window.navigator.appVersion.indexOf("MSIE")))),o=window.navigator.userAgent.match(/Trident\/(\d+)\./),u=function(){var e;try{return!!new ActiveXObject("htmlfile")}catch(r){return e=r,!1}},p=function(){return"WebSocket"in window},a=function(){return g.indexOf("win64")===-1||g.indexOf("x64")===-1},window.getUnsupportedBrowserError=function(){var e;return e=null!=w?w.get("Game/current.data.type"):void 0,g.indexOf("windows nt")===-1&&window.navigator.platform.toLowerCase().indexOf("win")===-1&&null!=e&&5!==e?2:g.indexOf("arm;")!==-1||g.indexOf("windows phone")!==-1||g.indexOf("iemobile")!==-1?4:Date.now()<new Date("2015-10-01 10:00+0300")&&/windows\snt\s6.1;\s(wow64|win64)/i.test(window.navigator.userAgent)&&"RU"===document.documentElement.getAttribute("data-area").toUpperCase()?1024:/msie/.test(g)&&i<_?8:window.opera?512:null!==o&&o.length&&parseInt(o[1])>4&&document.documentMode<_?256:!/msie/.test(g)||u()||p()?!a()&&!p()&&32:16},c="bGlobalLayout__mUnsupportedBrowser_True",d="bGlobalLayout__mUnsupportedBrowser_False",{domEvents:{"click .bUnsupportedMessage":"_removeUnsupportedCookie","click .bUnsupportedMessage__eCloseBtn":"_closeNotice"},_unsupportedMessages:{},_unsupportedMessageLinks:{},_unsupportedMessageReasonCode:0,init:function(e){return this._deferred=r.Deferred(),this.$oContainer=r(e),this.$updateBrowserText=this.$oContainer.find(".jsUnsupportedMessage__eText"),this.$updateBrowserTextLink=this.$oContainer.find(".jsUnsupportedMessage__eTextLink"),this.$updateBrowserLink=this.$oContainer.find(".jsUnsupportedMessage__eLink"),this.$body=r("body").eq(0),this.oContainerHeight=parseInt(this.$oContainer.css("line-height"),10),this.timer=null,this._initI18N(),s.one("l4g-model-ready",function(e){return function(r,t){return e._deferred.resolve(w=t.model)}}(this)).trigger("get-l4g-model-status")},turnOn:function(){return this._deferred.then(function(e){return function(){if(w.get("Game/current.data.type"))return e._checkIfBrowserSupported()}}(this)),this._deferred.then(function(e){return function(){return w.on("change:Game/current.data.type",e._checkIfBrowserSupported,e)}}(this))},turnOff:function(){return w.off("change:Game/current.data.type",this._checkIfBrowserSupported,this)},_initI18N:function(){return this._unsupportedMessages={0:n("Interface","UnsupportedBrowserMessage_errorText0"),2:n("Interface","UnsupportedBrowserMessage_errorText2"),4:n("Interface","UnsupportedBrowserMessage_errorText4"),8:n("Interface","UnsupportedBrowserMessage_errorText8"),16:n("Interface","UnsupportedBrowserMessage_errorText16"),32:n("Interface","UnsupportedBrowserMessage_errorText32"),64:n("Interface","UnsupportedBrowserMessage_errorText64"),256:n("Interface","UnsupportedBrowserMessage_errorText256"),512:n("Interface","UnsupportedBrowserMessage_errorText512"),1024:n("Interface","UnsupportedBrowserMessage_errorText1024")},this._unsupportedMessageLinks={0:n("Interface","UnsupportedBrowserMessage_errorLink0"),2:n("Interface","UnsupportedBrowserMessage_errorLink2"),4:n("Interface","UnsupportedBrowserMessage_errorLink4"),8:n("Interface","UnsupportedBrowserMessage_errorLink8",{link:"http://windows.microsoft.com/ru-RU/internet-explorer/download-ie"}),16:n("Interface","UnsupportedBrowserMessage_errorLink16"),32:n("Interface","UnsupportedBrowserMessage_errorLink32"),64:n("Interface","UnsupportedBrowserMessage_errorLink64"),256:n("Interface","UnsupportedBrowserMessage_errorLink256"),512:n("Interface","UnsupportedBrowserMessage_errorLink512",{link:"http://www.opera.com/download"}),1024:n("Interface","UnsupportedBrowserMessage_errorLink1024",{link:"https://4gameforum.com/threads/528477/"})}},_checkIfBrowserSupported:function(){if(this._unsupportedMessageReasonCode=this._getUnsupportedMessageReasonCode(),!this._unsupportedMessageReasonCode)return this._hideUnsupportedMessage(),this._setSupportedCookie(),!1;switch(this._showUnsupportedMessage(),this._unsupportedMessageReasonCode){case 2:case 4:return this._setUnsupportedCookie(!0);case 8:case 16:case 32:case 256:case 512:case 1024:return this._setUnsupportedCookie(!1);default:return this._hideUnsupportedMessage()}},_getUnsupportedMessageReasonCode:function(){var e;return e=window.getUnsupportedBrowserError(),e?e:!!this._isLicenceVisible()&&64},_showUnsupportedMessage:function(){var e,n;return n=this._unsupportedMessages[this._unsupportedMessageReasonCode],e=this._unsupportedMessageLinks[this._unsupportedMessageReasonCode],this.$updateBrowserText.html("-"===n?"":n),this.$updateBrowserTextLink.html("-"===e?"":e),this.timer=setTimeout(function(e){return function(){return e.$oContainer.css("visibility","visible"),e.$oContainer.stop(!0,!0).animate({height:35},1200,function(){return e.$body.addClass(c)}),r(document).trigger("fixed-element-appear",".jsUnsupportedMessage .bWidePageMaxWidth"),t.events.trigger("fixed-element-appear",".jsUnsupportedMessage .bWidePageMaxWidth"),e.timer=null}}(this),2e3)},_hideUnsupportedMessage:function(){return 0!==this.$oContainer.height()&&(null!=this.timer&&clearTimeout(this.timer),this.timer=null,this.$oContainer.css("visibility","visible"),this.$oContainer.stop(!0,!0).animate({height:0},1200,function(e){return function(){return e.$body.removeClass(c)}}(this)),r(document).trigger("fixed-element-disappear",".jsUnsupportedMessage .bWidePageMaxWidth"),t.events.trigger("fixed-element-disappear",".jsUnsupportedMessage .bWidePageMaxWidth"))},_setSupportedCookie:function(){var e;return e=null!=w?w.get("Game/current.data.key"):void 0,r.cookie(h,1,{path:e?"/"+e+"/":"/",expires:365})},_setUnsupportedCookie:function(e){var t;return t=null!=w?w.get("Game/current.data.key"):void 0,r.cookie(h,this._unsupportedMessageReasonCode,{path:t?"/"+t+"/":"/",expires:e?365:new Date((new Date).getTime()+1e3)})},_removeUnsupportedCookie:function(){var e;return e=null!=w?w.get("Game/current.data.key"):void 0,r.cookie(h,null,{path:e?"/"+e+"/":"/"})},_closeNotice:function(){return this._checkIfBrowserSupported(),this.$oContainer.find(".bUnsupportedMessage__eCloseBtn").remove(),r.cookie("hideLicenceNotice",1,{path:"/",expires:30})},_isLicenceVisible:function(){return this.$oContainer.data("licence-visible")}}})}).call(this);
//# sourceMappingURL=bUnsupportedMessage.js.map
