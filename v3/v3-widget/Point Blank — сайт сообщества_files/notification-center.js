define(["exports","module","packages/bacon","presenters/notification-center/achievements"],function(exports,e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=i(t),r=i(n),s=function(){function e(t){var n=this;o(this,e),this._stream=t,this._queue=[],this._frame=[],this._accumulator=new u["default"].Bus,this.notifications=new u["default"].Bus,this.markAsRead=new u["default"].Bus,this.element=this.initElement(),this.configureNotifications(),this.configureMarkAsRead(),this.configureAccumulator();var i=function a(){n.element.removeEventListener("complete",a),n.initProviders()};this.element.addEventListener("complete",i)}return a(e,[{key:"initProviders",value:function(){var e=this;[r["default"]].forEach(function(t){t(e._stream,e.notifications,e.markAsRead,e.element)})}},{key:"initElement",value:function(){var e=document.createElement("notificaton-center"),t=function n(){document.removeEventListener("DOMContentLoaded",n),document.body.appendChild(e)};return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),e}},{key:"configureNotifications",value:function(){this.notifications.toProperty().assign(this._queue,"push")}},{key:"configureMarkAsRead",value:function(){var e=this;this.markAsRead.onValue(function(t){var n=e.element.modelNode.get("items","#"+t);n&&n.parentNode.removeChild(n),e._frame.shift();var i=e._queue.shift();e._stream.markAsRead(t).then(null,function(){e._queue.push(i)})})}},{key:"configureAccumulator",value:function(){var e=this;this.notifications.merge(this.markAsRead).onValue(function(){var t=e._queue[e._frame.length];e._frame.length<5&&null!=t&&(e._frame.push(t.id),e._accumulator.push(t))}),this._accumulator.onValue(function(t){var n=document.createElement(t.nodeName),i="function"==typeof t.content&&t.content(t);n.setAttribute("id",t.id),n.setAttribute("key",t.id),i&&n.appendChild(i),e.element.modelNode.get("items").appendChild(n)})}}]),e}();e.exports=s});
//# sourceMappingURL=notification-center.js.map
