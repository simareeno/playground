(function(){define(["packages/jquery","packages/che","global/utils","streams/events"],function(t,e,r,n){var a;return a=function(e){var n,a;return n=t(e).data("params")||{},a=r.parseQueryParams(window.location.search),n.payment||(n.payment={},a.orderId&&a.psCode&&(n.payment=t.extend(n.payment,{orderId:a.orderId,psSystem:a.psCode,psEnabled:!0,paymentState:"poll"}))),n},{init:function(e){var r,n;switch(n=this._DOM={},n.$oContainer=t(e),r=this._CONFIG=a(e),r.pollAttempts=3,r.pollInterval=5e3,r.pollUrl="/payment/status",r.showError="qiwiwallet"!==r.payment.psSystem&&"osmppull"!==r.payment.psSystem,r.payment.paymentState){case"poll":return this.poll(r.payment.orderId)}},poll:function(r){var a,o,l,s,i,p;if(!r)throw"bPaymentTerminal__poll / method poll: Can't find orderId";return l=function(){var r;if(r=t.cookie("inn-payment-poll-redirect")||!1,t.removeCookie("inn-payment-poll-redirect"),n.log("@user","payment",["payment-returned-from-gateway-fail","payment-returned-from-gateway-success"][+("done"===s.requestStatus)]),e.events.trigger("payment-polling-result",s),"done"===s.requestStatus&&s.data.result&&r)return FOURGE.utils.postWithUrl(r,'PremiumUpgradeWidget: {"target": "#OverlayContent", "ns":"popup"}')},p=function(){return setTimeout(i,a.pollInterval)},i=function(){var e;return o===a.pollAttempts?(l(),!1):(o++,e=t.getJSON(a.pollUrl,{orderId:r,rnd:(new Date).getTime()}),e.done(function(t){return s.requestStatus="done",s.data=t,t.result?(l(),!1):p()}),e.fail(function(t){return s.requestStatus="fail",s.data=t.statusText,p()}))},a=this._CONFIG,o=0,s={orderId:r},p(),e.events.trigger("payment-polling-started")},restore:function(){return this.init()},remove:function(){var t;return t=this._DOM,t.$oContainer=null}}})}).call(this);
//# sourceMappingURL=bPaymentTerminal__poll.js.map
