(function(){define(["packages/underscore","packages/jquery","packages/event-bus","packages/4game-api-client","global/social","features/featuring","packages/che","i18n_t","i18n!Interface"],function(e,t,A,n,i,r,a,o){var s,l,c;return c={vk:"vkontakte",fb:"facebook",ok:"odnoklassniki",ya:"yandex"},s=["vkSignIn","fbSignIn","okSignIn","yaSignIn"],l="available-bonus-on-payment-buffs",{getSharedOptions:function(){var e;return e=function(e){return{gameIconsBaseUrl:"/c/_favicons",mediaUrl:"/4gamer/",mediaPreviewBaseUrl:"/4gamer/userbar/",promoteSocialNetwork:e}},r.jquerify(t,r.check("auth-featuring").then(e,e))},getPrefix:function(){return""},loadUserbar:function(){var e,A,n,i,r;return e=this.getPrefix(),n=t.Deferred(),r=n.resolve,i=n.reject,A=n.promise,require(["packages/userbar/build/"+e+"userbar"],r,i),A()},bindListeners:function(){return A.on("@userbar",s.join(" "),this.socialAuth,this),A.on("@userbar","updateBalance",this.updateUserInfo,this),a.events.bind("scrollHandlers:prepare",this.detectPageType,this,{isSync:!0}),A.on("@userbar","updateBalance",this.renderBillingMenu,this),A.on("@achievements","notification-recieved",this.renderBillingMenu,this),this._purchaseHandler=this.renderBillingMenu.bind(this),document.addEventListener("purchaseComplete",this._purchaseHandler)},socialAuth:function(e){return i.auth(c[e]||e,!0)},unbindListeners:function(){return A.off("@userbar",s.join(" "),this.socialAuth,this),A.off("@userbar","updateBalance",this.updateUserInfo,this),a.events.unbind("scrollHandlers:prepare",this.detectPageType,this),A.off("@userbar","updateBalance",this.renderBillingMenu,this),A.off("@achievements","notification-recieved",this.renderBillingMenu,this),document.removeEventListener("purchaseComplete",this._purchaseHandler),this._purchaseHandler=null},detectPageType:function(e){var t,n,i,r;return this._lastPathName===window.location.pathname?void A.trigger("@userbar","closeDropdowns"):(this._lastPathName=window.location.pathname,n=this.getPathParts(),r="4game",t=this.element.getAttribute("data-4game-bar-states"),(null!=e&&null!=(i=e.state)?i.sectionsParams.isGameNav:void 0)&&(r="userbar"),n[0]?t?A.trigger("@userbar","pageType",{type:"custom",states:t,isRoot:!n[2],controller:n[0],refferer:r,background:this.getBGInfo.apply(this,n),theme:this.getThemeInfo.apply(this,n)}):"play"===n[1]?A.trigger("@userbar","pageType",{type:"play",isRoot:!n[2],controller:n[0],refferer:r,theme:this.getThemeInfo.apply(this,n)}):"install"!==n[1]&&document.body.getAttribute("data-game-data")?"security"===n[1]?A.trigger("@userbar","pageType",{type:"security",isRoot:!n[2],controller:n[0],refferer:r}):A.trigger("@userbar","pageType",{type:"other",isRoot:!n[2],controller:n[0],refferer:r}):A.trigger("@userbar","pageType",{type:"install",isRoot:!n[2],controller:n[0],refferer:r,background:this.getBGInfo.apply(this,n),theme:this.getThemeInfo.apply(this,n)}):A.trigger("@userbar","pageType",{type:"main",isRoot:!n[2],controller:n[0],refferer:r,theme:"EU"===this.config.area&&"bright"}),A.trigger("@userbar","pageOpened"))},getPathParts:function(){var e;return e=window.location.pathname.split("/"),e[0]||e.shift(),e[e.length-1]||e.pop(),window.location.hash&&e.push(window.location.hash.replace(/^\#/,"")),e},getThemeInfo:function(e,t,A){var n;return n="dark",(["rf","sims4","battlefield-hardline","assassins-creed-unity","civilization-beyond-earth","witcher-3-wild-hunt","just-cause-3"].indexOf(e)>=0||["achievements/what-it-is"].indexOf([e,t].join("/"))>=0)&&(n="bright"),n},getBGInfo:function(A,n,i){var r;switch(r={color:null,image:null,position:null},A){case"lineage2":case"lineage2pl":e.extend(r,this.getBGInfoFromEl(".pL2Lin_bMainTheme"));break;case"rf":e.extend(r,this.getBGInfoFromEl(".jsPageLayout"),{image:t(".pRf_bLayout__eMainBg").prop("src"),position:"50% 0",sizeX:"100%"});break;case"planetside2":case"lineage2de":r={color:"#2d2d33"};break;case"r2":e.extend(r,this.getBGInfoFromEl(".jsPageLayout"),{image:"data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABGAAD/4QMsaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjUtYzAxNCA3OS4xNTE0ODEsIDIwMTMvMDMvMTMtMTI6MDk6MTUgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2RkIzMTQ5RjA0NUExMUU0QUUzMjg4QkQ0QjYwNDc1RiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo2RkIzMTRBMDA0NUExMUU0QUUzMjg4QkQ0QjYwNDc1RiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjZGQjMxNDlEMDQ1QTExRTRBRTMyODhCRDRCNjA0NzVGIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjZGQjMxNDlFMDQ1QTExRTRBRTMyODhCRDRCNjA0NzVGIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4AJkFkb2JlAGTAAAAAAQMAFQQDBgoNAAAHFAAAB48AAAklAAAL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",position:"50% 0",edgeOpacity:!0,overlayColor:"rgba(27, 4, 2, 0.4)"});break;case"pointblank":e.extend(r,this.getBGInfoFromEl(".jsPageLayout"),{image:null});break;case"apb":r={color:"#1b2224",overlayColor:"rgba(14, 16, 17, 0.4)"};break;case"chaos-fighters":e.extend(r,{image:t(".page-header__bg").prop("src"),position:"50% 0",sizeX:"90%"});break;case"lineage2classic":e.extend(r,this.getBGInfoFromEl(".L2prebuy_classic__bg"));break;default:e.extend(r,this.getBGInfoFromEl(".jsPageLayout")),"aion"===A&&"flight"===i&&e.extend(r,{image:"data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABGAAD/4QMsaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjUtYzAxNCA3OS4xNTE0ODEsIDIwMTMvMDMvMTMtMTI6MDk6MTUgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxRTAxQjM5NTA2MzcxMUU0QUUzMjg4QkQ0QjYwNDc1RiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoxRTAxQjM5NjA2MzcxMUU0QUUzMjg4QkQ0QjYwNDc1RiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjFFMDFCMzkzMDYzNzExRTRBRTMyODhCRDRCNjA0NzVGIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjFFMDFCMzk0MDYzNzExRTRBRTMyODhCRDRCNjA0NzVGIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4AJkFkb2JlAGTAAAAAAQMAFQQDBgoNAAAGhwAABtIAAAkWAAAL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"})}return r},getBGInfoFromEl:function(e){var A;return A=t(e),A.length?{image:A.css("background-image").replace(/^url\(['"]?|['"]?\)/g,""),position:A.css("background-position")}:{}},getI18nOverrides:function(){return{mmo:o("Interface","PlatformSwitchMMO"),desktop:o("Interface","PlatformSwitchHits"),mobile:o("Interface","PlatformSwitchMobile"),ubersecurityTitle:o("Interface","UbersecurityPromo"),ubersecurityBtn:o("Interface","UbersecurityPromoButton")}},renderAuthMenu:function(){return t.when(n.ubersecurity.getIsActive(),n.user.getIdentities()).always(function(t){return function(t,i){var r,a,s,l,c,u;return a=e.find(i,function(e){return"email"===e.type}),s=e.find(i,function(e){return"tel"===e.type}),r=!t,u="empty",!r&&s||(u="component"),r?(l="account-security",c={link:"/settings/security/",section:"page"}):s||(l="mobile-reminder",c={link:"?popupWidget=SetContactWidget&contactType="+n.user.identityTypes.MOBILE,section:"popup"}),A.trigger("@userbar","!authMenu",[{text:o("Interface","SettingsAccountLink"),type:"link",link:"/settings/"},{text:o("Interface","SettingsPersonalLink"),type:"link",link:"/settings/personal/"},{text:o("Interface","SettingsSecurityLink"),type:"link",link:"/settings/security/"},{text:o("Interface","SettingsNotificationsLink"),type:"link",link:"/settings/notifications/"},{text:o("Interface","EventsLink"),type:"link",link:"/events/"},{type:u,component:"render-template",params:{name:l,params:c}},{type:"delimiter"},{id:"userBar-link-Logout",text:o("Interface","ExitButton"),type:"link",link:"/logout/",external:!0}])}}(this))},transformBuffData:function(e){var t,A,n,i;return e.maxSum?(n=Date.now(),t=e.buffs.filter(function(e){return e.expiresAt>n}),i=t.reduce(function(e,t){return e+ +t.buffPercent},0),A=t.length?t[0].expiresAt:0,t.forEach(function(e){return function(e){return A=e.expiresAt<A?e.expiresAt:A}}(this)),i?{maxSum:e.maxSum,expires:A,value:i}:null):null},updateBuffs:function(){return"RU"===this.config.area?t.Deferred(function(e){return function(t){return n.revault.get(l).then(function(n){var i;return i=e.transformBuffData(n),A.trigger("@userbar","updateBuffs",i),t.resolve(i)},function(e){return t.resolve(null),A.trigger("@userbar","updateBuffs",null)})}}(this)):t.Deferred(function(e){return function(e){return e.resolve(null)}}(this))},updateUserBalance:function(){return n.wallets.getByArea(this.config.area).then(function(e){return A.trigger("@userbar","!walletData",e),e})},renderBillingMenu:function(){return t.when(this.updateUserBalance(),this.updateBuffs()).always(function(e){return function(n,i){var r,a,s,l,c,u,g;switch(a=null!=(l=n.overdraft)?l.enabled:void 0,r=null!=(c=n.overdraft)?c.allowed:void 0,u={type:"component",component:"button",params:{id:"userBar-button-Replenish",type:"link",section:"popup",text:o("Payments","ReplenishAccount"),link:e.config.account.billing.replenishLink,wide:!0}},g=u,s={},n.frozenBonus&&(s={frozenBonus:n.frozenBonus,bonusUnfreezeAmount:n.bonusUnfreezeAmount||0}),i&&"RU"===e.config.area&&(s=t.extend(s,{buff:i})),(n.frozenBonus||i)&&(g={type:"component",component:"render-template",params:{name:"bonuses",params:t.extend(s,{button:u})}}),e.config.area){case"RU":return A.trigger("@userbar","!billingMenu",[g,{text:o("Interface","GiftCodes"),type:"link",link:e.config.account.billing.redeemLink},{text:o("Interface","CreditPopupTitle"),type:"link",link:"/licence/credit/",label:r&&(a?"включен":"выключен"),labelId:r&&(a?"userBar-div-CreditStatus_On":"userBar-div-CreditStatus_Off"),labelModifier:a?void 0:"dark"}]);case"EU":return A.trigger("@userbar","!billingMenu",[g,{text:o("Interface","RedeemPromoCode"),type:"link",link:e.config.account.billing.redeemLink,section:"popup"}])}}}(this))}}})}).call(this);
//# sourceMappingURL=mixins.js.map
