define(["module","packages/jquery"],function(e){var t=function(e,t){return function(r){return t[e.indexOf(r)]}}(["module","packages/jquery"],arguments),t=function r(e,n,i){function u(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof t&&t;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){var r=e[s][1][t];return u(r?r:t)},f,f.exports,r,e,n,i)}return n[s].exports}for(var o="function"==typeof t&&t,s=0;s<i.length;s++)u(i[s]);return u}({1:[function(e,t,r){"use strict";function n(){}function i(){return new TypeError("You cannot resolve a promise with itself")}function u(){return new TypeError("A promises callback cannot return that same promise.")}function o(e){try{return e.then}catch(t){return O.error=t,O}}function s(e,t,r,n){try{e.call(t,r,n)}catch(i){return i}}function a(e,t,r){(0,j.asap)(function(e){var n=!1,i=s(r,t,function(r){n||(n=!0,t!==r?f(e,r):p(e,r))},function(t){n||(n=!0,v(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&i&&(n=!0,v(e,i))},e)}function c(e,t){t._state===E?p(e,t._result):t._state===A?v(e,t._result):h(t,void 0,function(t){f(e,t)},function(t){v(e,t)})}function l(e,t){if(t.constructor===e.constructor)c(e,t);else{var r=o(t);r===O?v(e,O.error):void 0===r?p(e,t):(0,I.isFunction)(r)?a(e,t,r):p(e,t)}}function f(e,t){e===t?v(e,i()):(0,I.objectOrFunction)(t)?l(e,t):p(e,t)}function d(e){e._onerror&&e._onerror(e._result),g(e)}function p(e,t){e._state===k&&(e._result=t,e._state=E,0!==e._subscribers.length&&(0,j.asap)(g,e))}function v(e,t){e._state===k&&(e._state=A,e._result=t,(0,j.asap)(d,e))}function h(e,t,r,n){var i=e._subscribers,u=i.length;e._onerror=null,i[u]=t,i[u+E]=r,i[u+A]=n,0===u&&e._state&&(0,j.asap)(g,e)}function g(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n,i,u=e._result,o=0;o<t.length;o+=3)n=t[o],i=t[o+r],n?_(r,n,i,u):i(u);e._subscribers.length=0}}function y(){this.error=null}function m(e,t){try{return e(t)}catch(r){return x.error=r,x}}function _(e,t,r,n){var i,o,s,a,c=(0,I.isFunction)(r);if(c){if(i=m(r,n),i===x?(a=!0,o=i.error,i=null):s=!0,t===i)return void v(t,u())}else i=n,s=!0;t._state!==k||(c&&s?f(t,i):a?v(t,o):e===E?p(t,i):e===A&&v(t,i))}function b(e,t){try{t(function(t){f(e,t)},function(t){v(e,t)})}catch(r){v(e,r)}}Object.defineProperty(r,"__esModule",{value:!0});var I=e("./utils"),j=e("./asap"),k=void 0,E=1,A=2,O=new y,x=new y;r.noop=n,r.resolve=f,r.reject=v,r.fulfill=p,r.subscribe=h,r.publish=g,r.publishRejection=d,r.initializePromise=b,r.invokeCallback=_,r.FULFILLED=E,r.REJECTED=A,r.PENDING=k},{"./asap":2,"./utils":9}],2:[function(e,t,r){(function(t){"use strict";function n(e){p=e}function i(e){r.asap=h=e}function u(){var e=t.nextTick,r=t.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(r)&&"0"===r[1]&&"10"===r[2]&&(e=setImmediate),function(){e(l)}}function o(){return function(){d(l)}}function s(){var e=0,t=new _(l),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function a(){var e=new MessageChannel;return e.port1.onmessage=l,function(){e.port2.postMessage(0)}}function c(){return function(){setTimeout(l,1)}}function l(){for(var e=0;e<v;e+=2){var t=j[e],r=j[e+1];t(r),j[e]=void 0,j[e+1]=void 0}v=0}function f(){try{var t=e,r=t("vertx");return d=r.runOnLoop||r.runOnContext,o()}catch(n){return c()}}Object.defineProperty(r,"__esModule",{value:!0}),r.setScheduler=n,r.setAsap=i;var d,p,v=0,h=({}.toString,function(e,t){j[v]=e,j[v+1]=t,v+=2,2===v&&(p?p(l):g())});r.asap=h;var g,y="undefined"!=typeof window?window:void 0,m=y||{},_=m.MutationObserver||m.WebKitMutationObserver,b="undefined"!=typeof t&&"[object process]"==={}.toString.call(t),I="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,j=new Array(1e3);g=b?u():_?s():I?a():void 0===y&&"function"==typeof e?f():c()}).call(this,e("_process"))},{_process:10}],3:[function(e,t,r){"use strict";function n(e,t){var r=this;r._instanceConstructor=e,r.promise=new e(u.noop),r._validateInput(t)?(r._input=t,r.length=t.length,r._remaining=t.length,r._init(),0===r.length?(0,u.fulfill)(r.promise,r._result):(r.length=r.length||0,r._enumerate(),0===r._remaining&&(0,u.fulfill)(r.promise,r._result))):(0,u.reject)(r.promise,r._validationError())}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./utils"),u=e("./-internal");n.prototype._validateInput=function(e){return(0,i.isArray)(e)},n.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},n.prototype._init=function(){this._result=new Array(this.length)},r["default"]=n,n.prototype._enumerate=function(){for(var e=this,t=e.length,r=e.promise,n=e._input,i=0;r._state===u.PENDING&&i<t;i++)e._eachEntry(n[i],i)},n.prototype._eachEntry=function(e,t){var r=this,n=r._instanceConstructor;(0,i.isMaybeThenable)(e)?e.constructor===n&&e._state!==u.PENDING?(e._onerror=null,r._settledAt(e._state,t,e._result)):r._willSettleAt(n.resolve(e),t):(r._remaining--,r._result[t]=e)},n.prototype._settledAt=function(e,t,r){var n=this,i=n.promise;i._state===u.PENDING&&(n._remaining--,e===u.REJECTED?(0,u.reject)(i,r):n._result[t]=r),0===n._remaining&&(0,u.fulfill)(i,n._result)},n.prototype._willSettleAt=function(e,t){var r=this;(0,u.subscribe)(e,void 0,function(e){r._settledAt(u.FULFILLED,t,e)},function(e){r._settledAt(u.REJECTED,t,e)})},t.exports=r["default"]},{"./-internal":1,"./utils":9}],4:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function u(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function o(e){this._id=m++,this._state=void 0,this._result=void 0,this._subscribers=[],a.noop!==e&&((0,s.isFunction)(e)||i(),this instanceof o||u(),(0,a.initializePromise)(this,e))}Object.defineProperty(r,"__esModule",{value:!0});var s=e("./utils"),a=e("./-internal"),c=e("./asap"),l=e("./promise/all"),f=n(l),d=e("./promise/race"),p=n(d),v=e("./promise/resolve"),h=n(v),g=e("./promise/reject"),y=n(g),m=0;r["default"]=o,o.all=f["default"],o.race=p["default"],o.resolve=h["default"],o.reject=y["default"],o._setScheduler=c.setScheduler,o._setAsap=c.setAsap,o._asap=c.asap,o.prototype={constructor:o,then:function(e,t){var r=this,n=r._state;if(n===a.FULFILLED&&!e||n===a.REJECTED&&!t)return this;var i=new this.constructor(a.noop),u=r._result;if(n){var o=arguments[n-1];(0,c.asap)(function(){(0,a.invokeCallback)(n,i,o,u)})}else(0,a.subscribe)(r,i,e,t);return i},"catch":function(e){return this.then(null,e)}},t.exports=r["default"]},{"./-internal":1,"./asap":2,"./promise/all":5,"./promise/race":6,"./promise/reject":7,"./promise/resolve":8,"./utils":9}],5:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return new o["default"](this,e).promise}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=i;var u=e("../enumerator"),o=n(u);t.exports=r["default"]},{"../enumerator":3}],6:[function(e,t,r){"use strict";function n(e){function t(e){(0,u.resolve)(o,e)}function r(e){(0,u.reject)(o,e)}var n=this,o=new n(u.noop);if(!(0,i.isArray)(e))return(0,u.reject)(o,new TypeError("You must pass an array to race.")),o;for(var s=e.length,a=0;o._state===u.PENDING&&a<s;a++)(0,u.subscribe)(n.resolve(e[a]),void 0,t,r);return o}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n;var i=e("../utils"),u=e("../-internal");t.exports=r["default"]},{"../-internal":1,"../utils":9}],7:[function(e,t,r){"use strict";function n(e){var t=this,r=new t(i.noop);return(0,i.reject)(r,e),r}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n;var i=e("../-internal");t.exports=r["default"]},{"../-internal":1}],8:[function(e,t,r){"use strict";function n(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(i.noop);return(0,i.resolve)(r,e),r}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n;var i=e("../-internal");t.exports=r["default"]},{"../-internal":1}],9:[function(e,t,r){"use strict";function n(e){return"function"==typeof e||"object"==typeof e&&null!==e}function i(e){return"function"==typeof e}function u(e){return"object"==typeof e&&null!==e}Object.defineProperty(r,"__esModule",{value:!0}),r.objectOrFunction=n,r.isFunction=i,r.isMaybeThenable=u;var o;o=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var s=o;r.isArray=s},{}],10:[function(e,t,r){"use strict";function n(){d&&l&&(d=!1,l.length?f=l.concat(f):p=-1,f.length&&i())}function i(){if(!d){var e=s(n);d=!0;for(var t=f.length;t;){for(l=f,f=[];++p<t;)l&&l[p].run();p=-1,t=f.length}l=null,d=!1,a(e)}}function u(e,t){this.fun=e,this.array=t}function o(){}var s,a,c=t.exports={};!function(){try{s=setTimeout}catch(e){s=function(){throw new Error("setTimeout is not defined")}}try{a=clearTimeout}catch(e){a=function(){throw new Error("clearTimeout is not defined")}}}();var l,f=[],d=!1,p=-1;c.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new u(e,t)),1!==f.length||d||s(i,0)},u.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=o,c.addListener=o,c.once=o,c.off=o,c.removeListener=o,c.removeAllListeners=o,c.emit=o,c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=function(e){return{get:function(){return e.get("users/#{userId}/achievements")},markAsViewed:function(t){return e.post("users/#{userId}/page-views/"+t+"/feed")}}},t.exports=r["default"]},{}],12:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var u=e("packages/jquery"),o=i(u),s=e("./helpers"),a=n(s);r["default"]=function(e){return{get:function(){return e.send("get","users/#{userId}/apps")},getApp:function(e){return this.get().then(a.filterByAppId(e||"4game")).then(function(e){return e?e:o["default"].Deferred().reject({status:404},"error","Application not found")})},getSignInCode:function(t,r,n){return e.send("post","users/#{userId}/apps/"+t+"/sign-in-codes",{device:r+":"+n})},getUserCharacters:function(t){return e.send("get","users/#{userId}/apps/"+t+"/characters")},getUserWorlds:function(t){return e.send("get","users/#{userId}/apps/"+t+"/worlds")}}},t.exports=r["default"]},{"./helpers":16,"packages/jquery":void 0}],13:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("packages/jquery"),u=n(i);r["default"]={getCredentials:function(){return this.auth.auth().then(function(e){return e.getCredentials()})},getCaptchaImgUrl:function(e,t){var r=this.getRulesForResource("get","captcha/"+e);return[r.baseUrl,"captcha",e].join("/")+(t?"?"+u["default"].param(t):"")},getJWT:function(e){return this.send("post","auth/jwt/"+(e||"deskpro")+"/tokens")},getOAuthUrl:function(e){var t="auth/oauth/"+e,r=this.getRulesForResource("get",t);return[r.baseUrl,t,r.appId].join("/")+(r.returnUrl?"?returnUrl="+r.returnUrl:"")}},t.exports=r["default"]},{"packages/jquery":void 0}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=function(e){return{getCountries:function(){return e.send("get","countries").then(function(e){return e.countries})}}},t.exports=r["default"]},{}],15:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./helpers"),u=n(i);r["default"]=function(e){return{getByApp:function(t){return e.send("get","apps/"+u.getAppId(t))}}},t.exports=r["default"]},{"./helpers":16}],16:[function(e,t,r){"use strict";function n(e){return("00"+(e||"")).slice(-2)}function i(e){return"string"==typeof e?parseInt(e.split("-")[0],10):e}function u(e){if("string"==typeof e){var t=e.split("-");return t.shift(),t.join("-")}}function o(e){return function(t){for(var r=t.apps,n=0;n<r.length;n++){var i=r[n];if(i.appId==e)return i}}}function s(e){var t=e.getTimezoneOffset();return["+","−"][+(t>0)]+[~~(t/a),t%a].map(Math.abs).map(n).join(":")}Object.defineProperty(r,"__esModule",{value:!0}),r.getAppId=i,r.getGameName=u,r.filterByAppId=o,r.getISOTimezone=s;var a=-60},{}],17:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var u=e("packages/jquery"),o=i(u),s=e("../utils"),a=(n(s),e("./apps")),c=i(a);r["default"]=function(e,t){function r(t){return t instanceof Array?o["default"].when.apply(null,t.map(function(t){return e.get(t.href)})):e.get(t.href)}var n=(0,c["default"])(e,t),i={ACCEPTED:"accepted",CONSIDER:"consider",REQUIRED:"required"},u={required:"accept",consider:"consider"};return{types:i,get:function(e){var t=this;return"object"==typeof e?r(e):n.getApp(e).then(function(e){var n=[];return e._links.agreements&&n.push(r(e._links.agreements).then(function(){for(var r=arguments.length,n=Array(r),u=0;u<r;u++)n[u]=arguments[u];var s=o["default"].Deferred(),a=n.map(function(r){var n,u=i.ACCEPTED;e._embedded.agreements.some(function(e){if(e._links.self.href===r._links.self.href)return e._links.accept?(n=e._links.accept.href,u=i.REQUIRED):e._links.consider?(n=e._links.consider.href,u=i.CONSIDER):n=e._links.self.href,!0});var o={type:u,agreement:{id:r.agreementId,acceptedAt:r.acceptedAt,info:r._embedded.conflux}};return u!==i.ACCEPTED&&(o.accept=t.accept.bind(t,n||r.agreementId)),o});return s.resolve.apply(s,a)})),o["default"].when.apply(null,n).then(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n={};return t.forEach(function(e){e&&(n[e.type]||(n[e.type]=[]),n[e.type].push(e))}),Object.keys(n).length?n:o["default"].Deferred().reject({status:404},"error","Licenses not found")})})},accept:function(t){var r="users/#{userId}/agreements/"+t+"/acceptance";return"object"==typeof t&&(r=t.href),e.put(r)},acceptAll:function(e,t){var r=this;return t||(t=i.REQUIRED),n.getApp(e).then(function(e){var n=[],i=[];return e._embedded.agreements.forEach(function(e){e._links[u[t]]&&(n.push(e._links[u[t]]),i.push(e._links.self))}),n.length?o["default"].when.apply(null,n.map(r.accept)).then(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return{success:t.map(function(e,t){return o["default"].extend({_links:{self:i[t]}},e)})}}):o["default"].Deferred().reject({status:404},"error","Licenses not found")})},hasRequired:function(e){return n.getApp(e).then(function(e){return e._embedded.agreements.some(function(e){return!!e._links[u[i.REQUIRED]]})})}}},t.exports=r["default"]},{"../utils":35,"./apps":12,"packages/jquery":void 0}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=function(e){return{create:function(t){return e.send("post","orders",t)},purchase:function(t){return e.send("post","orders/"+t+"/purchases")}}},t.exports=r["default"]},{}],19:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("packages/jquery"),u=n(i);r["default"]=function(e){return{generate:function(t,r,n){return null==n||""==n?u["default"].Deferred().reject({status:400},"error","Unspecified second argument (idempotencyKey)"):e.put("users/#{userId}/pincodes/"+n,{emissionId:t,extra:r})},activate:function(t,r,n){return e.post("users/#{userId}/pincodes/"+t+"/activations",{extra:r},n)}}},t.exports=r["default"]},{"packages/jquery":void 0}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=function(e){return{get:function(t){return e.send("get","profiles/userid:"+t)},getByUsername:function(t){return e.send("get","profiles/username:"+t)}}},t.exports=r["default"]},{}],21:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("packages/jquery"),u=n(i);r["default"]=function(e){return{get:function(t){var r=[].concat(t||[]);return e.send("get","users/#{userId}/storage/"+r.join("/"))},set:function(t,r){var n=[].concat(t||[]);return e.send("put","users/#{userId}/storage/"+n.join("/"),r)},"delete":function(t){var r=[].concat(t||[]);return e.send("delete","users/#{userId}/storage/"+r.join("/"))},poll:function t(e,r){function n(e){"function"==typeof r.failAttemptHandler&&r.failAttemptHandler(e,l,c),c-l++?setTimeout(t,a):s.reject({data:e,status:"failure",error:"Unable to retrieve requested value"})}function i(e){return"function"==typeof r.checkHandler?!!r.checkHandler(e):!!e}function t(){o.get(e).done(function(e){i(e)?s.resolve({data:e,status:"success"}):n(e)}).fail(n)}r||(r={});var o=this,s=u["default"].Deferred(),a=r.pollingTimeout||3e3,c=r.pollingAttempts||5,l=1;return null!=e?t():s.reject({status:"failure",error:"Key should not be empty value"}),s}}},t.exports=r["default"]},{"packages/jquery":void 0}],22:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}Object.defineProperty(r,"__esModule",{value:!0});var o=e("packages/jquery"),s=i(o),a=e("../utils"),c=(n(a),e("./user")),l=i(c);r["default"]=function(e,t){var r=(0,l["default"])(e,t);return function(){var t=arguments.length<=0||void 0===arguments[0]?u():arguments[0],n=[];return Object.defineProperties({add:function(t){var r,i=t.split(".").filter(Boolean).reduce(function(e,t){return null!=e[t]?(r=e,e[t]):e},e);if(r&&"function"==typeof i){for(var u=arguments.length,o=Array(u>1?u-1:0),a=1;a<u;a++)o[a-1]=arguments[a];var c=i.apply(Object.create(r,{sagaId:{value:this.id}}),o);return n.push(c),c}return s["default"].Deferred().reject({status:405},"error","Unsupported method")},elevatePrivilege:function(t,i,u){var t=t||"device_confirm_code",o="users/#{userId}/sagas/"+this.id;return e.uriToHref(o).then(function(e){var o=n.filter(function(e){return"pending"===e.state()});return s["default"].when.apply(s["default"],o).then(function(){return r.elevatePrivilege(t,{href:e,templateContext:u},null,null,i)})})},complete:function(t,r){return e.send("patch",r||"users/#{userId}/sagas/"+this.id,{state:"completed"},{contentType:"application/vnd+saga-status.json",privilegeElevationCode:t})}},{id:{get:function(){return t},configurable:!0,enumerable:!0}})}},t.exports=r["default"]},{"../utils":35,"./user":26,"packages/jquery":void 0}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=function(e){return{get:function(){return e.get("users/#{userId}/status-monitor")}}},t.exports=r["default"]},{}],24:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){e.length=0,Array.prototype.push.apply(e,t)}Object.defineProperty(r,"__esModule",{value:!0});var o=e("../lib/promise"),s=i(o),a=e("../lib/storage"),c=n(a),l=e("./helpers"),f=e("../utils"),d={};r["default"]=function(e){function t(e){return a.push(e),c.setItem(h,JSON.stringify(a)),a}function r(){var e=a.filter(function(e){return p.indexOf(e)<0});return!!e.length&&(e.length=Math.min(e.length,v.trackMaxBatchListSize||25),u(p,p.concat(e)),{list:e,flush:function(){u(a,a.filter(function(t){return e.indexOf(t)<0})),this.unlock(),c.setItem(h,JSON.stringify(a))},unlock:function(){u(p,p.filter(function(t){return e.indexOf(t)<0}))}})}function n(n,u){var a,c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],d=n||{},p=new Date,h={timestamp:p.getTime(),timezone:window.Intl&&Intl.DateTimeFormat().resolvedOptions().timeZone,timezoneOffset:(0,l.getISOTimezone)(p),referer:document.referrer},g=c.forced;if(d="string"==typeof d?(0,f.assign)(h,c,{event:n,extra:u}):(0,f.assign)(h,d),null!=d.event&&t(d),o.request&&!o.request.completed&&!g)return o.request;var y=r();return y?(a=e("post",v.url||"users/#{userId}/trackings",{trackings:y.list,requestTimestamp:Date.now()},{retryAttempts:2}).then(function(){y.flush()},function(e){return 400===e.status?y.flush():y.unlock(),e.status}),g?(a=a.then(function(){return a.completed=!0}),a.completed||(a.completed=!1)):(o.request=a,o.request.completed=!1,o.request.then(i,i)),a):s["default"].resolve()}function i(e){return new s["default"](function(t){setTimeout(function(){t(o.request.completed=!0),a.length&&(!e||e>=500)&&n()},g)})}var o,a,p,v=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],h="4g.track-"+v.uid,g=v.trackAccumulateTimeout||3e3;return d[h]?(a=d[h].queue,p=d[h].locked,o=d[h].active):d[h]={queue:a=JSON.parse(c.getItem(h)||"[]"),locked:p=[],active:o={}},a.length&&n(),n},t.exports=r["default"]},{"../lib/promise":32,"../lib/storage":34,"../utils":35,"./helpers":16}],25:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("packages/jquery"),u=(n(i),e("../utils")),o=e("./user"),s=n(o);r["default"]=function(e,t){var r=(0,s["default"])(e,t);return{getIsActive:function(){return r.getSettings().then(function(e){return e.multifactor})},turnOn:function(t){var n=r.privilageElevationTemplates.ENABLE_UBERSECURITY,i="users/#{userId}/settings",u=this.sagaId;return e.uriToHref(i).then(function(o){return r.elevatePrivilege(n,{href:o},function(t){return e.send("patch",i,{multifactor:!0},{contentType:"application/vnd+user-settings-multifactor.json",privilegeElevationCode:t,sagaId:u})},u,t)})},turnOff:function(t){var n=r.privilageElevationTemplates.DISABLE_UBERSECURITY,i="users/#{userId}/settings",u=this.sagaId;return e.uriToHref(i).then(function(o){return r.elevatePrivilege(n,{href:o},function(t){return e.send("patch",i,{multifactor:!1},{contentType:"application/vnd+user-settings-multifactor.json",privilegeElevationCode:t,sagaId:u})},u,t)})},getDevicesList:function(){return r.getIdentities().then(function(e){return e.filter(function(e){return"device"===e.type})})},addDevice:function(e,t,n,i){var o=this.sagaId;return r.setIdentity("device",[e,t].join(":"),(0,u.assign)({expiration:"short"},n),o,i)},removeDevice:function(e,t,n){var i=this.sagaId;return r.deleteIdentity("device",[e,t].join(":"),i,n)}}},t.exports=r["default"]},{"../utils":35,"./user":26,"packages/jquery":void 0}],26:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function u(e,t,r){var n={result:e,validate:function(e,r){return"function"==typeof t?t(e,r):s["default"].Deferred().resolve()}};return"function"==typeof r&&(n.renew=r),n}Object.defineProperty(r,"__esModule",{value:!0});var o=e("packages/jquery"),s=i(o),a=e("../utils"),c=n(a),l=e("./helpers"),f=n(l),d=e("../lib/base64"),p=i(d),v={EMAIL:1,MOBILE:3,FACEBOOK:4,VKONTAKTE:5,TWITTER:6,DEVICE:13,ODNOKLASSNIKI:14,YANDEX:17},h={PASSWORD:"***"},g={tel:v.MOBILE,email:v.EMAIL,device:v.DEVICE},y={UBERSECURITY:101},m={ADD:1,CHANGE:2,DELETE:3},_={ADD_EMAIL:"privilege-elevation.add-email",ADD_MOBILE:"privilege-elevation.add-tel",DELETE_MOBILE:"privilege-elevation.delete-tel",ADD_DEVICE:"privilege-elevation.add-device",DELETE_DEVICE:"privilege-elevation.delete-device",ENABLE_UBERSECURITY:"privilege-elevation.enable-multifactor",DISABLE_UBERSECURITY:"privilege-elevation.disable-multifactor",PLAY_FROM_UNKNOWN_DEVICE:"privilege-elevation.sign-in-untrusted-device"},b={tel:"application/vnd+identity-tel.json",email:"application/vnd+identity-email.json",device:"application/vnd+identity-device.json",fb:"application/vnd+identity-fb.json",vk:"application/vnd+identity-vk.json",ok:"application/vnd+identity-ok.json",ya:"application/vnd+identity-ya.json",empty:"application/vnd+identified-user.json"},I={tel:"identity-verification.verify-tel",email:"identity-verification.verify-email"},j=["vk","fb","ok","ya"];r.acceptedSocialNetworks=j;var k={"unban-identity":{error:"contact-banned",message:"Contact is banned"},user:{error:"contact-conflict",message:"Contact is in use"},blacklisted:{error:"email-domain-banned",message:"Email domain is banned"},unreliable:{error:"email-unreliable",message:"Email is in unreliable list. No delivery garanties"},"current-unreliable":{error:"current-email-unreliable",message:"Current email is in unreliable list. No delivery garanties"}},E=["unban-identity","user","blacklisted","unreliable"];r["default"]=function(e,t){var r={};return{actions:m,identityTypes:v,settingsTypes:y,identityConstants:h,privilageElevationTemplates:_,login:function(t,r){var n=e.getRulesForResource("get","auth");return"boolean"==typeof t&&("boolean"!=typeof r&&(r=t),t=null),e.auth.auth(t,r?n.expires["long"]:n.expires["short"])},register:function(e,t,r,n,i){var o=this,n=n||this.sagaId;switch(e){case"tel":case"email":return this.verifyIdentity(e,t,{__template:"identity-verification.registration",contact_address_to:t,service_id:r.serviceId,related_game:r.relatedGameName,referrer:r.referrer,partner_id:r.pid,subpid:r.subpid},function(a,c){return u({identity:e+":"+t},function(u,c){return o.continueRegister(e,t,s["default"].extend({password:u},a,r),n,s["default"].extend({},i,c))})},n,i);default:return s["default"].Deferred().reject({status:500},"error","Not implemented")}},continueRegister:function(t,r,n,i,u){var u=Object.create(u||null),i=i||this.sagaId,o=e.getRulesForResource("get","auth/oauth/"+t);j.indexOf(t)>=0&&(r=(n.socialAppId||o.appId)+":"+r,delete n.socialAppId);var s={identity:t+":"+r,password:n.password,verificationCode:n.code,pid:n.pid,subpid:n.subpid,referrer:n.referrer,language:n.language,country:n.country},a=b.empty;return u.contentType=a,u.sagaId=i,e.send("post","users",s,u)},getAccounts:function(t){return e.send("get","users/#{userId}/accounts",{appId:f.getAppId(t)})},checkAccount:function(e){return this.getAccounts(e).then(function(e){return!!e.length})},getAccount:function(e){return this.getAccounts(e).then(function(e){return e[0]})},createAccount:function(t){return e.send("post","users/#{userId}/accounts",{appId:f.getAppId(t)})},getContacts:function(){return e.send("get","users/#{userId}").then(function(e){return"anonymous"===e.userId?(c.warning("Throwing %s error because returned user contacts for %s user.",401,"anonymous"),s["default"].Deferred().reject({status:401},"error","Unauthorized")):e})},addContacts:function(t){return e.send("patch","users/#{userId}",t,{contentType:"application/vnd+user-names.json"})},getSettings:function(){return e.send("get","users/#{userId}/settings")},getIdentities:function(){return e.send("get","users/#{userId}/identities").then(function(e){return e.filter(function(e){return!("device"===e.type&&"short"===e.expiration)})})},setIdentity:function(e,t,r,n,i){var u=this;if(void 0===n&&(n=this.sagaId),j.indexOf(e)>=0)return this.continueSetIdentity(e,t,r,null,n,i);switch(e){case"tel":case"email":return this.getIdentities().then(function(r){var o=!!r.filter(function(t){return t.type===e}).length,a=o?m.CHANGE:m.ADD;return u.verifyIdentity(e,t,{identityContact:t,contactType:g[e],contactAction:a},function(r,o){return u.processVerifiedIdentity(a,e,t,r,n,s["default"].extend({},i,o))},n,i)});case"device":return this.processVerifiedIdentity(m.ADD,e,t,r,n,i);default:return s["default"].Deferred().reject({status:500},"error","Unsupported identity type "+e)}},processVerifiedIdentity:function(t,r,n,i,u,o){var a=this,c="",l="users/#{userId}/identities/"+r+":"+n,u=u||this.sagaId,f=function(e,o){switch(t){case m.ADD:case m.CHANGE:return a.continueSetIdentity(r,n,i,e,u,o);case m.DELETE:return a.continueDeleteIdentity(r,n,e,u,o)}};switch(r){case"tel":switch(t){case m.ADD:case m.CHANGE:c=_.ADD_MOBILE;break;case m.DELETE:c=_.DELETE_MOBILE}break;case"email":c=_.ADD_EMAIL;break;case"device":switch(t){case m.ADD:case m.CHANGE:c=_.ADD_DEVICE;break;case m.DELETE:c=_.DELETE_DEVICE}}return this.getIdentities().then(function(d){var p=d.some(function(e){return["tel","email"].indexOf(e.type)>=0});return p?e.uriToHref(l).then(function(e){return a.elevatePrivilege(c,{href:e,templateContext:{identityContact:n,verificationCode:i&&i.code,contactType:g[r],contactAction:t}},function(e,t){return f(e,s["default"].extend({},o,t))},u,o)}):f("empty",o)})},continueSetIdentity:function(t,r,n,i,u,o){void 0===n&&(n={});var s=e.getRulesForResource("get","auth/oauth/"+t);j.indexOf(t)>=0&&(r=(n.socialAppId||s.appId)+":"+r,delete n.socialAppId);var a="users/#{userId}/identities/"+t+":"+r,o=Object.create(o||null),u=u||this.sagaId,c=b[t];return["tel","email"].indexOf(t)>=0&&(n={verificationCode:n.code}),o.privilegeElevationCode=i,o.contentType=c,o.sagaId=u,e.send("put",a,n,o)},deleteIdentity:function(e,t,r,n){var r=r||this.sagaId;return j.indexOf(e)>=0?this.continueDeleteIdentity(e,t,null,r,n):this.processVerifiedIdentity(m.DELETE,e,t,null,r,n)},continueDeleteIdentity:function(t,r,n,i,u){var o=e.getRulesForResource("get","auth/oauth/"+t);j.indexOf(t)>=0&&(r=o.appId+":"+r);var s="users/#{userId}/identities/"+t+":"+r,u=Object.create(u||null),i=i||this.sagaId;return u.privilegeElevationCode=n,u.sagaId=i,e.send("delete",s,null,u)},verifyIdentity:function(t,n,i,o,a,c){var l=this;i||(i={});var f=null,d=null;i.__template&&(f=i.__template,delete i.__template);var p=arguments,v={template:f||I[t]||"",context:i},h=s["default"].Deferred();return d=r["identity_verifications-identity_check"]?r["identity_verifications-identity_check"]:this.checkIfIdentityCanBeUsed(t,n,c).then(function(){return r["identity_verifications-identity_check"]=h,h.resolve()}),d.then(function(){return e.send("post","identity-verifications/"+t+":"+n+"/codes",v,c).then(function(e){return delete r["identity_verifications-identity_check"],u(e,function(e,r){return l.validateVerificationCode(t,n,e,s["default"].extend({},c,r)).then(o)},function(e){return s["default"].extend(c,e),l.verifyIdentity.apply(l,p)})})})},validateVerificationCode:function(t,r,n,i){return e.send("post","identity-verifications/"+t+":"+r+"/validations",{code:n},i).then(function(){return s["default"].Deferred().resolve({code:n},i)})},checkIdentityExist:function(t,r,n){return c.warning("%s is deprecated and will be removed in a future release. Use %s instead.","checkIdentityExist","getIdentityRelations"),e.send("get","users",{identity:t+":"+r},n).then(function(e){return!!e.users.length})},getIdentityRelations:function(t,r,n){var i=s["default"].Deferred(),u=t+":"+r;return e.send("get","identities/"+u,null,n).then(function(e){i.resolve(e)},function(e){404===e.status?i.resolve({_links:{},identity:u}):i.reject.apply(this,arguments)}),i},checkIfIdentityCanBeUsed:function(e,t,r){return this.getIdentityRelations(e,t,r).then(function(r){var n=s["default"].Deferred();if(Object.keys(r._links).length){var i={_links:r._links,identity:{type:e,value:t}};return E.some(function(e){if(e in r._links)return s["default"].extend(i,k[e]),
!0}),n.reject({status:409,responseJSON:i},"error",i.message)}return n.resolve(!0)})},hasIdentity:function(t,r,n){var i=s["default"].Deferred();return e.send("get","users/#{userId}/identities/"+t+":"+r,null,n).then(function(e){i.resolve(!0)},function(e,t,r){404===e.status?i.resolve(!1):i.reject(e,t,r)}),i},elevatePrivilege:function(t,n,i,o,a){var c=this,l=arguments,f={link:{href:n.href},template:t,context:n.templateContext||{}};return o?"function"==typeof i?i(null,a):s["default"].Deferred().resolve():this.getIdentities().then(function(t){var n,o,d;if(t.forEach(function(e){"tel"===e.type?n=e.value:"email"===e.type&&(o=e.value)}),null!=o&&null==n){var p=s["default"].Deferred();d=r["privilege_elevations-identity_check"]?r["privilege_elevations-identity_check"]:c.checkIfIdentityCanBeUsed("email",o,a).then(function(){return r["privilege_elevations-identity_check"]=p,p.resolve()},function(e,t,n){return 409===e.status?("unreliable"in e.responseJSON._links?(s["default"].extend(e.responseJSON,k["current-unreliable"]),p.reject(e,t,n)):(r["privilege_elevations-identity_check"]=p,p.resolve()),p):p.reject(e,t,n)})}else d=s["default"].Deferred().resolve();return d.then(function(){return e.send("post","users/#{userId}/privilege-elevations",f,a).then(function(e){return delete r["privilege_elevations-identity_check"],u(e,i,function(e){return s["default"].extend(a,e),c.elevatePrivilege.apply(c,l)})})})})},createOrderFor:function(t,r,n){var i=this,u=Date.now(),o=JSON.stringify(s["default"].extend({customOrderId:u},n));return e.send("post","users/#{userId}/orders",{products:t?t.length?t:[t]:void 0,price:r||0,params:o}).then(function(e){return s["default"].Deferred().resolve(e,{customOrderId:u,purchase:function(){return this.purchaseOrder(e.orderId)}.bind(i)})})},purchaseOrder:function(t){return e.send("post","users/#{userId}/orders/"+t+"/purchases")},getAvatar:function(t,r){if(t===v.ODNOKLASSNIKI){var n=e.getRulesForResource("get","auth/oauth/ok");return e.send("get","ok/avatar",null,{gateway:!0,headers:{Authorization:"ok "+(0,p["default"])((r.appId||n.appId)+":"+r.accessToken)}}).then(function(e){return{url:e.avatarUrl}})}return s["default"].Deferred().reject({status:500},"error","Not implemented")}}}},{"../lib/base64":31,"../utils":35,"./helpers":16,"packages/jquery":void 0}],27:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("packages/jquery"),u=n(i);r["default"]=function(e){return{get:function(){return e.get("users/#{userId}/wallets")},getByArea:function(e){return this.get().then(function(t){var r;return t.wallets.some(function(t){if(t.area.toLowerCase()===e.toLowerCase())return r=t,!0}),r}).then(function(e){return e?e:u["default"].Deferred().reject({status:404},"error","Area not found")})}}},t.exports=r["default"]},{"packages/jquery":void 0}],28:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var u=e("./utils"),o=e("./api/common"),s=i(o),a=e("./api/helpers"),c=n(a),l=e("./api/user"),f=i(l),d=e("./api/profile"),p=i(d),v=e("./api/revault"),h=i(v),g=e("./api/orders"),y=i(g),m=e("./api/ubersecurity"),_=i(m),b=e("./api/flags"),I=i(b),j=e("./api/saga"),k=i(j),E=e("./api/apps"),A=i(E),O=e("./api/dictionaries"),x=i(O),w=e("./api/licenses"),D=i(w),C=e("./api/achievements"),T=i(C),M=e("./api/pincodes"),P=i(M),R=e("./api/track"),U=i(R),N=e("./api/wallets"),S=i(N),q=e("./api/status-monitor"),L=i(q);r["default"]=function(e,t){return(0,u.assign)({},s["default"],{helpers:c,user:(0,f["default"])(e,t),profile:(0,p["default"])(e,t),revault:(0,h["default"])(e,t),orders:(0,y["default"])(e,t),ubersecurity:(0,_["default"])(e,t),flags:(0,I["default"])(e,t),saga:(0,k["default"])(e,t),apps:(0,A["default"])(e,t),dictionaries:(0,x["default"])(e,t),licenses:(0,D["default"])(e,t),achievements:(0,T["default"])(e,t),pincodes:(0,P["default"])(e,t),track:(0,U["default"])(e.send.bind(e),(0,u.assign)({uid:e.uid},t)),wallets:(0,S["default"])(e,t),statusMonitor:(0,L["default"])(e,t)})},t.exports=r["default"]},{"./api/achievements":11,"./api/apps":12,"./api/common":13,"./api/dictionaries":14,"./api/flags":15,"./api/helpers":16,"./api/licenses":17,"./api/orders":18,"./api/pincodes":19,"./api/profile":20,"./api/revault":21,"./api/saga":22,"./api/status-monitor":23,"./api/track":24,"./api/ubersecurity":25,"./api/user":26,"./api/wallets":27,"./utils":35}],29:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var u=e("packages/jquery"),o=i(u),s=e("../../api/user"),a=e("../storage"),c=n(a),l=e("../base64"),f=i(l),d="api-auth";r["default"]={_request:null,_deferred:null,uid:null,ticket:null,config:null,auth:function(e,t){var r=this,n={"Accept-Language":this.config.lang,"X-Area":this.config.area};if("string"==typeof e&&(t||(t=e),e=null),this._deferred&&"pending"===this._deferred.state()){if("pending"===this._deferred.state()){if(!e)return this._deferred;this._request&&this._request.abort()}}else this._deferred=o["default"].Deferred();var i,u=s.acceptedSocialNetworks.some(function(t){if(e&&e[t])return i=t+" "+(0,f["default"])((e.appId||r.config[t+"AppId"])+":"+e[t]),!0});if(e&&e.login&&e.password)n.Authorization="basic "+(0,f["default"])((""+e.login).trim()+":"+(""+e.password).trim());else if(u)n.Authorization=i;else{if(this.ticket.getUserId())return this._deferred.resolve(this.ticket);var a=this.retrieveResult();if(a&&a.accessToken===this.ticket.getAccessToken()&&a.userId)return this.ticket.setCredentials(a),this._deferred.resolve(this.ticket);if(!this.ticket.getAccessToken())return this._deferred.reject({status:401},"error","Unauthorized");n.Authorization="bearer "+this.ticket.getAccessToken()}return e&&e.captcha&&(n["Human-Validation"]="Captcha id="+e.captcha.id+",value="+e.captcha.value),this._request=this.request(this.requestData(e,t),n),this._request.then(function(e){r.cacheResult(e),r.ticket.setCredentials(Object.create(e)),r._deferred.resolve(r.ticket)},function(e,t,n){"abort"!=t&&r._deferred.reject(e,t,n)}),this._deferred},cacheResult:function(e){return c.setItem(d+"-"+this.uid,JSON.stringify(e)),e},retrieveResult:function(){return JSON.parse(c.getItem(d+"-"+this.uid))},request:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return o["default"].ajax({method:"POST",url:this.config.url,data:JSON.stringify(e),headers:t,contentType:"application/json"})},requestData:function(e,t){var r={};return r[this.config.tokenKeyName||"token"]=t,r}},t.exports=r["default"]},{"../../api/user":26,"../base64":31,"../storage":34,"packages/jquery":void 0}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=function(){var e={userId:null,expiresAt:null,expiresIn:null,accessToken:null,firebaseToken:null};return{setCredentials:function(t){return t&&(null!=t.userId&&(e.userId=t.userId),null!=t.expiresAt&&(e.expiresAt=t.expiresAt),null!=t.expiresIn&&(e.expiresIn=t.expiresIn),null!=t.accessToken&&(e.accessToken=t.accessToken),null!=t.firebaseToken&&(e.firebaseToken=t.firebaseToken)),this},getCredentials:function(){return Object.create(e)},getUserId:function(){return e.userId},getExpiresIn:function(){return e.expiresIn?e.expiresIn:Math.ceil((+new Date(e.expiresAt)-Date.now())/1e3)},getExpiresAt:function(){return e.expiresAt},getAccessToken:function(){return e.accessToken},getFirebaseToken:function(){return e.firebaseToken}}},t.exports=r["default"]},{}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t="";if("function"==typeof window.btoa)try{t=window.btoa(unescape(encodeURIComponent(e)))}catch(r){}return t},t.exports=r["default"]},{}],32:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("es6-promise/lib/es6-promise/promise"),u=n(i);r["default"]="undefined"!=typeof Promise?Promise:u["default"],t.exports=r["default"]},{"es6-promise/lib/es6-promise/promise":4}],33:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){return t=t.split("/").filter(function(e){return e}).map(function(e,t,r){return t===r.length-1&&e.indexOf("?")>=0?e.split("?").map(function(e,t){return t?e:encodeURIComponent(e)}).join("?"):encodeURIComponent(e)}).join("/"),[e,t].join("/").replace(/\/\s*$/,"")}function o(e,t,r){var n=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],i=n;n=f({},i),e=e.toLowerCase();var o,s=this.config,c=f({"Accept-Language":s.lang,Authorization:"Anonymous","X-Area":s.area},n.headers||{}),v=this.token,h=u(n.gateway?s.gatewayUrl:s.baseUrl,t);if(v&&(c.Authorization="bearer "+v),n.captcha&&(p[h]&&(c["Human-Validation"]="Captcha id="+n.captcha.id+",value="+n.captcha.value),delete n.captcha),n.sagaId&&(c.Saga="batch "+n.sagaId,delete n.sagaId,delete n.privilegeElevationCode),n.privilegeElevationCode&&(c["Privilege-Elevation"]="empty","empty"!==n.privilegeElevationCode&&(c["Privilege-Elevation"]="code "+n.privilegeElevationCode),delete n.privilegeElevationCode),!s)return l.warning("If you trying to make request through connector's methods then you should provide config object or use api's %s method. Example: %s","send","api.send('options tokens')"),a["default"].Deferred().reject({status:400},"error","No config were provided");n.contentType||(n.contentType="application/json"),["get","options","head"].indexOf(e)<0&&d.test(n.contentType)&&(r=JSON.stringify(r||{}));var g=f({data:r,xhrFields:{withCredentials:!0},retryAttempts:s.requestDefaultRetryAttempts||0,retryTimeout:function(){var e=1e3,t=1e4,r=2;return function(){return e=Math.min(e*r,t)}}()},n,{method:e.toUpperCase(),headers:c});return"function"==typeof s.mockResponse?(o=a["default"].Deferred(),setTimeout(function(){l.warning("Response for %s was resolved with mocked result",[g.method,h].join(" ")),o.resolve(s.mockResponse(t,g),"success",{status:200})},Math.floor(1e3*Math.random())+500)):o=a["default"].ajax(h,g).then(null,function y(e,t,r){var n=a["default"].Deferred(),i=this;if(e.status>=500&&i.retryAttempts-- >0){var u=i.retryTimeout;"function"==typeof u&&(u=u(i.retryAttempts)),setTimeout(function(){a["default"].ajax(i).then(null,y).then(n.resolve,n.reject)},u||0)}else n.reject(e,t,r);return n}),o.then(function(t,r,n){return"function"==typeof s.responsePreprocessor&&(t=s.responsePreprocessor(t)),p[h]&&(i.captcha&&delete i.captcha,delete p[h]),["options","head"].indexOf(e)>=0?a["default"].Deferred().resolve(n):t},function(e,t,r){return[412,429].indexOf(e.status)>=0&&(p[h]=!0),a["default"].Deferred().reject(e,t,r)})}Object.defineProperty(r,"__esModule",{value:!0});var s=e("packages/jquery"),a=i(s),c=e("../utils"),l=n(c),f=l.assign,d=/^application\/([^.]+\.)?json$/i,p={};r["default"]={get:function(e,t,r,n){return o.call(n,"get",e,t,r)},post:function(e,t,r,n){return o.call(n,"post",e,t,r)},put:function(e,t,r,n){return o.call(n,"put",e,t,r)},"delete":function(e,t,r,n){return o.call(n,"delete",e,t,r)},patch:function(e,t,r,n){return o.call(n,"patch",e,t,r)},options:function(e,t,r,n){return o.call(n,"options",e,null,r)},head:function(e,t,r,n){return o.call(n,"head",e,null,r)}},t.exports=r["default"]},{"../utils":35,"packages/jquery":void 0}],34:[function(e,t,r){"use strict";function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o("setItem",t,2);var n=t[0],i=t[1],u=i+"";s[n]=u;try{window.localStorage.setItem(n,u)}catch(a){}}function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o("getItem",t,1);var n=t[0];if(null==s[n])try{s[n]=window.localStorage.getItem(n)}catch(i){}return null!=s[n]?s[n]:null}function u(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o("removeItem",t,1);var n=t[0];delete s[n];try{window.localStorage.removeItem(n)}catch(i){}}function o(e,t,r){if(t.length<r)throw new TypeError("Failed to execute '"+e+"' on 'Storage': "+r+" arguments required, but only "+t.length+" present.")}Object.defineProperty(r,"__esModule",{value:!0}),r.setItem=n,r.getItem=i,r.removeItem=u;var s={}},{}],35:[function(e,t,r){"use strict";function n(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function i(e,t){for(var r,i,u=n(e),o=1;o<arguments.length;o++){r=arguments[o],i=Object.keys(Object(r));for(var s=0;s<i.length;s++)try{u[i[s]]=r[i[s]]}catch(a){}}return u}function u(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return Array.prototype.slice.call(e,t)}function o(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=0;console.warn("Warning: "+e.replace(/%s/g,function(){return r[i++]}))}function s(e){if(null==e||"object"!=typeof e)return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(~[Date,RegExp,Function,String,Number,Boolean].indexOf(e.constructor))return new e.constructor(e);var t=new e.constructor;for(var r in e)t[r]="undefined"==typeof t[r]?s(e[r]):t[r];return t}Object.defineProperty(r,"__esModule",{value:!0}),r.assign=i,r.argsToArray=u,r.warning=o,r.deepCopy=s},{}],"4game-api-client":[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var u=e("packages/jquery"),o=i(u),s=e("./lib/auth/loginticket"),a=i(s),c=e("./lib/auth/basic"),l=i(c),f=e("./commands"),d=i(f),p=e("./lib/base64"),v=i(p),h=e("./lib/request"),g=n(h),y=e("./utils"),m=n(y),_=m.assign;r["default"]=function(e){function t(e){return f.href=e,f.href}function r(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(e.accessToken)return e.accessToken;var t=e.cookieName||"inn-user",r=document.cookie.match(new RegExp("\\b"+t+"\\s*=\\s*(.+?)(;|$)"));return r?r[1]:null}function n(e){return new RegExp(("^"+e+"$").replace(/([*+])/g,function(e,t){return y[t]||e}))}function i(e,t,r){var i={};return Object.keys(r).forEach(function(u){var o=u.split(" "),s=o[1]||o[0],a=!!o[1]&&o[0];!n(s).test(t)||a&&a!==e||_(i,r[u])}),i}function u(e,t){return e.replace(b,function(e,r){return t[r]||e})}function s(e){return _({},p,e)}var c={},f=document.createElement("a"),p=_({lang:(document.documentElement.getAttribute("lang")||"ru").toLowerCase(),area:(document.documentElement.getAttribute("data-area")||"ru").toLowerCase()},e.options),h={v1:{version:1,rules:{"*":s({baseUrl:e.v1.baseUrl}),auth:{url:e.v1.baseUrl+"/me/issue-token",tokenKeyName:"tokenType",expires:{"long":"long_lived","short":"short_lived"}}}},v2:{version:2,rules:{"*":s({baseUrl:e.v2.baseUrl}),auth:{url:e.v2.baseUrl+"/tokens",tokenKeyName:"expiration",expires:{"long":"long","short":"short"}},"auth/oauth/vk":{appId:p.vkAppId,returnUrl:encodeURIComponent(t(p.returnUrl))},"auth/oauth/fb":{appId:p.fbAppId,returnUrl:encodeURIComponent(t(p.returnUrl))},"auth/oauth/ok":{appId:p.okAppId,returnUrl:encodeURIComponent(t(p.returnUrl))},"auth/oauth/ya":{appId:p.yaAppId,returnUrl:encodeURIComponent(t(p.returnUrl))},orders:{baseUrl:e.v1.baseUrl},"orders*":{baseUrl:e.v1.baseUrl},"get users/+":{responsePreprocessor:function(e){return e.country&&(e.country=e.country.toLowerCase()),e}},"get users/+/accounts":{responsePreprocessor:function(e){return e.accounts}},"get users/+/identities":{responsePreprocessor:function(e){return e.identities}},"post users/+/apps/+/sign-in-codes":{responsePreprocessor:function(e){try{return JSON.parse(e.signInCode)}catch(t){return console.error("Can't parse "+(e&&e.signInCode)),null}}},"get users/+/apps/+/products":{letAnonymous:!0},"get users/+/apps/+/products/*":{letAnonymous:!0},"get users/+/apps/+/vouchers":{letAnonymous:!0},"post users/+/trackings":{letAnonymous:!0},"get users/+/status-monitor":{letAnonymous:!0}}}},y={"*":".+","+":"[^/]+"},b=/#{([^\s\W}]+)}/g,I=/#{userId}$/,j=(0,a["default"])().setCredentials({userId:"anonymous"}),k=["get","options","head"],E="v2",A={connector:g,rules:null,auth:null,use:function(e){var t,n,i;n="string"==typeof e?h[e].rules:"object"==typeof e&&e.rules?this.rules?m.deepCopy(_({},this.rules,e.rules)):e.rules:h[E].rules;var u=(0,v["default"])("object"==typeof e?JSON.stringify(e):e);c[u]?(t=c[u].ticket,i=c[u].auth):(t=(0,a["default"])(),i=Object.create(l["default"],{ticket:{value:t},config:{value:this.getRulesForResource("get","auth",n)},uid:{value:u}}),t.setCredentials({accessToken:r(p)}),c[u]={ticket:t,auth:i});var o=Object.create(A);Object.keys(this.connector).forEach(function(e){o[e]=function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.send.apply(this,[e].concat(r))}});var s=Object.create(o,{auth:{value:i},rules:{value:n},uid:{value:u}});return _(s,(0,d["default"])(s,p),"object"==typeof e&&e)},send:function(e,t,r,n){var i=this,s=o["default"].Deferred();if(e=e.toLowerCase(),e&&t){if(e in this.connector){var a=o["default"].Deferred(),c=!!this.getRulesForResource(e,t).letAnonymous;return this.auth.auth().then(function(e){a.resolve(u(t,e.getCredentials()),e)},function(r,n,i){401===r.status&&(c||I.test(t)&&k.indexOf(e)>=0||t.indexOf("#{userId}")<0)?a.resolve(u(t,j.getCredentials())):a.reject(r,n,i)}),a.then(function(t,u){var o=i.getRulesForResource(e,t);return i.connector[e](t,r,n,{token:u&&u.getAccessToken(),config:o})})}return s.reject({status:405},"error","Unsupported method")}return s.reject({status:404},"error","Requested bad command")},getRulesForResource:function(e,t,r){return t=t.replace(/^\//,""),i(e,t,r||this.rules)},uriToHref:function(e){return this.auth.auth().then(function(t){return"/"+u(e,t.getCredentials()).split("/").filter(Boolean).join("/")})}};return A.use(E)},t.exports=r["default"]},{"./commands":28,"./lib/auth/basic":29,"./lib/auth/loginticket":30,"./lib/base64":31,"./lib/request":33,"./utils":35,"packages/jquery":void 0}]},{},[]);return t("4game-api-client")(e.config())});