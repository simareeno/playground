(function(){define(["packages/4game-ns-client","packages/jquery","packages/event-bus","packages/che","global/launcher"],function(e,t,n,i,o){return{init:function(e){return this.$container=t(e),this.checkCookieCounters=function(e){return function(){return e.showCookieCounters(e.cookieCounters())}}(this),this.counters=t.makeArray(this.$container.find(".bGamePageCounter")).map(function(e){return e=t(e),{el:e,start:Date.parse(e.data("start")||0),end:Date.parse(e.data("end")||0),interval:e.data("interval"),cookie:e.data("cookie"),name:e.data("counter-name")}})},turnOn:function(){var o;if(this.show(this.simpleCounters()),this.checkCookieCounters(),i.events.bind("pageTransition:success",this.checkCookieCounters),o=this.namedCounters(),o.length)return o.forEach(function(t){return function(n){return e.subscribe(t.notificationReceived.bind(t),{type:"counter",tags:n.el.data("tags")})}}(this)),n.on("@counter-timer","show",this.notificationReceived,this),t(window).on("close-play-page-counter",{module:this},this.hideNamedCounter)},turnOff:function(){return n.off("@counter-timer","show",this.notificationReceived,this),t(window).off("close-play-page-counter",this.hideNamedCounter)},simpleCounters:function(){var e;return e=Date.now(),this.counters.filter(function(t){return!t.name&&!t.cookie&&e>t.start&&(t.interval||e<t.end)})},cookieCounters:function(){return this.counters.filter(function(e){return!e.name&&e.cookie})},namedCounters:function(){return this.counters.filter(function(e){return e.name})},showCookieCounters:function(e){return o.userData().then(function(n){return function(i){return n.show(e.filter(function(e){var o,r,a;return!(!e.cookie||n.isVisible(e))&&(o=e.cookie.replace(/\{(.+?)\}/g,function(e,t){return i[t]}),r=t.cookie(o),r?(e.start=Date.now(),e.end=new Date(1e3*+r),a=(e.end-e.start)/1e3,e.el.find(".bTimer").data("time-left",Math.floor(a)).trigger("start.timer"),!0):void 0)}))}}(this))},hideNamedCounter:function(e){var t,n;if(t=e.data.module,n=0,t.counters.forEach(function(t){return t.name===e.detail.name?t.el.addClass("bGamePageCounter_mVisibility_hidden"):t.el.hasClass("bGamePageCounter_mVisibility_hidden")?void 0:n++}),!n)return t.$container.closest(".bPlayLayout__eInfo").addClass("bPlayLayout__eInfo__mState_hidden")},notificationReceived:function(e){return this.show(this.namedCounters().filter(function(t){return t.name===e.name}))},hide:function(){var e,t,n,i;for(i=this.counters,t=0,n=i.length;t<n;t++)e=i[t],e.el.addClass("bGamePageCounter_mVisibility_hidden")},show:function(e){var t,n,i;if(null!=e?e.length:void 0)for(this.$container.closest(".bPlayLayout__eInfo").removeClass("bPlayLayout__eInfo__mState_hidden"),n=0,i=e.length;n<i;n++)t=e[n],t.el.removeClass("bGamePageCounter_mVisibility_hidden")},isVisible:function(e){return!e.el.hasClass("bGamePageCounter_mVisibility_hidden")}}})}).call(this);
//# sourceMappingURL=bGamePageCounters.js.map
